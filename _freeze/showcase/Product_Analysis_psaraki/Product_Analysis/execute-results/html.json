{
  "hash": "344c547bc4f27730b9ff065ca327b2c0",
  "result": {
    "markdown": "---\ntitle: \"Analysis of time-to-purchase (TTP)\"\nsubtitle: \"Product Analysis Graded Task\"\nauthor: \"Leonardo Cerliani\"\ndate: \"7/8/2023\"\noutput:\n  html_document:\n    self_contained: true\n    toc: true\n    toc_depth: 3\n    toc_float: true\n    code_folding: hide\n    highlight: pygments\n    theme: cerulean\n    css: styles.css\nimage: \"TTP.jpg\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(bigrquery)\nlibrary(tidyverse)\nlibrary(highcharter)\nlibrary(plotly)\nlibrary(lubridate)\nlibrary(echarts4r)\nlibrary(broom)\nlibrary(flextable)\nlibrary(reactable)\nlibrary(GGally)\nlibrary(jtools)\nlibrary(ggstatsplot)\nlibrary(viridis)\n\n\n# avoid the conflict with MASS::select\nselect <- dplyr::select\n```\n:::\n\n\n\n\n\n# Introduction\nWe work in an e-commerce company and have data about many browser actions perfomed by the user on our website. We would like to examine how much time is spent from our buying users from the moment that they land on the website to the moment that they complete the purchase.\n\nSpecifically, we would like to assess whether there are some differences based e.g. on the country where the user visits the website, the type of device (mobile or desktop), the period of the year, the amount of money spent, whether a certain campaign has an influence on this time, and so on.\n\nWe will first restrict our data to days when a given user makes actually purchases something, and we will primarily focus on the features that can be found in the dataset when the `event_type` is indeed `purchase`\n\n\n<br>\n\n# Potentially interesting questions\n\nHere are features of the purchasing session that could potentially influence the **time-to-purchase (TTP)** for a given user\n\n- **Country**: are there substantial differences between the TTP in different countries? We sell in ~80 countries, although the vast majority of the revenues comes from US, India and Canada.\n\n- **Date and time of purchase**: are there seasonal effects at the year/month/week level? Potentially there are also differences between different moments of the day. For simplicity, we will start to explore each of these subdivisions separately.\n\n- **Returning customer**: do returning customer go through the whole process quicker? Maybe because they already know the shop and trust it, or because they have already previously seen interesting products.\n\n- **Relation with # of items or amount of US$ spent**: do people take more time to purchase when they are buying more items or when they spend more?\n\n- **Campaign**: is TTP shorter when people buy during a campaign (e.g. Black Friday) or when they are directed to the website from a referral?\n\n- **Category of items**: it is possible to retrieve the category of items that were bought in a given session. Among these, it is particularly interesting to look at the category ‘SALE’. Do people who buy products on sale spend less time than in other categories (e.g. apparel or stationary) because maybe they feel that they need to hurry (as the product is on sale and they don’t know when the sale will end)\n\n- **OS and browser:** are TTP different for different browsers?\n\n- **Device**: do people buying from a mobile or desktop device have different TTP?\n\n\n<br>\n\n# Data preparation\n\n## Load data and define factors\nIn addition, we remove some non-informative details about the campaign.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- read_csv(\"Graded_Task_Data.csv\") %>% \n mutate_at(\n  c(\"user_pseudo_id\",\"country\",\"device\",\"OS\",\"browser\"), \n  factor\n ) %>% \n filter(country != \"(not set)\") %>% \n mutate(campaign = ifelse(campaign %in% c(\"<Other>\",\"(data deleted)\"), NA, campaign) ) %>% \n mutate(campaign = factor(campaign)) %>% \n filter(total_due > 0) %>%\n relocate(TTP)\n\n# summary(df)\n```\n:::\n\n\n\n\n\n\n## Explore overall TTP and datapoints per country {.tabset}\n\n\nWe first notice that the Time-to-purchase (TTP) is very skewed towards short values, but has a very long right tail (high TTP). \n\nThe highest values are in part due to countries with very high median TTP values and very few datapoints - see the adjacent barplot and table. \n\nWe will therefore start by removing the countries with a median $TTP < 1.5*IQR(TTP)$ of the distribution of the median TTP, where IQR(TTP) is the interquartile range of the TTP distribution. About 1% of all the datapoints are removed.\n\n::: {.panel-tabset}\n\n### TTP Distribution across countries\nCountries above $1.5 * IQR(medianTTP)$ will not be considered\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a ggplot histogram\nggplot(df, aes(x = TTP)) +\n  geom_histogram(binwidth = 1200, color = \"black\", fill = \"lightblue\") +\n  labs(title = \"Distribution of TTP in seconds across all countries\", \n       x = \"Time to Purchase (TTP)\") +\n  # scale_x_continuous(labels = function(x) seconds_to_period(x)) +\n  theme_minimal() -> gg\n\nggplotly(gg)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"plotly html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-d1eb2400208d4c9b16cd\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-d1eb2400208d4c9b16cd\">{\"x\":{\"data\":[{\"orientation\":\"v\",\"width\":[1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200],\"base\":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"x\":[0,1200,2400,3600,4800,6000,7200,8400,9600,10800,12000,13200,14400,15600,16800,18000,19200,20400,21600,22800,24000,25200,26400,27600,28800,30000,31200,32400,33600,34800,36000,37200,38400,39600,40800,42000,43200,44400,45600,46800,48000,49200,50400,51600,52800,54000,55200,56400,57600,58800,60000,61200,62400,63600,64800,66000,67200,68400,69600,70800,72000,73200,74400,75600,76800,78000,79200,80400,81600,82800,84000,85200],\"y\":[1075,1671,473,210,120,72,83,35,42,37,33,33,19,24,19,19,19,15,13,10,15,15,8,11,6,9,5,2,4,2,7,3,5,7,8,4,7,4,2,2,4,0,4,2,5,2,2,1,3,3,2,6,4,1,3,5,2,2,1,3,3,3,2,1,5,2,2,1,0,0,1,1],\"text\":[\"count: 1075<br />TTP:     0\",\"count: 1671<br />TTP:  1200\",\"count:  473<br />TTP:  2400\",\"count:  210<br />TTP:  3600\",\"count:  120<br />TTP:  4800\",\"count:   72<br />TTP:  6000\",\"count:   83<br />TTP:  7200\",\"count:   35<br />TTP:  8400\",\"count:   42<br />TTP:  9600\",\"count:   37<br />TTP: 10800\",\"count:   33<br />TTP: 12000\",\"count:   33<br />TTP: 13200\",\"count:   19<br />TTP: 14400\",\"count:   24<br />TTP: 15600\",\"count:   19<br />TTP: 16800\",\"count:   19<br />TTP: 18000\",\"count:   19<br />TTP: 19200\",\"count:   15<br />TTP: 20400\",\"count:   13<br />TTP: 21600\",\"count:   10<br />TTP: 22800\",\"count:   15<br />TTP: 24000\",\"count:   15<br />TTP: 25200\",\"count:    8<br />TTP: 26400\",\"count:   11<br />TTP: 27600\",\"count:    6<br />TTP: 28800\",\"count:    9<br />TTP: 30000\",\"count:    5<br />TTP: 31200\",\"count:    2<br />TTP: 32400\",\"count:    4<br />TTP: 33600\",\"count:    2<br />TTP: 34800\",\"count:    7<br />TTP: 36000\",\"count:    3<br />TTP: 37200\",\"count:    5<br />TTP: 38400\",\"count:    7<br />TTP: 39600\",\"count:    8<br />TTP: 40800\",\"count:    4<br />TTP: 42000\",\"count:    7<br />TTP: 43200\",\"count:    4<br />TTP: 44400\",\"count:    2<br />TTP: 45600\",\"count:    2<br />TTP: 46800\",\"count:    4<br />TTP: 48000\",\"count:    0<br />TTP: 49200\",\"count:    4<br />TTP: 50400\",\"count:    2<br />TTP: 51600\",\"count:    5<br />TTP: 52800\",\"count:    2<br />TTP: 54000\",\"count:    2<br />TTP: 55200\",\"count:    1<br />TTP: 56400\",\"count:    3<br />TTP: 57600\",\"count:    3<br />TTP: 58800\",\"count:    2<br />TTP: 60000\",\"count:    6<br />TTP: 61200\",\"count:    4<br />TTP: 62400\",\"count:    1<br />TTP: 63600\",\"count:    3<br />TTP: 64800\",\"count:    5<br />TTP: 66000\",\"count:    2<br />TTP: 67200\",\"count:    2<br />TTP: 68400\",\"count:    1<br />TTP: 69600\",\"count:    3<br />TTP: 70800\",\"count:    3<br />TTP: 72000\",\"count:    3<br />TTP: 73200\",\"count:    2<br />TTP: 74400\",\"count:    1<br />TTP: 75600\",\"count:    5<br />TTP: 76800\",\"count:    2<br />TTP: 78000\",\"count:    2<br />TTP: 79200\",\"count:    1<br />TTP: 80400\",\"count:    0<br />TTP: 81600\",\"count:    0<br />TTP: 82800\",\"count:    1<br />TTP: 84000\",\"count:    1<br />TTP: 85200\"],\"type\":\"bar\",\"textposition\":\"none\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(173,216,230,1)\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(0,0,0,1)\"}},\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null}],\"layout\":{\"margin\":{\"t\":43.7625570776256,\"r\":7.30593607305936,\"b\":40.1826484018265,\"l\":48.9497716894977},\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187},\"title\":{\"text\":\"Distribution of TTP in seconds across all countries\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":17.5342465753425},\"x\":0,\"xref\":\"paper\"},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[-4920,90120],\"tickmode\":\"array\",\"ticktext\":[\"0\",\"25000\",\"50000\",\"75000\"],\"tickvals\":[0,25000,50000,75000],\"categoryorder\":\"array\",\"categoryarray\":[\"0\",\"25000\",\"50000\",\"75000\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.65296803652968,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"Time to Purchase (TTP)\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[-83.55,1754.55],\"tickmode\":\"array\",\"ticktext\":[\"0\",\"500\",\"1000\",\"1500\"],\"tickvals\":[0,500,1000,1500],\"categoryorder\":\"array\",\"categoryarray\":[\"0\",\"500\",\"1000\",\"1500\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.65296803652968,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"count\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":null,\"line\":{\"color\":null,\"width\":0,\"linetype\":[]},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":null,\"bordercolor\":null,\"borderwidth\":0,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.689497716895}},\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"e55a61760ebc\":{\"x\":{},\"type\":\"bar\"}},\"cur_data\":\"e55a61760ebc\",\"visdat\":{\"e55a61760ebc\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n\n### Barplot median TTP\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>% \n select(country, TTP) %>% \n group_by(country) %>% \n summarise(\n  median_TTP = median(TTP),\n  percent_data = round(n()/nrow(df),4)*100\n ) %>% \n arrange(median_TTP) %>%\n mutate(name = fct_reorder(country, desc(median_TTP))) %>% \n ggplot(aes(x = median_TTP, y = name, \n            text = paste0(country,\"\\n percent data: \",percent_data) )) +\n theme_minimal() +\n theme(panel.grid = element_blank()) +\n geom_bar(stat = \"identity\", fill = \"lightblue\") +\n labs(\n  title = \"Median TTP per country\",\n  subtitle = \"Hover to inspect the % of datapoints in that country\",\n  x = \"median TTP\", \n  y = \"Country\"\n ) -> gg\n\nggplotly(gg)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"plotly html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-4a45655daea88031d3f4\" style=\"width:672px;height:1000px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-4a45655daea88031d3f4\">{\"x\":{\"data\":[{\"orientation\":\"v\",\"width\":[303,310,391,477,534,570.5,577.5,609,617,623,671.5,673,756.5,809,843,856,895,914,929,934,946,946,1052,1054.5,1063,1067,1085,1089,1099,1099.5,1100.5,1103,1109,1132,1133,1158,1206,1207.5,1227,1227.5,1230,1239,1247,1247.5,1266,1270,1278,1327,1346.5,1363,1365.5,1389,1391.5,1407,1409.5,1419,1476,1496.5,1528.5,1533,1605,1606.5,1626,1635,1649,1674,1703,1787,1805,1819,1822.5,1837,1879,1951,1973,1992.5,2004,2105,2116,2498.5,2560,2787,2810.5,3212,3245,4698,4811,5410,5693,6927,7045,7598,9501,10772,15253,15440,18521.5,19602,63089],\"base\":[98.55,97.55,96.55,95.55,94.55,93.55,92.55,91.55,90.55,89.55,88.55,87.55,86.55,85.55,84.55,83.55,82.55,81.55,80.55,79.55,77.55,78.55,76.55,75.55,74.55,73.55,72.55,71.55,70.55,69.55,68.55,67.55,66.55,65.55,64.55,63.55,62.55,61.55,60.55,59.55,58.55,57.55,56.55,55.55,54.55,53.55,52.55,51.55,50.55,49.55,48.55,47.55,46.55,45.55,44.55,43.55,42.55,41.55,40.55,39.55,38.55,37.55,36.55,35.55,34.55,33.55,32.55,31.55,30.55,29.55,28.55,27.55,26.55,25.55,24.55,23.55,22.55,21.55,20.55,19.55,18.55,17.55,16.55,15.55,14.55,13.55,12.55,11.55,10.55,9.55,8.55,7.55,6.55,5.55,4.55,3.55,2.55,1.55,0.55],\"x\":[151.5,155,195.5,238.5,267,285.25,288.75,304.5,308.5,311.5,335.75,336.5,378.25,404.5,421.5,428,447.5,457,464.5,467,473,473,526,527.25,531.5,533.5,542.5,544.5,549.5,549.75,550.25,551.5,554.5,566,566.5,579,603,603.75,613.5,613.75,615,619.5,623.5,623.75,633,635,639,663.5,673.25,681.5,682.75,694.5,695.75,703.5,704.75,709.5,738,748.25,764.25,766.5,802.5,803.25,813,817.5,824.5,837,851.5,893.5,902.5,909.5,911.25,918.5,939.5,975.5,986.5,996.25,1002,1052.5,1058,1249.25,1280,1393.5,1405.25,1606,1622.5,2349,2405.5,2705,2846.5,3463.5,3522.5,3799,4750.5,5386,7626.5,7720,9260.75,9801,31544.5],\"y\":[0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000006,0.900000000000002,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.899999999999999,0.9,0.9,0.9,0.9,0.9,0.9,0.9],\"text\":[\"median_TTP:   303.0<br />name: 0.9<br />Cambodia<br /> percent data: 0.02\",\"median_TTP:   310.0<br />name: 0.9<br />Qatar<br /> percent data: 0.02\",\"median_TTP:   391.0<br />name: 0.9<br />Lithuania<br /> percent data: 0.05\",\"median_TTP:   477.0<br />name: 0.9<br />Bahamas<br /> percent data: 0.02\",\"median_TTP:   534.0<br />name: 0.9<br />Pakistan<br /> percent data: 0.43\",\"median_TTP:   570.5<br />name: 0.9<br />Costa Rica<br /> percent data: 0.09\",\"median_TTP:   577.5<br />name: 0.9<br />Georgia<br /> percent data: 0.09\",\"median_TTP:   609.0<br />name: 0.9<br />Slovakia<br /> percent data: 0.12\",\"median_TTP:   617.0<br />name: 0.9<br />Slovenia<br /> percent data: 0.17\",\"median_TTP:   623.0<br />name: 0.9<br />Croatia<br /> percent data: 0.05\",\"median_TTP:   671.5<br />name: 0.9<br />Kuwait<br /> percent data: 0.09\",\"median_TTP:   673.0<br />name: 0.9<br />Jordan<br /> percent data: 0.02\",\"median_TTP:   756.5<br />name: 0.9<br />United Arab Emirates<br /> percent data: 0.24\",\"median_TTP:   809.0<br />name: 0.9<br />Singapore<br /> percent data: 1.09\",\"median_TTP:   843.0<br />name: 0.9<br />Poland<br /> percent data: 0.85\",\"median_TTP:   856.0<br />name: 0.9<br />Norway<br /> percent data: 0.02\",\"median_TTP:   895.0<br />name: 0.9<br />Germany<br /> percent data: 1.73\",\"median_TTP:   914.0<br />name: 0.9<br />Egypt<br /> percent data: 0.21\",\"median_TTP:   929.0<br />name: 0.9<br />Portugal<br /> percent data: 0.43\",\"median_TTP:   934.0<br />name: 0.9<br />Philippines<br /> percent data: 0.5\",\"median_TTP:   946.0<br />name: 0.9<br />Kosovo<br /> percent data: 0.02\",\"median_TTP:   946.0<br />name: 0.9<br />United Kingdom<br /> percent data: 3.1\",\"median_TTP:  1052.0<br />name: 0.9<br />Denmark<br /> percent data: 0.33\",\"median_TTP:  1054.5<br />name: 0.9<br />Ukraine<br /> percent data: 0.24\",\"median_TTP:  1063.0<br />name: 0.9<br />Thailand<br /> percent data: 0.54\",\"median_TTP:  1067.0<br />name: 0.9<br />Bolivia<br /> percent data: 0.02\",\"median_TTP:  1085.0<br />name: 0.9<br />Japan<br /> percent data: 1.61\",\"median_TTP:  1089.0<br />name: 0.9<br />Indonesia<br /> percent data: 0.5\",\"median_TTP:  1099.0<br />name: 0.9<br />Malaysia<br /> percent data: 0.71\",\"median_TTP:  1099.5<br />name: 0.9<br />Taiwan<br /> percent data: 1.7\",\"median_TTP:  1100.5<br />name: 0.9<br />Finland<br /> percent data: 0.19\",\"median_TTP:  1103.0<br />name: 0.9<br />Australia<br /> percent data: 0.97\",\"median_TTP:  1109.0<br />name: 0.9<br />United States<br /> percent data: 43.68\",\"median_TTP:  1132.0<br />name: 0.9<br />India<br /> percent data: 9.38\",\"median_TTP:  1133.0<br />name: 0.9<br />Spain<br /> percent data: 2.13\",\"median_TTP:  1158.0<br />name: 0.9<br />Peru<br /> percent data: 0.5\",\"median_TTP:  1206.0<br />name: 0.9<br />Vietnam<br /> percent data: 0.45\",\"median_TTP:  1207.5<br />name: 0.9<br />France<br /> percent data: 2.27\",\"median_TTP:  1227.0<br />name: 0.9<br />Czechia<br /> percent data: 0.31\",\"median_TTP:  1227.5<br />name: 0.9<br />Belgium<br /> percent data: 0.19\",\"median_TTP:  1230.0<br />name: 0.9<br />Sweden<br /> percent data: 0.47\",\"median_TTP:  1239.0<br />name: 0.9<br />Mexico<br /> percent data: 0.88\",\"median_TTP:  1247.0<br />name: 0.9<br />Ireland<br /> percent data: 0.69\",\"median_TTP:  1247.5<br />name: 0.9<br />Colombia<br /> percent data: 0.66\",\"median_TTP:  1266.0<br />name: 0.9<br />Venezuela<br /> percent data: 0.02\",\"median_TTP:  1270.0<br />name: 0.9<br />Ecuador<br /> percent data: 0.09\",\"median_TTP:  1278.0<br />name: 0.9<br />Canada<br /> percent data: 8.03\",\"median_TTP:  1327.0<br />name: 0.9<br />Kazakhstan<br /> percent data: 0.02\",\"median_TTP:  1346.5<br />name: 0.9<br />Hong Kong<br /> percent data: 0.66\",\"median_TTP:  1363.0<br />name: 0.9<br />Switzerland<br /> percent data: 0.38\",\"median_TTP:  1365.5<br />name: 0.9<br />Italy<br /> percent data: 1.18\",\"median_TTP:  1389.0<br />name: 0.9<br />Netherlands<br /> percent data: 1.25\",\"median_TTP:  1391.5<br />name: 0.9<br />Chile<br /> percent data: 0.19\",\"median_TTP:  1407.0<br />name: 0.9<br />China<br /> percent data: 1.7\",\"median_TTP:  1409.5<br />name: 0.9<br />Greece<br /> percent data: 0.47\",\"median_TTP:  1419.0<br />name: 0.9<br />South Korea<br /> percent data: 1.04\",\"median_TTP:  1476.0<br />name: 0.9<br />Algeria<br /> percent data: 0.05\",\"median_TTP:  1496.5<br />name: 0.9<br />South Africa<br /> percent data: 0.05\",\"median_TTP:  1528.5<br />name: 0.9<br />Brazil<br /> percent data: 1.23\",\"median_TTP:  1533.0<br />name: 0.9<br />Turkey<br /> percent data: 1.25\",\"median_TTP:  1605.0<br />name: 0.9<br />Bulgaria<br /> percent data: 0.12\",\"median_TTP:  1606.5<br />name: 0.9<br />Hungary<br /> percent data: 0.09\",\"median_TTP:  1626.0<br />name: 0.9<br />Romania<br /> percent data: 0.12\",\"median_TTP:  1635.0<br />name: 0.9<br />North Macedonia<br /> percent data: 0.07\",\"median_TTP:  1649.0<br />name: 0.9<br />Malta<br /> percent data: 0.09\",\"median_TTP:  1674.0<br />name: 0.9<br />Sri Lanka<br /> percent data: 0.17\",\"median_TTP:  1703.0<br />name: 0.9<br />Russia<br /> percent data: 0.83\",\"median_TTP:  1787.0<br />name: 0.9<br />Paraguay<br /> percent data: 0.02\",\"median_TTP:  1805.0<br />name: 0.9<br />Argentina<br /> percent data: 0.21\",\"median_TTP:  1819.0<br />name: 0.9<br />Morocco<br /> percent data: 0.12\",\"median_TTP:  1822.5<br />name: 0.9<br />Bangladesh<br /> percent data: 0.19\",\"median_TTP:  1837.0<br />name: 0.9<br />Kenya<br /> percent data: 0.07\",\"median_TTP:  1879.0<br />name: 0.9<br />Austria<br /> percent data: 0.4\",\"median_TTP:  1951.0<br />name: 0.9<br />New Zealand<br /> percent data: 0.12\",\"median_TTP:  1973.0<br />name: 0.9<br />Nigeria<br /> percent data: 0.17\",\"median_TTP:  1992.5<br />name: 0.9<br />Uruguay<br /> percent data: 0.14\",\"median_TTP:  2004.0<br />name: 0.9<br />Latvia<br /> percent data: 0.05\",\"median_TTP:  2105.0<br />name: 0.9<br />Israel<br /> percent data: 0.4\",\"median_TTP:  2116.0<br />name: 0.9<br />Cyprus<br /> percent data: 0.05\",\"median_TTP:  2498.5<br />name: 0.9<br />Puerto Rico<br /> percent data: 0.09\",\"median_TTP:  2560.0<br />name: 0.9<br />Dominican Republic<br /> percent data: 0.12\",\"median_TTP:  2787.0<br />name: 0.9<br />Albania<br /> percent data: 0.02\",\"median_TTP:  2810.5<br />name: 0.9<br />Serbia<br /> percent data: 0.09\",\"median_TTP:  3212.0<br />name: 0.9<br />Bahrain<br /> percent data: 0.02\",\"median_TTP:  3245.0<br />name: 0.9<br />Iraq<br /> percent data: 0.07\",\"median_TTP:  4698.0<br />name: 0.9<br />Guatemala<br /> percent data: 0.07\",\"median_TTP:  4811.0<br />name: 0.9<br />El Salvador<br /> percent data: 0.07\",\"median_TTP:  5410.0<br />name: 0.9<br />Saudi Arabia<br /> percent data: 0.19\",\"median_TTP:  5693.0<br />name: 0.9<br />Belarus<br /> percent data: 0.02\",\"median_TTP:  6927.0<br />name: 0.9<br />Bosnia & Herzegovina<br /> percent data: 0.02\",\"median_TTP:  7045.0<br />name: 0.9<br />Macao<br /> percent data: 0.05\",\"median_TTP:  7598.0<br />name: 0.9<br />Palestine<br /> percent data: 0.05\",\"median_TTP:  9501.0<br />name: 0.9<br />Luxembourg<br /> percent data: 0.02\",\"median_TTP: 10772.0<br />name: 0.9<br />Honduras<br /> percent data: 0.02\",\"median_TTP: 15253.0<br />name: 0.9<br />Tunisia<br /> percent data: 0.07\",\"median_TTP: 15440.0<br />name: 0.9<br />Panama<br /> percent data: 0.02\",\"median_TTP: 18521.5<br />name: 0.9<br />Lebanon<br /> percent data: 0.05\",\"median_TTP: 19602.0<br />name: 0.9<br />Mongolia<br /> percent data: 0.02\",\"median_TTP: 63089.0<br />name: 0.9<br />Armenia<br /> percent data: 0.02\"],\"type\":\"bar\",\"textposition\":\"none\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(173,216,230,1)\",\"line\":{\"width\":1.88976377952756,\"color\":\"transparent\"}},\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null}],\"layout\":{\"margin\":{\"t\":43.7625570776256,\"r\":7.30593607305936,\"b\":40.1826484018265,\"l\":142.465753424658},\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187},\"title\":{\"text\":\"Median TTP per country\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":17.5342465753425},\"x\":0,\"xref\":\"paper\"},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[-3154.45,66243.45],\"tickmode\":\"array\",\"ticktext\":[\"0\",\"20000\",\"40000\",\"60000\"],\"tickvals\":[0,20000,40000,60000],\"categoryorder\":\"array\",\"categoryarray\":[\"0\",\"20000\",\"40000\",\"60000\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.65296803652968,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":false,\"gridcolor\":null,\"gridwidth\":0,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"median TTP\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[0.4,99.6],\"tickmode\":\"array\",\"ticktext\":[\"Armenia\",\"Mongolia\",\"Lebanon\",\"Panama\",\"Tunisia\",\"Honduras\",\"Luxembourg\",\"Palestine\",\"Macao\",\"Bosnia & Herzegovina\",\"Belarus\",\"Saudi Arabia\",\"El Salvador\",\"Guatemala\",\"Iraq\",\"Bahrain\",\"Serbia\",\"Albania\",\"Dominican Republic\",\"Puerto Rico\",\"Cyprus\",\"Israel\",\"Latvia\",\"Uruguay\",\"Nigeria\",\"New Zealand\",\"Austria\",\"Kenya\",\"Bangladesh\",\"Morocco\",\"Argentina\",\"Paraguay\",\"Russia\",\"Sri Lanka\",\"Malta\",\"North Macedonia\",\"Romania\",\"Hungary\",\"Bulgaria\",\"Turkey\",\"Brazil\",\"South Africa\",\"Algeria\",\"South Korea\",\"Greece\",\"China\",\"Chile\",\"Netherlands\",\"Italy\",\"Switzerland\",\"Hong Kong\",\"Kazakhstan\",\"Canada\",\"Ecuador\",\"Venezuela\",\"Colombia\",\"Ireland\",\"Mexico\",\"Sweden\",\"Belgium\",\"Czechia\",\"France\",\"Vietnam\",\"Peru\",\"Spain\",\"India\",\"United States\",\"Australia\",\"Finland\",\"Taiwan\",\"Malaysia\",\"Indonesia\",\"Japan\",\"Bolivia\",\"Thailand\",\"Ukraine\",\"Denmark\",\"Kosovo\",\"United Kingdom\",\"Philippines\",\"Portugal\",\"Egypt\",\"Germany\",\"Norway\",\"Poland\",\"Singapore\",\"United Arab Emirates\",\"Jordan\",\"Kuwait\",\"Croatia\",\"Slovenia\",\"Slovakia\",\"Georgia\",\"Costa Rica\",\"Pakistan\",\"Bahamas\",\"Lithuania\",\"Qatar\",\"Cambodia\"],\"tickvals\":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99],\"categoryorder\":\"array\",\"categoryarray\":[\"Armenia\",\"Mongolia\",\"Lebanon\",\"Panama\",\"Tunisia\",\"Honduras\",\"Luxembourg\",\"Palestine\",\"Macao\",\"Bosnia & Herzegovina\",\"Belarus\",\"Saudi Arabia\",\"El Salvador\",\"Guatemala\",\"Iraq\",\"Bahrain\",\"Serbia\",\"Albania\",\"Dominican Republic\",\"Puerto Rico\",\"Cyprus\",\"Israel\",\"Latvia\",\"Uruguay\",\"Nigeria\",\"New Zealand\",\"Austria\",\"Kenya\",\"Bangladesh\",\"Morocco\",\"Argentina\",\"Paraguay\",\"Russia\",\"Sri Lanka\",\"Malta\",\"North Macedonia\",\"Romania\",\"Hungary\",\"Bulgaria\",\"Turkey\",\"Brazil\",\"South Africa\",\"Algeria\",\"South Korea\",\"Greece\",\"China\",\"Chile\",\"Netherlands\",\"Italy\",\"Switzerland\",\"Hong Kong\",\"Kazakhstan\",\"Canada\",\"Ecuador\",\"Venezuela\",\"Colombia\",\"Ireland\",\"Mexico\",\"Sweden\",\"Belgium\",\"Czechia\",\"France\",\"Vietnam\",\"Peru\",\"Spain\",\"India\",\"United States\",\"Australia\",\"Finland\",\"Taiwan\",\"Malaysia\",\"Indonesia\",\"Japan\",\"Bolivia\",\"Thailand\",\"Ukraine\",\"Denmark\",\"Kosovo\",\"United Kingdom\",\"Philippines\",\"Portugal\",\"Egypt\",\"Germany\",\"Norway\",\"Poland\",\"Singapore\",\"United Arab Emirates\",\"Jordan\",\"Kuwait\",\"Croatia\",\"Slovenia\",\"Slovakia\",\"Georgia\",\"Costa Rica\",\"Pakistan\",\"Bahamas\",\"Lithuania\",\"Qatar\",\"Cambodia\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.65296803652968,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":false,\"gridcolor\":null,\"gridwidth\":0,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"Country\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":null,\"line\":{\"color\":null,\"width\":0,\"linetype\":[]},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":null,\"bordercolor\":null,\"borderwidth\":0,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.689497716895}},\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"e55a35ae93b9\":{\"x\":{},\"y\":{},\"text\":{},\"type\":\"bar\"}},\"cur_data\":\"e55a35ae93b9\",\"visdat\":{\"e55a35ae93b9\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n\n### Table median TTP\n\nIt is possible to display the values in ascending/descending by clicking on the column header. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>% \n select(country, TTP) %>% \n group_by(country) %>% \n summarise(\n  country = unique(country),\n  median_TTP = median(TTP),\n  `% data` = round(n()/nrow(df),4)*100 \n ) %>% \n arrange(desc(`% data`)) %>% \n reactable(\n  searchable = T,\n  style = list(fontFamily = \"Calibri\")\n )\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"reactable html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-5930737a649208e49ca9\" style=\"width:auto;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-5930737a649208e49ca9\">{\"x\":{\"tag\":{\"name\":\"Reactable\",\"attribs\":{\"data\":{\"country\":[\"United States\",\"India\",\"Canada\",\"United Kingdom\",\"France\",\"Spain\",\"Germany\",\"China\",\"Taiwan\",\"Japan\",\"Netherlands\",\"Turkey\",\"Brazil\",\"Italy\",\"Singapore\",\"South Korea\",\"Australia\",\"Mexico\",\"Poland\",\"Russia\",\"Malaysia\",\"Ireland\",\"Colombia\",\"Hong Kong\",\"Thailand\",\"Indonesia\",\"Peru\",\"Philippines\",\"Greece\",\"Sweden\",\"Vietnam\",\"Pakistan\",\"Portugal\",\"Austria\",\"Israel\",\"Switzerland\",\"Denmark\",\"Czechia\",\"Ukraine\",\"United Arab Emirates\",\"Argentina\",\"Egypt\",\"Bangladesh\",\"Belgium\",\"Chile\",\"Finland\",\"Saudi Arabia\",\"Nigeria\",\"Slovenia\",\"Sri Lanka\",\"Uruguay\",\"Bulgaria\",\"Dominican Republic\",\"Morocco\",\"New Zealand\",\"Romania\",\"Slovakia\",\"Costa Rica\",\"Ecuador\",\"Georgia\",\"Hungary\",\"Kuwait\",\"Malta\",\"Puerto Rico\",\"Serbia\",\"El Salvador\",\"Guatemala\",\"Iraq\",\"Kenya\",\"North Macedonia\",\"Tunisia\",\"Algeria\",\"Croatia\",\"Cyprus\",\"Latvia\",\"Lebanon\",\"Lithuania\",\"Macao\",\"Palestine\",\"South Africa\",\"Albania\",\"Armenia\",\"Bahamas\",\"Bahrain\",\"Belarus\",\"Bolivia\",\"Bosnia & Herzegovina\",\"Cambodia\",\"Honduras\",\"Jordan\",\"Kazakhstan\",\"Kosovo\",\"Luxembourg\",\"Mongolia\",\"Norway\",\"Panama\",\"Paraguay\",\"Qatar\",\"Venezuela\"],\"median_TTP\":[1109,1132,1278,946,1207.5,1133,895,1407,1099.5,1085,1389,1533,1528.5,1365.5,809,1419,1103,1239,843,1703,1099,1247,1247.5,1346.5,1063,1089,1158,934,1409.5,1230,1206,534,929,1879,2105,1363,1052,1227,1054.5,756.5,1805,914,1822.5,1227.5,1391.5,1100.5,5410,1973,617,1674,1992.5,1605,2560,1819,1951,1626,609,570.5,1270,577.5,1606.5,671.5,1649,2498.5,2810.5,4811,4698,3245,1837,1635,15253,1476,623,2116,2004,18521.5,391,7045,7598,1496.5,2787,63089,477,3212,5693,1067,6927,303,10772,673,1327,946,9501,19602,856,15440,1787,310,1266],\"% data\":[43.68,9.38,8.03,3.1,2.27,2.13,1.73,1.7,1.7,1.61,1.25,1.25,1.23,1.18,1.09,1.04,0.97,0.88,0.85,0.83,0.71,0.69,0.66,0.66,0.54,0.5,0.5,0.5,0.47,0.47,0.45,0.43,0.43,0.4,0.4,0.38,0.33,0.31,0.24,0.24,0.21,0.21,0.19,0.19,0.19,0.19,0.19,0.17,0.17,0.17,0.14,0.12,0.12,0.12,0.12,0.12,0.12,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.07,0.07,0.07,0.07,0.07,0.07,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02]},\"columns\":[{\"id\":\"country\",\"name\":\"country\",\"type\":\"factor\"},{\"id\":\"median_TTP\",\"name\":\"median_TTP\",\"type\":\"numeric\"},{\"id\":\"% data\",\"name\":\"% data\",\"type\":\"numeric\"}],\"searchable\":true,\"style\":{\"fontFamily\":\"Calibri\"},\"dataKey\":\"e1d719da3c9e3b737c1b4022a39444cd\"},\"children\":[]},\"class\":\"reactR_markup\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n\n### Remove countries with extreme medianTTP\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate the median TTP for each country\nmedianTTP_tbl <- df %>% \n select(country,TTP) %>% \n group_by(country) %>% \n summarise(median_TTP = median(TTP)) %>% \n arrange(desc(median_TTP))\n\nggplot(medianTTP_tbl %>% filter(median_TTP < 1e4), aes(y = median_TTP)) +\n  geom_boxplot() +\n  labs(title = \"Boxplot of Median Time to Purchase\",\n       y = \"Median Time to Purchase (seconds)\") +\n  theme_minimal() -> gg\n\nggplotly(gg)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"plotly html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-f6db888a5d13df0cd806\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-f6db888a5d13df0cd806\">{\"x\":{\"data\":[{\"y\":[9501,7598,7045,6927,5693,5410,4811,4698,3245,3212,2810.5,2787,2560,2498.5,2116,2105,2004,1992.5,1973,1951,1879,1837,1822.5,1819,1805,1787,1703,1674,1649,1635,1626,1606.5,1605,1533,1528.5,1496.5,1476,1419,1409.5,1407,1391.5,1389,1365.5,1363,1346.5,1327,1278,1270,1266,1247.5,1247,1239,1230,1227.5,1227,1207.5,1206,1158,1133,1132,1109,1103,1100.5,1099.5,1099,1089,1085,1067,1063,1054.5,1052,946,946,934,929,914,895,856,843,809,756.5,673,671.5,623,617,609,577.5,570.5,534,477,391,310,303],\"hoverinfo\":\"y\",\"type\":\"box\",\"fillcolor\":\"rgba(255,255,255,1)\",\"marker\":{\"opacity\":null,\"outliercolor\":\"rgba(0,0,0,1)\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(0,0,0,1)\"},\"size\":5.66929133858268},\"line\":{\"color\":\"rgba(51,51,51,1)\",\"width\":1.88976377952756},\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"frame\":null}],\"layout\":{\"margin\":{\"t\":43.7625570776256,\"r\":7.30593607305936,\"b\":25.5707762557078,\"l\":48.9497716894977},\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187},\"title\":{\"text\":\"Boxplot of Median Time to Purchase\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":17.5342465753425},\"x\":0,\"xref\":\"paper\"},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[-0.4125,0.4125],\"tickmode\":\"array\",\"ticktext\":[\"-0.4\",\"-0.2\",\"0.0\",\"0.2\",\"0.4\"],\"tickvals\":[-0.4,-0.2,0,0.2,0.4],\"categoryorder\":\"array\",\"categoryarray\":[\"-0.4\",\"-0.2\",\"0.0\",\"0.2\",\"0.4\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.65296803652968,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[-156.9,9960.9],\"tickmode\":\"array\",\"ticktext\":[\"0\",\"2500\",\"5000\",\"7500\"],\"tickvals\":[0,2500,5000,7500],\"categoryorder\":\"array\",\"categoryarray\":[\"0\",\"2500\",\"5000\",\"7500\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.65296803652968,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"Median Time to Purchase (seconds)\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":null,\"line\":{\"color\":null,\"width\":0,\"linetype\":[]},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":null,\"bordercolor\":null,\"borderwidth\":0,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.689497716895}},\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"e55a1542db37\":{\"y\":{},\"type\":\"box\"}},\"cur_data\":\"e55a1542db37\",\"visdat\":{\"e55a1542db37\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n\n```{.r .cell-code}\n# Remove countries with median TTP above 1.5 * IQR(medianTTP)\nthr_median_TTP <- medianTTP_tbl$median_TTP %>% median + 1.5 * IQR(medianTTP_tbl$median_TTP)\n\ndf <- df %>% \n group_by(country) %>% \n mutate(medianTTP = median(TTP)) %>% \n relocate(medianTTP) %>% \n filter(medianTTP <= thr_median_TTP) %>% \n ungroup()\n```\n:::\n\n\n:::\n\n<br>\n\n## Choice of the reference TTP {.tabset}\n\nEven in countries where the median TTP is within acceptable range, we still have very long sessions. Very long sessions do not necessarily signal \"outliers\", however before carrying out any analysis, we need to ask whether it makes sense to consider sessions of any length.\n\nSince eventually we are interested in assessing the effect of session length on revenues, we will operate a choice that takes into consideration both metrics - i.e. TTP and total_due.\n\n\nWe observe that:\n\n1. While plotting the raw TTP apparently shows that order amount decreases with increasing TTP, plotting order amount vs. log(TTP) reveals that order amount increase - at least in some orders - for sessions up to 40-60 minutes.\n\n2. 80% of sessions last up to an hour, while 90% of sessions up to three hours\n\n**We will consider sessions up to an hour** - and later assess the impact of shorter or longer sessions\n\n::: {.panel-tabset}\n\n### Session length decreases exponentially\n\nThe TTP appear to follow a power-law: the length of the sessions decreases exponentially, as shown by the log-transformed TTP and by the red lines indicating the 80th, 90th and 95th quantiles of the distribution of TTP.\n\nIn this plot, the order value appear to be decreasing with session time, however this is just due to the concentration of TTP in short sessions.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow = c(1,2))\n\npdf_TTP <- hist(df$TTP, main = \"Distribution of TTP\", xlab = \"TTP\", col = \"lightblue\")\npdf_logTTP <- hist(log(df$TTP), main = \"Distribution of log(TTP)\", xlab = \"log(TTP)\",\n                   col=\"lightblue\")\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\npar(mfrow = c(1,1))\n\npTTP <- plot(df$TTP, df$total_due, pch = 21, bg = \"lightblue\",\n     xlab = \"Time to Purchase (seconds)\",\n     ylab = \"Total Due in US$\",\n     main = \"TTP vs Total Due\")\n\n\nq <- quantile(df$TTP, probs = c(0.80, 0.90, 0.95)) %>% round\n\n# construct a plot function for the quantiles lines\nplot_quantiles <- function(q,n) {\n abline(v = q[[n]], col = \"red\", lwd = 2, lty = 2)\n text(q[[n]] -2000, 1500, names(q[n]), col = \"red\")\n}\n\n# plot the quantile lines\n1:length(q) %>% walk(~ plot_quantiles(q,.x))\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n:::\n\n\n\n### Order value increases up to ~ 1 hour\n\nBy log-transforming TTP we observe that the length of the session has at least some effect on the amount of the order, up to 40-60 minutes. We will choose 1 hour as our threshold for the maximum session length, which gives us about 80% of the whole data.\n\nImportantly we will carry out analyses on log-transformed data to decrease the deviation of the data from normality.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbreaks_log <- quantile(log(df$TTP), probs = seq(0.1,1,0.1))\n\nbreaks_hms <- quantile(log(df$TTP), probs = seq(0.1,1,0.1)) %>%\n exp() %>% \n round() %>% \n seconds_to_period %>% \n map_chr(~ sprintf(\"%02d:%02d:%02d\",hour(.x),minute(.x),second(.x)))\n\nxlabels <- paste0(seq(10,100,10),\"% - \", breaks_hms)\n\n# plot usd ~ logTTP\ndf %>% \n  ggplot(aes(x = log(TTP), y = total_due)) +\n  geom_point(fill = \"lightblue\", shape = 21, size = 2) +\n  geom_vline(xintercept = breaks_log, linetype = \"solid\", color = \"red\", linewidth = 0.3) +\n  geom_smooth(\n    method = \"loess\", formula = \"y ~ x\", color = \"lightgreen\", linetype = \"solid\", size = 1\n   ) +\n  theme_minimal() +\n  labs(title = \"TTP vs Total Due\",\n       x = \"Time to Purchase (seconds)\",\n       y = \"Total Due in US$\") +\n scale_x_continuous(\n  breaks = breaks_log, \n  labels = xlabels\n ) +\n theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# # plot log(usd) ~ logTTP\ndf %>% \n # filter(TTP <= 3600) %>%\n filter(total_due >= 1) %>%\n ggplot(aes(x = log(TTP), y = total_due)) +\n  geom_point(fill = \"lightblue\", shape = 21, size = 2) +\n  geom_vline(xintercept = breaks_log, linetype = \"solid\", color = \"red\", linewidth = 0.3) +\n  geom_smooth(\n   method = \"loess\", formula = \"y ~ x\", \n   color = \"lightgreen\", linetype = \"solid\", linewidth = 1\n  ) +\n  theme_minimal() +\n  labs(title = \"TTP vs Total Due\",\n       x = \"Time to Purchase (seconds)\",\n       y = \"Log(Total Due) in US$\") +\n scale_x_continuous(\n  breaks = breaks_log, \n  labels = xlabels\n ) +\n scale_y_log10() +\n # coord_cartesian(ylim = c(0, 750)) +  # Set the y-axis limits\n theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/unnamed-chunk-8-2.png){width=672}\n:::\n:::\n\n\n\n\n\n### Average Order Value\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(2,2))\n\nboxplot(df$total_due[df$total_due < 300], \n        horizontal = T, col = \"lightgreen\", \n        outpch = 3, outcol = \"lightgreen\", outcex = 1.5,\n        main = \"Total due (limited to < 200 US$)\")\n\nAOV <- round(sum(df$total_due) / nrow(df), 2)\n\nmedian_order_value <- median(df$total_due)\n\nhist(df$total_due, col = \"lightgreen\", main = \"Distribution of total_due\", xlab = \"total_due\")\n\nhist(df$total_due %>% log, col = \"lightgreen\", main = \"Distribution of log(total_due)\", xlab = \"log(total_due)\")\n\nqqnorm(log(df$total_due), col = \"lightgreen\")\nqqline(log(df$total_due),col = \"red\")\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/median_order_amount-1.png){width=672}\n:::\n:::\n\n\nAs a side note, the **median order value is 48**, very different from the average order value of 70.42 because there are orders extending up to 1500 USD. The order value follows a log-linear distribution\n\n\n### Test the increase up to ~ 1 hour\n\n::: {.cell}\n\n```{.r .cell-code}\n# TTP between seconds_to_period(logTTP_range)\nlogTTP_range <- 6:9\n\n# Limit to 500 to have a better view of the distribution. \n# Stats with log are virtually identical \nthr_total_due <- 500\n\n# function to use hms of logTTP as grouping variable for the plot\nlogTTP_to_hms <- function(logTTP) {\n hms <- round(logTTP) %>% exp() %>% round %>% seconds_to_period() %>% \n  map_chr(~ sprintf(\"%02d:%02d:%02d\",hour(.x),minute(.x),second(.x)))\n}\n\n\nddf <- df %>% \n select(TTP, total_due) %>% \n mutate(logTTP = log(TTP)) %>% \n filter(logTTP >= min(logTTP_range) & logTTP <= max(logTTP_range)) %>% \n mutate(logTTP_hms = logTTP_to_hms(logTTP) ) %>% \n mutate(logUSD = log(total_due + 1)) %>% \n filter(total_due <= 500)\n\n\nggbetweenstats(\n data = ddf,\n x = logTTP_hms,\n y = total_due\n)\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n\n### Ratio of high/low revenues increases up to ~ 1 hour\n\n::: {.cell}\n\n```{.r .cell-code}\n# Proportion of high- vs. low-amount orders over time\n\nddf <- df %>% \n mutate(logTTP = log(TTP)) %>% \n select(logTTP, total_due) %>% \n mutate(ntile_logTTP = ntile(logTTP, 10)) %>% \n mutate(ntile_logUSD = ntile(log(total_due),10)) %>% \n group_by(ntile_logTTP, ntile_logUSD) %>% \n count() %>% \n ungroup(ntile_logUSD) %>% \n mutate(perctent_of_purchase = round(n/sum(n),4)*100 ) %>% \n select(-n) %>% \n arrange(ntile_logTTP)\n\n\n# Quantiles of TTP (for xaxis labels)\nq_TTP <- quantile(log(df$TTP), probs = seq(0.1, 1, 0.1) ) %>% \n exp() %>% seconds_to_period() %>% round() %>% \n map_chr(~ sprintf(\"%02d:%02d:%02d\",hour(.x), minute(.x),second(.x)))\n\n# Create a custom color palette using viridis colormap\ncustom_palette <- viridis(10)\n\n# Define the quantile values and labels\nquantile_probs <- seq(0.1, 1, 0.1)\nquantile_labels <- quantile(df$total_due %>% log(), probs = quantile_probs) %>% exp() %>% as.character()\n\n# Modify the levels and labels of ntile_logUSD\nddf$ntile_logUSD <- factor(ddf$ntile_logUSD, levels = 1:10, labels = quantile_labels)\n\nggplot(ddf, aes(x = factor(ntile_logTTP), y = perctent_of_purchase, fill = factor(ntile_logUSD))) + \n  geom_bar(stat = \"identity\", position = position_stack(reverse = TRUE), show.legend = TRUE) +\n  scale_fill_manual(values = custom_palette) +\n  xlab(\"ntile_logTTP\") +\n  ylab(\"Proportion of Purchase\") +\n  labs(fill = \"ntile_logUSD\") +\n  theme_minimal() +\n  scale_x_discrete(labels = as.character(q_TTP)) +\n  labs(\n    title = \"Proportion of low- and high-revenue orders in increasingly longer sessions\",\n    x = \"Session duration in hh:mm\",\n    y = \"Proportion of Purchases\"\n  ) +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1)) -> gg\n\n# # If I use the following, the legend disappears in ggplotly\n# p <- p + guides(fill = guide_legend(reverse = TRUE), show.legend = TRUE)  # Reverse the order of the legend\n\nggplotly(gg, config = list(displayModeBar = FALSE))\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"plotly html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-24f9691baa04818b4ec4\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-24f9691baa04818b4ec4\">{\"x\":{\"data\":[{\"orientation\":\"v\",\"width\":[0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.899999999999999,0.899999999999999,0.899999999999999],\"base\":[0,0,0,0,0,0,0,0,0,0],\"x\":[1,2,3,4,5,6,7,8,9,10],\"y\":[20.05,13.6,15.99,10.26,7.88,7.66,4.78,5.02,5.74,9.09],\"text\":[\"factor(ntile_logTTP): 1<br />perctent_of_purchase: 20.05<br />factor(ntile_logUSD): 16\",\"factor(ntile_logTTP): 2<br />perctent_of_purchase: 13.60<br />factor(ntile_logUSD): 16\",\"factor(ntile_logTTP): 3<br />perctent_of_purchase: 15.99<br />factor(ntile_logUSD): 16\",\"factor(ntile_logTTP): 4<br />perctent_of_purchase: 10.26<br />factor(ntile_logUSD): 16\",\"factor(ntile_logTTP): 5<br />perctent_of_purchase:  7.88<br />factor(ntile_logUSD): 16\",\"factor(ntile_logTTP): 6<br />perctent_of_purchase:  7.66<br />factor(ntile_logUSD): 16\",\"factor(ntile_logTTP): 7<br />perctent_of_purchase:  4.78<br />factor(ntile_logUSD): 16\",\"factor(ntile_logTTP): 8<br />perctent_of_purchase:  5.02<br />factor(ntile_logUSD): 16\",\"factor(ntile_logTTP): 9<br />perctent_of_purchase:  5.74<br />factor(ntile_logUSD): 16\",\"factor(ntile_logTTP): 10<br />perctent_of_purchase:  9.09<br />factor(ntile_logUSD): 16\"],\"type\":\"bar\",\"textposition\":\"none\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(68,1,84,1)\",\"line\":{\"width\":1.88976377952756,\"color\":\"transparent\"}},\"name\":\"16\",\"legendgroup\":\"16\",\"showlegend\":true,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null},{\"orientation\":\"v\",\"width\":[0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.899999999999999,0.899999999999999,0.899999999999999],\"base\":[20.05,13.6,15.99,10.26,7.88,7.66,4.78,5.02,5.74,9.09],\"x\":[1,2,3,4,5,6,7,8,9,10],\"y\":[16.95,10.26,12.89,10.98,10.02,7.66,8.61,5.74,7.89,9.09],\"text\":[\"factor(ntile_logTTP): 1<br />perctent_of_purchase: 16.95<br />factor(ntile_logUSD): 24\",\"factor(ntile_logTTP): 2<br />perctent_of_purchase: 10.26<br />factor(ntile_logUSD): 24\",\"factor(ntile_logTTP): 3<br />perctent_of_purchase: 12.89<br />factor(ntile_logUSD): 24\",\"factor(ntile_logTTP): 4<br />perctent_of_purchase: 10.98<br />factor(ntile_logUSD): 24\",\"factor(ntile_logTTP): 5<br />perctent_of_purchase: 10.02<br />factor(ntile_logUSD): 24\",\"factor(ntile_logTTP): 6<br />perctent_of_purchase:  7.66<br />factor(ntile_logUSD): 24\",\"factor(ntile_logTTP): 7<br />perctent_of_purchase:  8.61<br />factor(ntile_logUSD): 24\",\"factor(ntile_logTTP): 8<br />perctent_of_purchase:  5.74<br />factor(ntile_logUSD): 24\",\"factor(ntile_logTTP): 9<br />perctent_of_purchase:  7.89<br />factor(ntile_logUSD): 24\",\"factor(ntile_logTTP): 10<br />perctent_of_purchase:  9.09<br />factor(ntile_logUSD): 24\"],\"type\":\"bar\",\"textposition\":\"none\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(72,40,120,1)\",\"line\":{\"width\":1.88976377952756,\"color\":\"transparent\"}},\"name\":\"24\",\"legendgroup\":\"24\",\"showlegend\":true,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null},{\"orientation\":\"v\",\"width\":[0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.899999999999999,0.899999999999999,0.899999999999999],\"base\":[37,23.86,28.88,21.24,17.9,15.32,13.39,10.76,13.63,18.18],\"x\":[1,2,3,4,5,6,7,8,9,10],\"y\":[12.65,14.8,11.46,7.88,10.5,8.61,8.37,5.74,8.85,11.24],\"text\":[\"factor(ntile_logTTP): 1<br />perctent_of_purchase: 12.65<br />factor(ntile_logUSD): 32\",\"factor(ntile_logTTP): 2<br />perctent_of_purchase: 14.80<br />factor(ntile_logUSD): 32\",\"factor(ntile_logTTP): 3<br />perctent_of_purchase: 11.46<br />factor(ntile_logUSD): 32\",\"factor(ntile_logTTP): 4<br />perctent_of_purchase:  7.88<br />factor(ntile_logUSD): 32\",\"factor(ntile_logTTP): 5<br />perctent_of_purchase: 10.50<br />factor(ntile_logUSD): 32\",\"factor(ntile_logTTP): 6<br />perctent_of_purchase:  8.61<br />factor(ntile_logUSD): 32\",\"factor(ntile_logTTP): 7<br />perctent_of_purchase:  8.37<br />factor(ntile_logUSD): 32\",\"factor(ntile_logTTP): 8<br />perctent_of_purchase:  5.74<br />factor(ntile_logUSD): 32\",\"factor(ntile_logTTP): 9<br />perctent_of_purchase:  8.85<br />factor(ntile_logUSD): 32\",\"factor(ntile_logTTP): 10<br />perctent_of_purchase: 11.24<br />factor(ntile_logUSD): 32\"],\"type\":\"bar\",\"textposition\":\"none\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(62,74,137,1)\",\"line\":{\"width\":1.88976377952756,\"color\":\"transparent\"}},\"name\":\"32\",\"legendgroup\":\"32\",\"showlegend\":true,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null},{\"orientation\":\"v\",\"width\":[0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.899999999999999,0.899999999999999,0.899999999999999],\"base\":[49.65,38.66,40.34,29.12,28.4,23.93,21.76,16.5,22.48,29.42],\"x\":[1,2,3,4,5,6,7,8,9,10],\"y\":[10.98,11.46,9.31,8.83,10.5,9.57,8.13,11.24,11.48,8.61],\"text\":[\"factor(ntile_logTTP): 1<br />perctent_of_purchase: 10.98<br />factor(ntile_logUSD): 41\",\"factor(ntile_logTTP): 2<br />perctent_of_purchase: 11.46<br />factor(ntile_logUSD): 41\",\"factor(ntile_logTTP): 3<br />perctent_of_purchase:  9.31<br />factor(ntile_logUSD): 41\",\"factor(ntile_logTTP): 4<br />perctent_of_purchase:  8.83<br />factor(ntile_logUSD): 41\",\"factor(ntile_logTTP): 5<br />perctent_of_purchase: 10.50<br />factor(ntile_logUSD): 41\",\"factor(ntile_logTTP): 6<br />perctent_of_purchase:  9.57<br />factor(ntile_logUSD): 41\",\"factor(ntile_logTTP): 7<br />perctent_of_purchase:  8.13<br />factor(ntile_logUSD): 41\",\"factor(ntile_logTTP): 8<br />perctent_of_purchase: 11.24<br />factor(ntile_logUSD): 41\",\"factor(ntile_logTTP): 9<br />perctent_of_purchase: 11.48<br />factor(ntile_logUSD): 41\",\"factor(ntile_logTTP): 10<br />perctent_of_purchase:  8.61<br />factor(ntile_logUSD): 41\"],\"type\":\"bar\",\"textposition\":\"none\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(49,104,142,1)\",\"line\":{\"width\":1.88976377952756,\"color\":\"transparent\"}},\"name\":\"41\",\"legendgroup\":\"41\",\"showlegend\":true,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null},{\"orientation\":\"v\",\"width\":[0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.899999999999999,0.899999999999999,0.899999999999999],\"base\":[60.63,50.12,49.65,37.95,38.9,33.5,29.89,27.74,33.96,38.03],\"x\":[1,2,3,4,5,6,7,8,9,10],\"y\":[12.65,10.02,10.98,12.41,9.55,8.61,9.81,8.37,10.53,7.18],\"text\":[\"factor(ntile_logTTP): 1<br />perctent_of_purchase: 12.65<br />factor(ntile_logUSD): 48\",\"factor(ntile_logTTP): 2<br />perctent_of_purchase: 10.02<br />factor(ntile_logUSD): 48\",\"factor(ntile_logTTP): 3<br />perctent_of_purchase: 10.98<br />factor(ntile_logUSD): 48\",\"factor(ntile_logTTP): 4<br />perctent_of_purchase: 12.41<br />factor(ntile_logUSD): 48\",\"factor(ntile_logTTP): 5<br />perctent_of_purchase:  9.55<br />factor(ntile_logUSD): 48\",\"factor(ntile_logTTP): 6<br />perctent_of_purchase:  8.61<br />factor(ntile_logUSD): 48\",\"factor(ntile_logTTP): 7<br />perctent_of_purchase:  9.81<br />factor(ntile_logUSD): 48\",\"factor(ntile_logTTP): 8<br />perctent_of_purchase:  8.37<br />factor(ntile_logUSD): 48\",\"factor(ntile_logTTP): 9<br />perctent_of_purchase: 10.53<br />factor(ntile_logUSD): 48\",\"factor(ntile_logTTP): 10<br />perctent_of_purchase:  7.18<br />factor(ntile_logUSD): 48\"],\"type\":\"bar\",\"textposition\":\"none\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(38,130,142,1)\",\"line\":{\"width\":1.88976377952756,\"color\":\"transparent\"}},\"name\":\"48\",\"legendgroup\":\"48\",\"showlegend\":true,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null},{\"orientation\":\"v\",\"width\":[0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.899999999999999,0.899999999999999,0.899999999999999],\"base\":[73.28,60.14,60.63,50.36,48.45,42.11,39.7,36.11,44.49,45.21],\"x\":[1,2,3,4,5,6,7,8,9,10],\"y\":[9.31,10.98,8.11,9.79,11.22,9.09,11.48,9.81,9.33,10.77],\"text\":[\"factor(ntile_logTTP): 1<br />perctent_of_purchase:  9.31<br />factor(ntile_logUSD): 60\",\"factor(ntile_logTTP): 2<br />perctent_of_purchase: 10.98<br />factor(ntile_logUSD): 60\",\"factor(ntile_logTTP): 3<br />perctent_of_purchase:  8.11<br />factor(ntile_logUSD): 60\",\"factor(ntile_logTTP): 4<br />perctent_of_purchase:  9.79<br />factor(ntile_logUSD): 60\",\"factor(ntile_logTTP): 5<br />perctent_of_purchase: 11.22<br />factor(ntile_logUSD): 60\",\"factor(ntile_logTTP): 6<br />perctent_of_purchase:  9.09<br />factor(ntile_logUSD): 60\",\"factor(ntile_logTTP): 7<br />perctent_of_purchase: 11.48<br />factor(ntile_logUSD): 60\",\"factor(ntile_logTTP): 8<br />perctent_of_purchase:  9.81<br />factor(ntile_logUSD): 60\",\"factor(ntile_logTTP): 9<br />perctent_of_purchase:  9.33<br />factor(ntile_logUSD): 60\",\"factor(ntile_logTTP): 10<br />perctent_of_purchase: 10.77<br />factor(ntile_logUSD): 60\"],\"type\":\"bar\",\"textposition\":\"none\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(31,158,137,1)\",\"line\":{\"width\":1.88976377952756,\"color\":\"transparent\"}},\"name\":\"60\",\"legendgroup\":\"60\",\"showlegend\":true,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null},{\"orientation\":\"v\",\"width\":[0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.899999999999999,0.899999999999999,0.899999999999999],\"base\":[82.59,71.12,68.74,60.15,59.67,51.2,51.18,45.92,53.82,55.98],\"x\":[1,2,3,4,5,6,7,8,9,10],\"y\":[4.53,9.06999999999999,10.74,12.89,10.5,13.16,11.96,10.53,8.37,8.13],\"text\":[\"factor(ntile_logTTP): 1<br />perctent_of_purchase:  4.53<br />factor(ntile_logUSD): 77\",\"factor(ntile_logTTP): 2<br />perctent_of_purchase:  9.07<br />factor(ntile_logUSD): 77\",\"factor(ntile_logTTP): 3<br />perctent_of_purchase: 10.74<br />factor(ntile_logUSD): 77\",\"factor(ntile_logTTP): 4<br />perctent_of_purchase: 12.89<br />factor(ntile_logUSD): 77\",\"factor(ntile_logTTP): 5<br />perctent_of_purchase: 10.50<br />factor(ntile_logUSD): 77\",\"factor(ntile_logTTP): 6<br />perctent_of_purchase: 13.16<br />factor(ntile_logUSD): 77\",\"factor(ntile_logTTP): 7<br />perctent_of_purchase: 11.96<br />factor(ntile_logUSD): 77\",\"factor(ntile_logTTP): 8<br />perctent_of_purchase: 10.53<br />factor(ntile_logUSD): 77\",\"factor(ntile_logTTP): 9<br />perctent_of_purchase:  8.37<br />factor(ntile_logUSD): 77\",\"factor(ntile_logTTP): 10<br />perctent_of_purchase:  8.13<br />factor(ntile_logUSD): 77\"],\"type\":\"bar\",\"textposition\":\"none\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(53,183,121,1)\",\"line\":{\"width\":1.88976377952756,\"color\":\"transparent\"}},\"name\":\"77\",\"legendgroup\":\"77\",\"showlegend\":true,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null},{\"orientation\":\"v\",\"width\":[0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.899999999999999,0.899999999999999,0.899999999999999],\"base\":[87.12,80.19,79.48,73.04,70.17,64.36,63.14,56.45,62.19,64.11],\"x\":[1,2,3,4,5,6,7,8,9,10],\"y\":[6.92,7.88,8.11000000000001,11.22,8.34999999999999,14.11,9.33,12.2,11.96,9.81],\"text\":[\"factor(ntile_logTTP): 1<br />perctent_of_purchase:  6.92<br />factor(ntile_logUSD): 96\",\"factor(ntile_logTTP): 2<br />perctent_of_purchase:  7.88<br />factor(ntile_logUSD): 96\",\"factor(ntile_logTTP): 3<br />perctent_of_purchase:  8.11<br />factor(ntile_logUSD): 96\",\"factor(ntile_logTTP): 4<br />perctent_of_purchase: 11.22<br />factor(ntile_logUSD): 96\",\"factor(ntile_logTTP): 5<br />perctent_of_purchase:  8.35<br />factor(ntile_logUSD): 96\",\"factor(ntile_logTTP): 6<br />perctent_of_purchase: 14.11<br />factor(ntile_logUSD): 96\",\"factor(ntile_logTTP): 7<br />perctent_of_purchase:  9.33<br />factor(ntile_logUSD): 96\",\"factor(ntile_logTTP): 8<br />perctent_of_purchase: 12.20<br />factor(ntile_logUSD): 96\",\"factor(ntile_logTTP): 9<br />perctent_of_purchase: 11.96<br />factor(ntile_logUSD): 96\",\"factor(ntile_logTTP): 10<br />perctent_of_purchase:  9.81<br />factor(ntile_logUSD): 96\"],\"type\":\"bar\",\"textposition\":\"none\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(109,205,89,1)\",\"line\":{\"width\":1.88976377952756,\"color\":\"transparent\"}},\"name\":\"96\",\"legendgroup\":\"96\",\"showlegend\":true,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null},{\"orientation\":\"v\",\"width\":[0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.899999999999999,0.899999999999999,0.899999999999999],\"base\":[94.04,88.07,87.59,84.26,78.52,78.47,72.47,68.65,74.15,73.92],\"x\":[1,2,3,4,5,6,7,8,9,10],\"y\":[4.3,6.92,6.67999999999999,8.11000000000001,11.46,10.29,11.96,15.79,12.92,11.48],\"text\":[\"factor(ntile_logTTP): 1<br />perctent_of_purchase:  4.30<br />factor(ntile_logUSD): 142\",\"factor(ntile_logTTP): 2<br />perctent_of_purchase:  6.92<br />factor(ntile_logUSD): 142\",\"factor(ntile_logTTP): 3<br />perctent_of_purchase:  6.68<br />factor(ntile_logUSD): 142\",\"factor(ntile_logTTP): 4<br />perctent_of_purchase:  8.11<br />factor(ntile_logUSD): 142\",\"factor(ntile_logTTP): 5<br />perctent_of_purchase: 11.46<br />factor(ntile_logUSD): 142\",\"factor(ntile_logTTP): 6<br />perctent_of_purchase: 10.29<br />factor(ntile_logUSD): 142\",\"factor(ntile_logTTP): 7<br />perctent_of_purchase: 11.96<br />factor(ntile_logUSD): 142\",\"factor(ntile_logTTP): 8<br />perctent_of_purchase: 15.79<br />factor(ntile_logUSD): 142\",\"factor(ntile_logTTP): 9<br />perctent_of_purchase: 12.92<br />factor(ntile_logUSD): 142\",\"factor(ntile_logTTP): 10<br />perctent_of_purchase: 11.48<br />factor(ntile_logUSD): 142\"],\"type\":\"bar\",\"textposition\":\"none\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(180,222,44,1)\",\"line\":{\"width\":1.88976377952756,\"color\":\"transparent\"}},\"name\":\"142\",\"legendgroup\":\"142\",\"showlegend\":true,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null},{\"orientation\":\"v\",\"width\":[0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.899999999999999,0.899999999999999,0.899999999999999],\"base\":[98.34,94.99,94.27,92.37,89.98,88.76,84.43,84.44,87.07,85.4],\"x\":[1,2,3,4,5,6,7,8,9,10],\"y\":[1.67,5.01000000000001,5.73,7.63999999999999,10.02,11.24,15.55,15.55,12.92,14.59],\"text\":[\"factor(ntile_logTTP): 1<br />perctent_of_purchase:  1.67<br />factor(ntile_logUSD): 1530\",\"factor(ntile_logTTP): 2<br />perctent_of_purchase:  5.01<br />factor(ntile_logUSD): 1530\",\"factor(ntile_logTTP): 3<br />perctent_of_purchase:  5.73<br />factor(ntile_logUSD): 1530\",\"factor(ntile_logTTP): 4<br />perctent_of_purchase:  7.64<br />factor(ntile_logUSD): 1530\",\"factor(ntile_logTTP): 5<br />perctent_of_purchase: 10.02<br />factor(ntile_logUSD): 1530\",\"factor(ntile_logTTP): 6<br />perctent_of_purchase: 11.24<br />factor(ntile_logUSD): 1530\",\"factor(ntile_logTTP): 7<br />perctent_of_purchase: 15.55<br />factor(ntile_logUSD): 1530\",\"factor(ntile_logTTP): 8<br />perctent_of_purchase: 15.55<br />factor(ntile_logUSD): 1530\",\"factor(ntile_logTTP): 9<br />perctent_of_purchase: 12.92<br />factor(ntile_logUSD): 1530\",\"factor(ntile_logTTP): 10<br />perctent_of_purchase: 14.59<br />factor(ntile_logUSD): 1530\"],\"type\":\"bar\",\"textposition\":\"none\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(253,231,37,1)\",\"line\":{\"width\":1.88976377952756,\"color\":\"transparent\"}},\"name\":\"1530\",\"legendgroup\":\"1530\",\"showlegend\":true,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null}],\"layout\":{\"margin\":{\"t\":43.7625570776256,\"r\":7.30593607305936,\"b\":53.8121123343786,\"l\":43.1050228310502},\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187},\"title\":{\"text\":\"Proportion of low- and high-revenue orders in increasingly longer sessions\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":17.5342465753425},\"x\":0,\"xref\":\"paper\"},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[0.4,10.6],\"tickmode\":\"array\",\"ticktext\":[\"00:05:46\",\"00:08:30\",\"00:11:20\",\"00:14:34\",\"00:18:57\",\"00:25:36\",\"00:36:07\",\"01:02:49\",\"02:56:40\",\"23:35:11\"],\"tickvals\":[1,2,3,4,5,6,7,8,9,10],\"categoryorder\":\"array\",\"categoryarray\":[\"00:05:46\",\"00:08:30\",\"00:11:20\",\"00:14:34\",\"00:18:57\",\"00:25:36\",\"00:36:07\",\"01:02:49\",\"02:56:40\",\"23:35:11\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.65296803652968,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-45,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"Session duration in hh:mm\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[-5.0005,105.0105],\"tickmode\":\"array\",\"ticktext\":[\"0\",\"25\",\"50\",\"75\",\"100\"],\"tickvals\":[0,25,50,75,100],\"categoryorder\":\"array\",\"categoryarray\":[\"0\",\"25\",\"50\",\"75\",\"100\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.65296803652968,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"Proportion of Purchases\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":null,\"line\":{\"color\":null,\"width\":0,\"linetype\":[]},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":true,\"legend\":{\"bgcolor\":null,\"bordercolor\":null,\"borderwidth\":0,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.689497716895},\"title\":{\"text\":\"ntile_logUSD\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}}},\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"e55a4a431b8\":{\"x\":{},\"y\":{},\"fill\":{},\"type\":\"bar\"}},\"cur_data\":\"e55a4a431b8\",\"visdat\":{\"e55a4a431b8\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n\n\n### Theshold TTP to 1 hour\nIf we wish to modify the range of TTP we consider, please enter the value of TTP in seconds below.\n\n::: {.cell}\n\n```{.r .fold-show .cell-code}\n# enter the desired value here to override the choice of 95% of TTP\nmaximum_TTP <- 3600\n\ndf_before_removing_extreme_TTP <- df\n\n# df <- df_before_removing_extreme_TTP\n\n# filter TTP < maximum_TTP and also create a column with its log\ndf <- df %>% \n filter(TTP <= maximum_TTP) %>% \n mutate(logTTP = log(TTP)) %>% \n relocate(TTP,logTTP)\n```\n:::\n\n\n:::\n\n<br>\n\n# Analysis\n\n\n\n\n\n<br>\n\n## Relationship with count of other events {.tabset}\n\nThere appear to be an association between TTP and some events, namely # of scrolls, page views, item views and user engagement. This is not surprising. However, such association is not straightforward: **users with short sessions record few events, while users with long sessions can record either few or many events**. Overall this is not an interesting finding.\n\nA better analysis of these associations should consider not only the number but also the _duration_ of the events. This will be explored in the future.\n\n::: {.panel-tabset}\n\n### TTP\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>%\n select(TTP, total_due, n_scrolls, n_page_view, n_user_engagement, n_view_item) %>% \n GGally::ggpairs()\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/ggpairs_TTP-1.png){width=672}\n:::\n:::\n\n\n\n### logTTP\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>%\n select(logTTP, total_due, n_scrolls, n_page_view, n_user_engagement, n_view_item) %>% \n GGally::ggpairs()\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/ggpairs_logTTP-1.png){width=672}\n:::\n:::\n\n\n\n\n:::\n\n<br>\n\n\n## User who buy ON SALE products have longer sessions {.tabset}\n\n![](imgs/store_categories.png)\n\n\nAbout **1 in 8 users buy goods which are in the ON SALE category of the webstore**. We hypothesized that people buying items on sale would have quicker sessions, speculating that the sale might not last long or other people might take advantage of that.\n\nInstead, exactly the opposite happens: **people who buy items on sale have overall longer sessions that people choosing items from categories with regular prices**.\n\nNB: The 'Sale' information is taken from the items added to the cart, not just from the page viewed. \n\n::: {.panel-tabset}\n\n### TTP for ON SALE vs. other categories \n\n::: {.cell}\n\n```{.r .cell-code}\nddf <- df %>% \n select(TTP, is_on_sale, total_due) %>%\n mutate(logTTP = log(TTP)) %>% \n mutate(is_on_sale = ifelse(is_on_sale == 0, \"regular_price\",\"on_sale\")) %>% \n mutate(is_on_sale = factor(is_on_sale)) \n\n\nggbetweenstats(\n   data = ddf,\n   x = is_on_sale,\n   y = TTP,\n   type = \"nonparametric\"\n) + scale_y_continuous(trans = \"log\", labels = function(x) seconds_to_period(round(x)))\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/TTP_items_on_sale-1.png){width=672}\n:::\n:::\n\n\n\n### Number of events in ON SALE vs regular price purchases\n\nThe longer session is not specifically linked to any kind of event, although a more accurate analysis would require to quantify the duration of different kind of events.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>% \n select(is_on_sale, n_scrolls, n_page_view, \n        n_view_item, n_user_engagement) %>%\n mutate(is_on_sale = ifelse(is_on_sale == 0, \"regular_price\",\"on_sale\")) %>% \n # mutate(is_on_sale = factor(is_on_sale)) %>% \n pivot_longer(cols = starts_with(\"n_\"), names_to = \"event_type\") %>% \n ggplot(aes(x = event_type, y = value, fill = is_on_sale)) +\n geom_boxplot() +\n theme_minimal() +\n labs(\n  title = \"Events for purchases on sale vs. with regular price\",\n  x = \"Type of event\", y = \"# of recorded events\"\n )\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\n### Revenues for ON SALE vs regular price\n\nInterestingly, people who buy items from the ON SALE section of the website **spend on average 25% more than from all the other categories**.\n\nNote: total_due values are limited to a max of 300 USD for clarity of visualization. \n\n::: {.cell}\n\n```{.r .cell-code}\nddf %>% \n # filter(total_due < 300) %>%\nggbetweenstats(\n x = is_on_sale,\n y = total_due,\n ylab = \"total due in US $\",\n type = \"nonparametric\"\n) + scale_y_continuous(trans = \"log\", labels = function(x) round(x))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\n```\n:::\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n\n### Order amount vs time for ON SALE and regular price\n\nThe fact that people who choose the ON SALE category spend more is true for sessions of almost all durations\n\n\n::: {.cell}\n\n```{.r .cell-code}\nddf %>%\n mutate(qtile_logTTP = ntile(logTTP, 10)) %>%\n group_by(qtile_logTTP) %>% \n mutate(median_qtile_logTTP = median(logTTP)) %>%\n ungroup() %>% \n group_by(is_on_sale,median_qtile_logTTP) %>% \n reframe(\n  is_on_sale = unique(is_on_sale),\n  median_qtile_logTTP = unique(median_qtile_logTTP) %>% exp %>% round,\n  median_total_due = median(total_due)\n ) %>% \n ggplot(aes(x = median_qtile_logTTP, y = median_total_due, color = is_on_sale)) +\n  geom_line() +\n  geom_point(size = 1.5, shape = 16) +\n  # scale_x_continuous(breaks = x_breaks, labels = x_labels) +\n  labs(title = \"Total Due vs LogTTP Decile\",\n       x = \"TTP\",\n       y = \"Total Due\") +\n  theme_minimal() +\n  scale_x_continuous(trans = \"hms\") -> gg\n\nggplotly(gg)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"plotly html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-98920e0a5cb53d801c2d\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-98920e0a5cb53d801c2d\">{\"x\":{\"data\":[{\"x\":[242,380,507,644,780,954,1199,1520,1932,2808],\"y\":[40,37.5,48,38,48,55,63.5,57,66,83.5],\"text\":[\"median_qtile_logTTP:  242<br />median_total_due: 40.0<br />is_on_sale: on_sale\",\"median_qtile_logTTP:  380<br />median_total_due: 37.5<br />is_on_sale: on_sale\",\"median_qtile_logTTP:  507<br />median_total_due: 48.0<br />is_on_sale: on_sale\",\"median_qtile_logTTP:  644<br />median_total_due: 38.0<br />is_on_sale: on_sale\",\"median_qtile_logTTP:  780<br />median_total_due: 48.0<br />is_on_sale: on_sale\",\"median_qtile_logTTP:  954<br />median_total_due: 55.0<br />is_on_sale: on_sale\",\"median_qtile_logTTP: 1199<br />median_total_due: 63.5<br />is_on_sale: on_sale\",\"median_qtile_logTTP: 1520<br />median_total_due: 57.0<br />is_on_sale: on_sale\",\"median_qtile_logTTP: 1932<br />median_total_due: 66.0<br />is_on_sale: on_sale\",\"median_qtile_logTTP: 2808<br />median_total_due: 83.5<br />is_on_sale: on_sale\"],\"type\":\"scatter\",\"mode\":\"lines+markers\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(248,118,109,1)\",\"dash\":\"solid\"},\"hoveron\":\"points\",\"name\":\"on_sale\",\"legendgroup\":\"on_sale\",\"showlegend\":true,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(248,118,109,1)\",\"opacity\":1,\"size\":5.66929133858268,\"symbol\":\"circle\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(248,118,109,1)\"}},\"frame\":null},{\"x\":[242,380,507,644,780,954,1199,1520,1932,2808],\"y\":[30,40.5,40,43,50,51,55,58,55,62],\"text\":[\"median_qtile_logTTP:  242<br />median_total_due: 30.0<br />is_on_sale: regular_price\",\"median_qtile_logTTP:  380<br />median_total_due: 40.5<br />is_on_sale: regular_price\",\"median_qtile_logTTP:  507<br />median_total_due: 40.0<br />is_on_sale: regular_price\",\"median_qtile_logTTP:  644<br />median_total_due: 43.0<br />is_on_sale: regular_price\",\"median_qtile_logTTP:  780<br />median_total_due: 50.0<br />is_on_sale: regular_price\",\"median_qtile_logTTP:  954<br />median_total_due: 51.0<br />is_on_sale: regular_price\",\"median_qtile_logTTP: 1199<br />median_total_due: 55.0<br />is_on_sale: regular_price\",\"median_qtile_logTTP: 1520<br />median_total_due: 58.0<br />is_on_sale: regular_price\",\"median_qtile_logTTP: 1932<br />median_total_due: 55.0<br />is_on_sale: regular_price\",\"median_qtile_logTTP: 2808<br />median_total_due: 62.0<br />is_on_sale: regular_price\"],\"type\":\"scatter\",\"mode\":\"lines+markers\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(0,191,196,1)\",\"dash\":\"solid\"},\"hoveron\":\"points\",\"name\":\"regular_price\",\"legendgroup\":\"regular_price\",\"showlegend\":true,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(0,191,196,1)\",\"opacity\":1,\"size\":5.66929133858268,\"symbol\":\"circle\",\"line\":{\"width\":1.88976377952756,\"color\":\"rgba(0,191,196,1)\"}},\"frame\":null}],\"layout\":{\"margin\":{\"t\":43.7625570776256,\"r\":7.30593607305936,\"b\":40.1826484018265,\"l\":37.2602739726027},\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187},\"title\":{\"text\":\"Total Due vs LogTTP Decile\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":17.5342465753425},\"x\":0,\"xref\":\"paper\"},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[113.7,2936.3],\"tickmode\":\"array\",\"ticktext\":[\"00:10:00\",\"00:20:00\",\"00:30:00\",\"00:40:00\"],\"tickvals\":[600,1200,1800,2400],\"categoryorder\":\"array\",\"categoryarray\":[\"00:10:00\",\"00:20:00\",\"00:30:00\",\"00:40:00\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.65296803652968,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"TTP\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[27.325,86.175],\"tickmode\":\"array\",\"ticktext\":[\"30\",\"40\",\"50\",\"60\",\"70\",\"80\"],\"tickvals\":[30,40,50,60,70,80],\"categoryorder\":\"array\",\"categoryarray\":[\"30\",\"40\",\"50\",\"60\",\"70\",\"80\"],\"nticks\":null,\"ticks\":\"\",\"tickcolor\":null,\"ticklen\":3.65296803652968,\"tickwidth\":0,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.689497716895},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.66417600664176,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"Total Due\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":null,\"line\":{\"color\":null,\"width\":0,\"linetype\":[]},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":true,\"legend\":{\"bgcolor\":null,\"bordercolor\":null,\"borderwidth\":0,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.689497716895},\"title\":{\"text\":\"is_on_sale\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.6118721461187}}},\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"e55a58fd79c4\":{\"x\":{},\"y\":{},\"colour\":{},\"type\":\"scatter\"},\"e55a69456080\":{\"x\":{},\"y\":{},\"colour\":{}}},\"cur_data\":\"e55a58fd79c4\",\"visdat\":{\"e55a58fd79c4\":[\"function (y) \",\"x\"],\"e55a69456080\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n:::\n\n<br>\n\n\n## Returning customers are (slightly) faster to purchase {.tabset}\nThe range of session length for returning customers is comparable to new customers, however on average they spend a few minutes less (~ 4 minutes) on the website.\n\n\n::: {.panel-tabset}\n\n### Returning customers TTP\n\n\n::: {.cell}\n\n```{.r .cell-code}\nddf <- df %>% \n select(TTP, logTTP, user_pseudo_id, event_date, total_due) %>%\n mutate(log_total_due = log(total_due)) %>% \n group_by(user_pseudo_id) %>% \n mutate(is_returning_customer = ifelse( event_date == min(event_date), 0, 1 )) %>% \n ungroup()\n\nggbetweenstats(\n data = ddf,\n x = is_returning_customer,\n y = TTP,\n type = \"nonparametric\"\n) + scale_y_continuous(labels = function(x) round(seconds_to_period(x)))\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/returning_customers_TTP-1.png){width=672}\n:::\n:::\n\n\n\n### Returning customers events\n\nOverall returning customers spend less time on any event, however the difference is not substantial.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>% \n group_by(user_pseudo_id) %>% \n mutate(is_returning_customer = ifelse( event_date == min(event_date), \"new_customer\", \"returning_customer\" )) %>%\n mutate(is_returning_customer = factor(is_returning_customer)) %>% \n ungroup() %>% \n select(is_returning_customer, n_scrolls, n_page_view, \n        n_view_item, n_user_engagement) %>%\n pivot_longer(cols = starts_with(\"n_\"), names_to = \"event_type\") %>% \n ggplot(aes(x = event_type, y = value, fill = is_returning_customer)) +\n geom_boxplot() +\n theme_minimal() +\n labs(\n  title = \"Events for purchases on sale vs. with regular price\",\n  x = \"Type of event\", y = \"# of recorded events\"\n )\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n\n\n### Returning customers order amount\n\nAs an additional information, **returning customers do _NOT_ spend more than new customers**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggbetweenstats(\n data = ddf,\n x = is_returning_customer,\n y = total_due,\n type = \"nonparametric\"\n) + scale_y_continuous(trans = \"log\", labels = function(x) round(x))\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/returning_customers_order_amount-1.png){width=672}\n:::\n:::\n\n\n\n:::\n\n<br>\n\n\n## Mobile/Destop and browser type have no effect on TTP {.tabset}\n\n::: {.panel-tabset}\n\n### No effect of mobile/desktop device\n\n::: {.cell}\n\n```{.r .cell-code}\nddf <- df %>%\n select(TTP, device, total_due) %>% \n mutate(logTTP = log(TTP)) %>% \n filter(device != \"tablet\")\n\n\nggbetweenstats(\n data = ddf,\n x = device,\n y = TTP,\n type = \"nonparametric\"\n) + scale_y_continuous(labels = function(x) seconds_to_period(x))\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/mobile_desktop-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggbetweenstats(\n data = ddf,\n x = device,\n y = total_due,\n ylab = \"total due in US$\",\n type = \"nonparametric\"\n) + scale_y_continuous(\n trans = \"log\", labels = function(x) format(round(x))\n)\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/mobile_desktop-2.png){width=672}\n:::\n:::\n\n\n\n### No effect of browser type\n\n::: {.cell}\n\n```{.r .cell-code}\nddf <- df %>%\n select(TTP, browser, total_due) %>% \n mutate(logTTP = log(TTP)) %>% \n filter(browser %in% c(\"Chrome\",\"Safari\"))\n\n\nggbetweenstats(\n data = ddf,\n x = browser,\n y = TTP,\n type = \"nonparametric\"\n) + scale_y_continuous(labels = function(x) seconds_to_period(x))\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/browser_type-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggbetweenstats(\n data = ddf,\n x = browser,\n y = total_due,\n ylab = \"total due in US$\",\n type = \"nonparametric\"\n) + scale_y_continuous(\n trans = \"log\", labels = function(x) format(round(x))\n)\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/browser_type-2.png){width=672}\n:::\n:::\n\n\n\n<br>\n\n## Effect of referrals {.tabset}\n\nPurchases from referral links are slightly faster, but the effect is not substantial (~ 1 minute faster).\n\n### Referrals TTP\n\n\n::: {.cell}\n\n```{.r .cell-code}\nddf <- df %>%\n ungroup() %>% \n select(TTP,campaign,total_due) %>%\n mutate(logTTP = log(TTP)) %>% \n mutate(campaign = as.character(campaign)) %>% \n mutate(campaign = ifelse(is.na(campaign),\"(none)\",campaign)) %>% \n filter(campaign %in% c(\"(none)\",\"(referral)\"))\n # group_by(campaign) %>% \n # count()\n\nggbetweenstats(\n data = ddf,\n x = campaign,\n y = TTP,\n type = \"nonparametric\"\n) + scale_y_continuous(labels = function(x) seconds_to_period(x))\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/referrals_TTP-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# df$campaign %>% unique\n```\n:::\n\n\n\n### Referrals order amount\n\nAs an additional information, **returning customers do _NOT_ spend more than new customers**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggbetweenstats(\n data = ddf,\n x = campaign,\n y = total_due,\n ylab = \"total due in US$\",\n type = \"nonparametric\"\n) + scale_y_continuous(\n trans = \"log\", labels = function(x) format(round(x))\n)\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/referrals_order_amount-1.png){width=672}\n:::\n:::\n\n\n:::\n\n<br>\n\n## Seasonality {.tabset}\n\n::: {.panel-tabset}\n\n### Day level\n\n::: {.cell}\n\n```{.r .cell-code}\n# df %>%\n#  select(TTP,event_date) %>%\n#  group_by(event_date) %>% \n#  reframe(\n#   median_TTP = median(TTP),\n#   MAD_TTP = mad(TTP)\n#  ) %>% \n#  ggplot(aes(x = event_date, y = median_TTP)) +\n#  geom_line() +\n#   geom_ribbon(\n#    aes(ymin = median_TTP - MAD_TTP, ymax = median_TTP + MAD_TTP), \n#    fill = \"lightblue\", alpha = 0.5\n#   ) +\n#  theme_minimal() +\n#  theme(axis.text.x = element_text(angle = 90, hjust = 1)) -> gg\n# \n# gg\n# ggplotly(gg)\n\n\n\nddf <- df %>%\n select(TTP,event_date) %>%\n group_by(event_date) %>%\n reframe(\n  median_TTP = median(TTP),\n  MAD_TTP = mad(TTP),\n  MAD_low = floor(median(TTP) - mad(TTP)),\n  MAD_high = ceiling(median(TTP) + mad(TTP))\n )\n\nddf %>% \n  hchart(type = \"line\", hcaes(x = event_date, y = median_TTP), name = \"median TTP\") %>%\n  hc_add_series(\n   data = ddf, type = \"arearange\", name = \"MAD\", \n   hcaes(x = event_date, low = MAD_low, high = MAD_high),\n   color = \"lightblue\", opacity = 0.5 \n  ) %>%\n  hc_xAxis(type = \"datetime\") %>%\n  hc_chart(zoomType = \"x\") %>%\n  hc_tooltip(shared = TRUE) %>% \n  hc_title(text = \"TTP Range per day\") \n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"highchart html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-34e06c5499200defb465\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-34e06c5499200defb465\">{\"x\":{\"hc_opts\":{\"chart\":{\"reflow\":true,\"zoomType\":\"x\"},\"title\":{\"text\":\"TTP Range per day\"},\"yAxis\":{\"title\":{\"text\":\"median_TTP\"},\"type\":\"linear\"},\"credits\":{\"enabled\":false},\"exporting\":{\"enabled\":false},\"boost\":{\"enabled\":false},\"plotOptions\":{\"series\":{\"label\":{\"enabled\":false},\"turboThreshold\":0,\"showInLegend\":false},\"treemap\":{\"layoutAlgorithm\":\"squarified\"},\"scatter\":{\"marker\":{\"symbol\":\"circle\"}}},\"series\":[{\"group\":\"group\",\"data\":[{\"event_date\":\"2020-11-01\",\"median_TTP\":844,\"MAD_TTP\":360.2718,\"MAD_low\":483,\"MAD_high\":1205,\"x\":1604188800000,\"y\":844},{\"event_date\":\"2020-11-02\",\"median_TTP\":672,\"MAD_TTP\":188.2902,\"MAD_low\":483,\"MAD_high\":861,\"x\":1604275200000,\"y\":672},{\"event_date\":\"2020-11-03\",\"median_TTP\":885,\"MAD_TTP\":616.7616,\"MAD_low\":268,\"MAD_high\":1502,\"x\":1604361600000,\"y\":885},{\"event_date\":\"2020-11-04\",\"median_TTP\":1168.5,\"MAD_TTP\":938.4858,\"MAD_low\":230,\"MAD_high\":2107,\"x\":1604448000000,\"y\":1168.5},{\"event_date\":\"2020-11-05\",\"median_TTP\":981,\"MAD_TTP\":524.8404,\"MAD_low\":456,\"MAD_high\":1506,\"x\":1604534400000,\"y\":981},{\"event_date\":\"2020-11-06\",\"median_TTP\":1167,\"MAD_TTP\":736.8522,\"MAD_low\":430,\"MAD_high\":1904,\"x\":1604620800000,\"y\":1167},{\"event_date\":\"2020-11-07\",\"median_TTP\":963.5,\"MAD_TTP\":636.7767,\"MAD_low\":326,\"MAD_high\":1601,\"x\":1604707200000,\"y\":963.5},{\"event_date\":\"2020-11-08\",\"median_TTP\":640,\"MAD_TTP\":517.4274,\"MAD_low\":122,\"MAD_high\":1158,\"x\":1604793600000,\"y\":640},{\"event_date\":\"2020-11-09\",\"median_TTP\":606.5,\"MAD_TTP\":435.8844,\"MAD_low\":170,\"MAD_high\":1043,\"x\":1604880000000,\"y\":606.5},{\"event_date\":\"2020-11-10\",\"median_TTP\":724,\"MAD_TTP\":594.5226,\"MAD_low\":129,\"MAD_high\":1319,\"x\":1604966400000,\"y\":724},{\"event_date\":\"2020-11-11\",\"median_TTP\":833,\"MAD_TTP\":558.9402,\"MAD_low\":274,\"MAD_high\":1392,\"x\":1605052800000,\"y\":833},{\"event_date\":\"2020-11-12\",\"median_TTP\":798.5,\"MAD_TTP\":693.8568,\"MAD_low\":104,\"MAD_high\":1493,\"x\":1605139200000,\"y\":798.5},{\"event_date\":\"2020-11-13\",\"median_TTP\":773.5,\"MAD_TTP\":510.0144,\"MAD_low\":263,\"MAD_high\":1284,\"x\":1605225600000,\"y\":773.5},{\"event_date\":\"2020-11-14\",\"median_TTP\":1092.5,\"MAD_TTP\":856.2015,\"MAD_low\":236,\"MAD_high\":1949,\"x\":1605312000000,\"y\":1092.5},{\"event_date\":\"2020-11-15\",\"median_TTP\":768,\"MAD_TTP\":607.866,\"MAD_low\":160,\"MAD_high\":1376,\"x\":1605398400000,\"y\":768},{\"event_date\":\"2020-11-16\",\"median_TTP\":896,\"MAD_TTP\":573.7662,\"MAD_low\":322,\"MAD_high\":1470,\"x\":1605484800000,\"y\":896},{\"event_date\":\"2020-11-17\",\"median_TTP\":690,\"MAD_TTP\":423.2823,\"MAD_low\":266,\"MAD_high\":1114,\"x\":1605571200000,\"y\":690},{\"event_date\":\"2020-11-18\",\"median_TTP\":856,\"MAD_TTP\":558.9402,\"MAD_low\":297,\"MAD_high\":1415,\"x\":1605657600000,\"y\":856},{\"event_date\":\"2020-11-19\",\"median_TTP\":821.5,\"MAD_TTP\":467.019,\"MAD_low\":354,\"MAD_high\":1289,\"x\":1605744000000,\"y\":821.5},{\"event_date\":\"2020-11-20\",\"median_TTP\":864.5,\"MAD_TTP\":553.7511,\"MAD_low\":310,\"MAD_high\":1419,\"x\":1605830400000,\"y\":864.5},{\"event_date\":\"2020-11-21\",\"median_TTP\":854.5,\"MAD_TTP\":707.9415,\"MAD_low\":146,\"MAD_high\":1563,\"x\":1605916800000,\"y\":854.5},{\"event_date\":\"2020-11-22\",\"median_TTP\":861.5,\"MAD_TTP\":541.8903,\"MAD_low\":319,\"MAD_high\":1404,\"x\":1606003200000,\"y\":861.5},{\"event_date\":\"2020-11-23\",\"median_TTP\":802,\"MAD_TTP\":560.4228,\"MAD_low\":241,\"MAD_high\":1363,\"x\":1606089600000,\"y\":802},{\"event_date\":\"2020-11-24\",\"median_TTP\":693,\"MAD_TTP\":591.5574,\"MAD_low\":101,\"MAD_high\":1285,\"x\":1606176000000,\"y\":693},{\"event_date\":\"2020-11-25\",\"median_TTP\":947,\"MAD_TTP\":954.7944,\"MAD_low\":-8,\"MAD_high\":1902,\"x\":1606262400000,\"y\":947},{\"event_date\":\"2020-11-26\",\"median_TTP\":833,\"MAD_TTP\":504.084,\"MAD_low\":328,\"MAD_high\":1338,\"x\":1606348800000,\"y\":833},{\"event_date\":\"2020-11-27\",\"median_TTP\":972.5,\"MAD_TTP\":660.4983,\"MAD_low\":312,\"MAD_high\":1633,\"x\":1606435200000,\"y\":972.5},{\"event_date\":\"2020-11-28\",\"median_TTP\":990,\"MAD_TTP\":754.6434,\"MAD_low\":235,\"MAD_high\":1745,\"x\":1606521600000,\"y\":990},{\"event_date\":\"2020-11-29\",\"median_TTP\":866,\"MAD_TTP\":739.8174,\"MAD_low\":126,\"MAD_high\":1606,\"x\":1606608000000,\"y\":866},{\"event_date\":\"2020-11-30\",\"median_TTP\":1136,\"MAD_TTP\":805.0518,\"MAD_low\":330,\"MAD_high\":1942,\"x\":1606694400000,\"y\":1136},{\"event_date\":\"2020-12-01\",\"median_TTP\":1037,\"MAD_TTP\":909.5751,\"MAD_low\":127,\"MAD_high\":1947,\"x\":1606780800000,\"y\":1037},{\"event_date\":\"2020-12-02\",\"median_TTP\":807,\"MAD_TTP\":573.7662,\"MAD_low\":233,\"MAD_high\":1381,\"x\":1606867200000,\"y\":807},{\"event_date\":\"2020-12-03\",\"median_TTP\":757,\"MAD_TTP\":710.1654,\"MAD_low\":46,\"MAD_high\":1468,\"x\":1606953600000,\"y\":757},{\"event_date\":\"2020-12-04\",\"median_TTP\":841,\"MAD_TTP\":793.191,\"MAD_low\":47,\"MAD_high\":1635,\"x\":1607040000000,\"y\":841},{\"event_date\":\"2020-12-05\",\"median_TTP\":1062,\"MAD_TTP\":775.3998,\"MAD_low\":286,\"MAD_high\":1838,\"x\":1607126400000,\"y\":1062},{\"event_date\":\"2020-12-06\",\"median_TTP\":728,\"MAD_TTP\":475.9146,\"MAD_low\":252,\"MAD_high\":1204,\"x\":1607212800000,\"y\":728},{\"event_date\":\"2020-12-07\",\"median_TTP\":950,\"MAD_TTP\":720.5436,\"MAD_low\":229,\"MAD_high\":1671,\"x\":1607299200000,\"y\":950},{\"event_date\":\"2020-12-08\",\"median_TTP\":874,\"MAD_TTP\":720.5436,\"MAD_low\":153,\"MAD_high\":1595,\"x\":1607385600000,\"y\":874},{\"event_date\":\"2020-12-09\",\"median_TTP\":1134,\"MAD_TTP\":871.7688,\"MAD_low\":262,\"MAD_high\":2006,\"x\":1607472000000,\"y\":1134},{\"event_date\":\"2020-12-10\",\"median_TTP\":839,\"MAD_TTP\":649.3788,\"MAD_low\":189,\"MAD_high\":1489,\"x\":1607558400000,\"y\":839},{\"event_date\":\"2020-12-11\",\"median_TTP\":875,\"MAD_TTP\":693.8568,\"MAD_low\":181,\"MAD_high\":1569,\"x\":1607644800000,\"y\":875},{\"event_date\":\"2020-12-12\",\"median_TTP\":992.5,\"MAD_TTP\":972.5856,\"MAD_low\":19,\"MAD_high\":1966,\"x\":1607731200000,\"y\":992.5},{\"event_date\":\"2020-12-13\",\"median_TTP\":954,\"MAD_TTP\":469.9842,\"MAD_low\":484,\"MAD_high\":1424,\"x\":1607817600000,\"y\":954},{\"event_date\":\"2020-12-14\",\"median_TTP\":1183,\"MAD_TTP\":941.451,\"MAD_low\":241,\"MAD_high\":2125,\"x\":1607904000000,\"y\":1183},{\"event_date\":\"2020-12-15\",\"median_TTP\":959,\"MAD_TTP\":787.2606,\"MAD_low\":171,\"MAD_high\":1747,\"x\":1607990400000,\"y\":959},{\"event_date\":\"2020-12-16\",\"median_TTP\":1007,\"MAD_TTP\":730.9218,\"MAD_low\":276,\"MAD_high\":1738,\"x\":1608076800000,\"y\":1007},{\"event_date\":\"2020-12-17\",\"median_TTP\":788,\"MAD_TTP\":524.0991,\"MAD_low\":263,\"MAD_high\":1313,\"x\":1608163200000,\"y\":788},{\"event_date\":\"2020-12-18\",\"median_TTP\":812.5,\"MAD_TTP\":708.6828,\"MAD_low\":103,\"MAD_high\":1522,\"x\":1608249600000,\"y\":812.5},{\"event_date\":\"2020-12-19\",\"median_TTP\":869,\"MAD_TTP\":591.5574,\"MAD_low\":277,\"MAD_high\":1461,\"x\":1608336000000,\"y\":869},{\"event_date\":\"2020-12-20\",\"median_TTP\":616.5,\"MAD_TTP\":326.9133,\"MAD_low\":289,\"MAD_high\":944,\"x\":1608422400000,\"y\":616.5},{\"event_date\":\"2020-12-21\",\"median_TTP\":853,\"MAD_TTP\":535.2186,\"MAD_low\":317,\"MAD_high\":1389,\"x\":1608508800000,\"y\":853},{\"event_date\":\"2020-12-22\",\"median_TTP\":835,\"MAD_TTP\":686.4438,\"MAD_low\":148,\"MAD_high\":1522,\"x\":1608595200000,\"y\":835},{\"event_date\":\"2020-12-23\",\"median_TTP\":940,\"MAD_TTP\":754.6434,\"MAD_low\":185,\"MAD_high\":1695,\"x\":1608681600000,\"y\":940},{\"event_date\":\"2020-12-24\",\"median_TTP\":928.5,\"MAD_TTP\":692.3742,\"MAD_low\":236,\"MAD_high\":1621,\"x\":1608768000000,\"y\":928.5},{\"event_date\":\"2020-12-25\",\"median_TTP\":806.5,\"MAD_TTP\":397.3368,\"MAD_low\":409,\"MAD_high\":1204,\"x\":1608854400000,\"y\":806.5},{\"event_date\":\"2020-12-26\",\"median_TTP\":1156,\"MAD_TTP\":1140.1194,\"MAD_low\":15,\"MAD_high\":2297,\"x\":1608940800000,\"y\":1156},{\"event_date\":\"2020-12-27\",\"median_TTP\":625.5,\"MAD_TTP\":495.9297,\"MAD_low\":129,\"MAD_high\":1122,\"x\":1609027200000,\"y\":625.5},{\"event_date\":\"2020-12-28\",\"median_TTP\":928,\"MAD_TTP\":607.866,\"MAD_low\":320,\"MAD_high\":1536,\"x\":1609113600000,\"y\":928},{\"event_date\":\"2020-12-29\",\"median_TTP\":631,\"MAD_TTP\":517.4274,\"MAD_low\":113,\"MAD_high\":1149,\"x\":1609200000000,\"y\":631},{\"event_date\":\"2020-12-30\",\"median_TTP\":914.5,\"MAD_TTP\":604.9008,\"MAD_low\":309,\"MAD_high\":1520,\"x\":1609286400000,\"y\":914.5},{\"event_date\":\"2020-12-31\",\"median_TTP\":626,\"MAD_TTP\":498.1536,\"MAD_low\":127,\"MAD_high\":1125,\"x\":1609372800000,\"y\":626},{\"event_date\":\"2021-01-01\",\"median_TTP\":1669,\"MAD_TTP\":802.0866,\"MAD_low\":866,\"MAD_high\":2472,\"x\":1609459200000,\"y\":1669},{\"event_date\":\"2021-01-02\",\"median_TTP\":1050,\"MAD_TTP\":655.3092,\"MAD_low\":394,\"MAD_high\":1706,\"x\":1609545600000,\"y\":1050},{\"event_date\":\"2021-01-03\",\"median_TTP\":653,\"MAD_TTP\":504.084,\"MAD_low\":148,\"MAD_high\":1158,\"x\":1609632000000,\"y\":653},{\"event_date\":\"2021-01-04\",\"median_TTP\":865.5,\"MAD_TTP\":364.7196,\"MAD_low\":500,\"MAD_high\":1231,\"x\":1609718400000,\"y\":865.5},{\"event_date\":\"2021-01-05\",\"median_TTP\":755,\"MAD_TTP\":395.8542,\"MAD_low\":359,\"MAD_high\":1151,\"x\":1609804800000,\"y\":755},{\"event_date\":\"2021-01-06\",\"median_TTP\":691,\"MAD_TTP\":590.0748,\"MAD_low\":100,\"MAD_high\":1282,\"x\":1609891200000,\"y\":691},{\"event_date\":\"2021-01-07\",\"median_TTP\":820.5,\"MAD_TTP\":716.8371,\"MAD_low\":103,\"MAD_high\":1538,\"x\":1609977600000,\"y\":820.5},{\"event_date\":\"2021-01-08\",\"median_TTP\":760,\"MAD_TTP\":458.8647,\"MAD_low\":301,\"MAD_high\":1219,\"x\":1610064000000,\"y\":760},{\"event_date\":\"2021-01-09\",\"median_TTP\":824,\"MAD_TTP\":605.6421,\"MAD_low\":218,\"MAD_high\":1430,\"x\":1610150400000,\"y\":824},{\"event_date\":\"2021-01-10\",\"median_TTP\":1653.5,\"MAD_TTP\":1386.231,\"MAD_low\":267,\"MAD_high\":3040,\"x\":1610236800000,\"y\":1653.5},{\"event_date\":\"2021-01-11\",\"median_TTP\":709.5,\"MAD_TTP\":583.4031,\"MAD_low\":126,\"MAD_high\":1293,\"x\":1610323200000,\"y\":709.5},{\"event_date\":\"2021-01-12\",\"median_TTP\":910.5,\"MAD_TTP\":571.5423,\"MAD_low\":338,\"MAD_high\":1483,\"x\":1610409600000,\"y\":910.5},{\"event_date\":\"2021-01-13\",\"median_TTP\":820,\"MAD_TTP\":643.4484,\"MAD_low\":176,\"MAD_high\":1464,\"x\":1610496000000,\"y\":820},{\"event_date\":\"2021-01-14\",\"median_TTP\":723,\"MAD_TTP\":517.4274,\"MAD_low\":205,\"MAD_high\":1241,\"x\":1610582400000,\"y\":723},{\"event_date\":\"2021-01-15\",\"median_TTP\":868,\"MAD_TTP\":587.1096,\"MAD_low\":280,\"MAD_high\":1456,\"x\":1610668800000,\"y\":868},{\"event_date\":\"2021-01-16\",\"median_TTP\":1047,\"MAD_TTP\":567.0945,\"MAD_low\":479,\"MAD_high\":1615,\"x\":1610755200000,\"y\":1047},{\"event_date\":\"2021-01-17\",\"median_TTP\":516,\"MAD_TTP\":250.5594,\"MAD_low\":265,\"MAD_high\":767,\"x\":1610841600000,\"y\":516},{\"event_date\":\"2021-01-18\",\"median_TTP\":874,\"MAD_TTP\":625.6572,\"MAD_low\":248,\"MAD_high\":1500,\"x\":1610928000000,\"y\":874},{\"event_date\":\"2021-01-19\",\"median_TTP\":843,\"MAD_TTP\":486.2928,\"MAD_low\":356,\"MAD_high\":1330,\"x\":1611014400000,\"y\":843},{\"event_date\":\"2021-01-20\",\"median_TTP\":898,\"MAD_TTP\":788.7432,\"MAD_low\":109,\"MAD_high\":1687,\"x\":1611100800000,\"y\":898},{\"event_date\":\"2021-01-21\",\"median_TTP\":982,\"MAD_TTP\":781.3302,\"MAD_low\":200,\"MAD_high\":1764,\"x\":1611187200000,\"y\":982},{\"event_date\":\"2021-01-22\",\"median_TTP\":769.5,\"MAD_TTP\":434.4018,\"MAD_low\":335,\"MAD_high\":1204,\"x\":1611273600000,\"y\":769.5},{\"event_date\":\"2021-01-23\",\"median_TTP\":820,\"MAD_TTP\":474.432,\"MAD_low\":345,\"MAD_high\":1295,\"x\":1611360000000,\"y\":820},{\"event_date\":\"2021-01-24\",\"median_TTP\":718,\"MAD_TTP\":579.6966,\"MAD_low\":138,\"MAD_high\":1298,\"x\":1611446400000,\"y\":718},{\"event_date\":\"2021-01-25\",\"median_TTP\":783.5,\"MAD_TTP\":444.0387,\"MAD_low\":339,\"MAD_high\":1228,\"x\":1611532800000,\"y\":783.5},{\"event_date\":\"2021-01-26\",\"median_TTP\":761,\"MAD_TTP\":299.4852,\"MAD_low\":461,\"MAD_high\":1061,\"x\":1611619200000,\"y\":761},{\"event_date\":\"2021-01-27\",\"median_TTP\":420.5,\"MAD_TTP\":289.8483,\"MAD_low\":130,\"MAD_high\":711,\"x\":1611705600000,\"y\":420.5},{\"event_date\":\"2021-01-28\",\"median_TTP\":375,\"MAD_TTP\":214.977,\"MAD_low\":160,\"MAD_high\":590,\"x\":1611792000000,\"y\":375},{\"event_date\":\"2021-01-29\",\"median_TTP\":551.5,\"MAD_TTP\":477.3972,\"MAD_low\":74,\"MAD_high\":1029,\"x\":1611878400000,\"y\":551.5},{\"event_date\":\"2021-01-30\",\"median_TTP\":777.5,\"MAD_TTP\":504.084,\"MAD_low\":273,\"MAD_high\":1282,\"x\":1611964800000,\"y\":777.5}],\"type\":\"line\",\"name\":\"median TTP\"},{\"group\":\"group\",\"data\":[{\"event_date\":\"2020-11-01\",\"median_TTP\":844,\"MAD_TTP\":360.2718,\"MAD_low\":483,\"MAD_high\":1205,\"x\":1604188800000,\"low\":483,\"high\":1205},{\"event_date\":\"2020-11-02\",\"median_TTP\":672,\"MAD_TTP\":188.2902,\"MAD_low\":483,\"MAD_high\":861,\"x\":1604275200000,\"low\":483,\"high\":861},{\"event_date\":\"2020-11-03\",\"median_TTP\":885,\"MAD_TTP\":616.7616,\"MAD_low\":268,\"MAD_high\":1502,\"x\":1604361600000,\"low\":268,\"high\":1502},{\"event_date\":\"2020-11-04\",\"median_TTP\":1168.5,\"MAD_TTP\":938.4858,\"MAD_low\":230,\"MAD_high\":2107,\"x\":1604448000000,\"low\":230,\"high\":2107},{\"event_date\":\"2020-11-05\",\"median_TTP\":981,\"MAD_TTP\":524.8404,\"MAD_low\":456,\"MAD_high\":1506,\"x\":1604534400000,\"low\":456,\"high\":1506},{\"event_date\":\"2020-11-06\",\"median_TTP\":1167,\"MAD_TTP\":736.8522,\"MAD_low\":430,\"MAD_high\":1904,\"x\":1604620800000,\"low\":430,\"high\":1904},{\"event_date\":\"2020-11-07\",\"median_TTP\":963.5,\"MAD_TTP\":636.7767,\"MAD_low\":326,\"MAD_high\":1601,\"x\":1604707200000,\"low\":326,\"high\":1601},{\"event_date\":\"2020-11-08\",\"median_TTP\":640,\"MAD_TTP\":517.4274,\"MAD_low\":122,\"MAD_high\":1158,\"x\":1604793600000,\"low\":122,\"high\":1158},{\"event_date\":\"2020-11-09\",\"median_TTP\":606.5,\"MAD_TTP\":435.8844,\"MAD_low\":170,\"MAD_high\":1043,\"x\":1604880000000,\"low\":170,\"high\":1043},{\"event_date\":\"2020-11-10\",\"median_TTP\":724,\"MAD_TTP\":594.5226,\"MAD_low\":129,\"MAD_high\":1319,\"x\":1604966400000,\"low\":129,\"high\":1319},{\"event_date\":\"2020-11-11\",\"median_TTP\":833,\"MAD_TTP\":558.9402,\"MAD_low\":274,\"MAD_high\":1392,\"x\":1605052800000,\"low\":274,\"high\":1392},{\"event_date\":\"2020-11-12\",\"median_TTP\":798.5,\"MAD_TTP\":693.8568,\"MAD_low\":104,\"MAD_high\":1493,\"x\":1605139200000,\"low\":104,\"high\":1493},{\"event_date\":\"2020-11-13\",\"median_TTP\":773.5,\"MAD_TTP\":510.0144,\"MAD_low\":263,\"MAD_high\":1284,\"x\":1605225600000,\"low\":263,\"high\":1284},{\"event_date\":\"2020-11-14\",\"median_TTP\":1092.5,\"MAD_TTP\":856.2015,\"MAD_low\":236,\"MAD_high\":1949,\"x\":1605312000000,\"low\":236,\"high\":1949},{\"event_date\":\"2020-11-15\",\"median_TTP\":768,\"MAD_TTP\":607.866,\"MAD_low\":160,\"MAD_high\":1376,\"x\":1605398400000,\"low\":160,\"high\":1376},{\"event_date\":\"2020-11-16\",\"median_TTP\":896,\"MAD_TTP\":573.7662,\"MAD_low\":322,\"MAD_high\":1470,\"x\":1605484800000,\"low\":322,\"high\":1470},{\"event_date\":\"2020-11-17\",\"median_TTP\":690,\"MAD_TTP\":423.2823,\"MAD_low\":266,\"MAD_high\":1114,\"x\":1605571200000,\"low\":266,\"high\":1114},{\"event_date\":\"2020-11-18\",\"median_TTP\":856,\"MAD_TTP\":558.9402,\"MAD_low\":297,\"MAD_high\":1415,\"x\":1605657600000,\"low\":297,\"high\":1415},{\"event_date\":\"2020-11-19\",\"median_TTP\":821.5,\"MAD_TTP\":467.019,\"MAD_low\":354,\"MAD_high\":1289,\"x\":1605744000000,\"low\":354,\"high\":1289},{\"event_date\":\"2020-11-20\",\"median_TTP\":864.5,\"MAD_TTP\":553.7511,\"MAD_low\":310,\"MAD_high\":1419,\"x\":1605830400000,\"low\":310,\"high\":1419},{\"event_date\":\"2020-11-21\",\"median_TTP\":854.5,\"MAD_TTP\":707.9415,\"MAD_low\":146,\"MAD_high\":1563,\"x\":1605916800000,\"low\":146,\"high\":1563},{\"event_date\":\"2020-11-22\",\"median_TTP\":861.5,\"MAD_TTP\":541.8903,\"MAD_low\":319,\"MAD_high\":1404,\"x\":1606003200000,\"low\":319,\"high\":1404},{\"event_date\":\"2020-11-23\",\"median_TTP\":802,\"MAD_TTP\":560.4228,\"MAD_low\":241,\"MAD_high\":1363,\"x\":1606089600000,\"low\":241,\"high\":1363},{\"event_date\":\"2020-11-24\",\"median_TTP\":693,\"MAD_TTP\":591.5574,\"MAD_low\":101,\"MAD_high\":1285,\"x\":1606176000000,\"low\":101,\"high\":1285},{\"event_date\":\"2020-11-25\",\"median_TTP\":947,\"MAD_TTP\":954.7944,\"MAD_low\":-8,\"MAD_high\":1902,\"x\":1606262400000,\"low\":-8,\"high\":1902},{\"event_date\":\"2020-11-26\",\"median_TTP\":833,\"MAD_TTP\":504.084,\"MAD_low\":328,\"MAD_high\":1338,\"x\":1606348800000,\"low\":328,\"high\":1338},{\"event_date\":\"2020-11-27\",\"median_TTP\":972.5,\"MAD_TTP\":660.4983,\"MAD_low\":312,\"MAD_high\":1633,\"x\":1606435200000,\"low\":312,\"high\":1633},{\"event_date\":\"2020-11-28\",\"median_TTP\":990,\"MAD_TTP\":754.6434,\"MAD_low\":235,\"MAD_high\":1745,\"x\":1606521600000,\"low\":235,\"high\":1745},{\"event_date\":\"2020-11-29\",\"median_TTP\":866,\"MAD_TTP\":739.8174,\"MAD_low\":126,\"MAD_high\":1606,\"x\":1606608000000,\"low\":126,\"high\":1606},{\"event_date\":\"2020-11-30\",\"median_TTP\":1136,\"MAD_TTP\":805.0518,\"MAD_low\":330,\"MAD_high\":1942,\"x\":1606694400000,\"low\":330,\"high\":1942},{\"event_date\":\"2020-12-01\",\"median_TTP\":1037,\"MAD_TTP\":909.5751,\"MAD_low\":127,\"MAD_high\":1947,\"x\":1606780800000,\"low\":127,\"high\":1947},{\"event_date\":\"2020-12-02\",\"median_TTP\":807,\"MAD_TTP\":573.7662,\"MAD_low\":233,\"MAD_high\":1381,\"x\":1606867200000,\"low\":233,\"high\":1381},{\"event_date\":\"2020-12-03\",\"median_TTP\":757,\"MAD_TTP\":710.1654,\"MAD_low\":46,\"MAD_high\":1468,\"x\":1606953600000,\"low\":46,\"high\":1468},{\"event_date\":\"2020-12-04\",\"median_TTP\":841,\"MAD_TTP\":793.191,\"MAD_low\":47,\"MAD_high\":1635,\"x\":1607040000000,\"low\":47,\"high\":1635},{\"event_date\":\"2020-12-05\",\"median_TTP\":1062,\"MAD_TTP\":775.3998,\"MAD_low\":286,\"MAD_high\":1838,\"x\":1607126400000,\"low\":286,\"high\":1838},{\"event_date\":\"2020-12-06\",\"median_TTP\":728,\"MAD_TTP\":475.9146,\"MAD_low\":252,\"MAD_high\":1204,\"x\":1607212800000,\"low\":252,\"high\":1204},{\"event_date\":\"2020-12-07\",\"median_TTP\":950,\"MAD_TTP\":720.5436,\"MAD_low\":229,\"MAD_high\":1671,\"x\":1607299200000,\"low\":229,\"high\":1671},{\"event_date\":\"2020-12-08\",\"median_TTP\":874,\"MAD_TTP\":720.5436,\"MAD_low\":153,\"MAD_high\":1595,\"x\":1607385600000,\"low\":153,\"high\":1595},{\"event_date\":\"2020-12-09\",\"median_TTP\":1134,\"MAD_TTP\":871.7688,\"MAD_low\":262,\"MAD_high\":2006,\"x\":1607472000000,\"low\":262,\"high\":2006},{\"event_date\":\"2020-12-10\",\"median_TTP\":839,\"MAD_TTP\":649.3788,\"MAD_low\":189,\"MAD_high\":1489,\"x\":1607558400000,\"low\":189,\"high\":1489},{\"event_date\":\"2020-12-11\",\"median_TTP\":875,\"MAD_TTP\":693.8568,\"MAD_low\":181,\"MAD_high\":1569,\"x\":1607644800000,\"low\":181,\"high\":1569},{\"event_date\":\"2020-12-12\",\"median_TTP\":992.5,\"MAD_TTP\":972.5856,\"MAD_low\":19,\"MAD_high\":1966,\"x\":1607731200000,\"low\":19,\"high\":1966},{\"event_date\":\"2020-12-13\",\"median_TTP\":954,\"MAD_TTP\":469.9842,\"MAD_low\":484,\"MAD_high\":1424,\"x\":1607817600000,\"low\":484,\"high\":1424},{\"event_date\":\"2020-12-14\",\"median_TTP\":1183,\"MAD_TTP\":941.451,\"MAD_low\":241,\"MAD_high\":2125,\"x\":1607904000000,\"low\":241,\"high\":2125},{\"event_date\":\"2020-12-15\",\"median_TTP\":959,\"MAD_TTP\":787.2606,\"MAD_low\":171,\"MAD_high\":1747,\"x\":1607990400000,\"low\":171,\"high\":1747},{\"event_date\":\"2020-12-16\",\"median_TTP\":1007,\"MAD_TTP\":730.9218,\"MAD_low\":276,\"MAD_high\":1738,\"x\":1608076800000,\"low\":276,\"high\":1738},{\"event_date\":\"2020-12-17\",\"median_TTP\":788,\"MAD_TTP\":524.0991,\"MAD_low\":263,\"MAD_high\":1313,\"x\":1608163200000,\"low\":263,\"high\":1313},{\"event_date\":\"2020-12-18\",\"median_TTP\":812.5,\"MAD_TTP\":708.6828,\"MAD_low\":103,\"MAD_high\":1522,\"x\":1608249600000,\"low\":103,\"high\":1522},{\"event_date\":\"2020-12-19\",\"median_TTP\":869,\"MAD_TTP\":591.5574,\"MAD_low\":277,\"MAD_high\":1461,\"x\":1608336000000,\"low\":277,\"high\":1461},{\"event_date\":\"2020-12-20\",\"median_TTP\":616.5,\"MAD_TTP\":326.9133,\"MAD_low\":289,\"MAD_high\":944,\"x\":1608422400000,\"low\":289,\"high\":944},{\"event_date\":\"2020-12-21\",\"median_TTP\":853,\"MAD_TTP\":535.2186,\"MAD_low\":317,\"MAD_high\":1389,\"x\":1608508800000,\"low\":317,\"high\":1389},{\"event_date\":\"2020-12-22\",\"median_TTP\":835,\"MAD_TTP\":686.4438,\"MAD_low\":148,\"MAD_high\":1522,\"x\":1608595200000,\"low\":148,\"high\":1522},{\"event_date\":\"2020-12-23\",\"median_TTP\":940,\"MAD_TTP\":754.6434,\"MAD_low\":185,\"MAD_high\":1695,\"x\":1608681600000,\"low\":185,\"high\":1695},{\"event_date\":\"2020-12-24\",\"median_TTP\":928.5,\"MAD_TTP\":692.3742,\"MAD_low\":236,\"MAD_high\":1621,\"x\":1608768000000,\"low\":236,\"high\":1621},{\"event_date\":\"2020-12-25\",\"median_TTP\":806.5,\"MAD_TTP\":397.3368,\"MAD_low\":409,\"MAD_high\":1204,\"x\":1608854400000,\"low\":409,\"high\":1204},{\"event_date\":\"2020-12-26\",\"median_TTP\":1156,\"MAD_TTP\":1140.1194,\"MAD_low\":15,\"MAD_high\":2297,\"x\":1608940800000,\"low\":15,\"high\":2297},{\"event_date\":\"2020-12-27\",\"median_TTP\":625.5,\"MAD_TTP\":495.9297,\"MAD_low\":129,\"MAD_high\":1122,\"x\":1609027200000,\"low\":129,\"high\":1122},{\"event_date\":\"2020-12-28\",\"median_TTP\":928,\"MAD_TTP\":607.866,\"MAD_low\":320,\"MAD_high\":1536,\"x\":1609113600000,\"low\":320,\"high\":1536},{\"event_date\":\"2020-12-29\",\"median_TTP\":631,\"MAD_TTP\":517.4274,\"MAD_low\":113,\"MAD_high\":1149,\"x\":1609200000000,\"low\":113,\"high\":1149},{\"event_date\":\"2020-12-30\",\"median_TTP\":914.5,\"MAD_TTP\":604.9008,\"MAD_low\":309,\"MAD_high\":1520,\"x\":1609286400000,\"low\":309,\"high\":1520},{\"event_date\":\"2020-12-31\",\"median_TTP\":626,\"MAD_TTP\":498.1536,\"MAD_low\":127,\"MAD_high\":1125,\"x\":1609372800000,\"low\":127,\"high\":1125},{\"event_date\":\"2021-01-01\",\"median_TTP\":1669,\"MAD_TTP\":802.0866,\"MAD_low\":866,\"MAD_high\":2472,\"x\":1609459200000,\"low\":866,\"high\":2472},{\"event_date\":\"2021-01-02\",\"median_TTP\":1050,\"MAD_TTP\":655.3092,\"MAD_low\":394,\"MAD_high\":1706,\"x\":1609545600000,\"low\":394,\"high\":1706},{\"event_date\":\"2021-01-03\",\"median_TTP\":653,\"MAD_TTP\":504.084,\"MAD_low\":148,\"MAD_high\":1158,\"x\":1609632000000,\"low\":148,\"high\":1158},{\"event_date\":\"2021-01-04\",\"median_TTP\":865.5,\"MAD_TTP\":364.7196,\"MAD_low\":500,\"MAD_high\":1231,\"x\":1609718400000,\"low\":500,\"high\":1231},{\"event_date\":\"2021-01-05\",\"median_TTP\":755,\"MAD_TTP\":395.8542,\"MAD_low\":359,\"MAD_high\":1151,\"x\":1609804800000,\"low\":359,\"high\":1151},{\"event_date\":\"2021-01-06\",\"median_TTP\":691,\"MAD_TTP\":590.0748,\"MAD_low\":100,\"MAD_high\":1282,\"x\":1609891200000,\"low\":100,\"high\":1282},{\"event_date\":\"2021-01-07\",\"median_TTP\":820.5,\"MAD_TTP\":716.8371,\"MAD_low\":103,\"MAD_high\":1538,\"x\":1609977600000,\"low\":103,\"high\":1538},{\"event_date\":\"2021-01-08\",\"median_TTP\":760,\"MAD_TTP\":458.8647,\"MAD_low\":301,\"MAD_high\":1219,\"x\":1610064000000,\"low\":301,\"high\":1219},{\"event_date\":\"2021-01-09\",\"median_TTP\":824,\"MAD_TTP\":605.6421,\"MAD_low\":218,\"MAD_high\":1430,\"x\":1610150400000,\"low\":218,\"high\":1430},{\"event_date\":\"2021-01-10\",\"median_TTP\":1653.5,\"MAD_TTP\":1386.231,\"MAD_low\":267,\"MAD_high\":3040,\"x\":1610236800000,\"low\":267,\"high\":3040},{\"event_date\":\"2021-01-11\",\"median_TTP\":709.5,\"MAD_TTP\":583.4031,\"MAD_low\":126,\"MAD_high\":1293,\"x\":1610323200000,\"low\":126,\"high\":1293},{\"event_date\":\"2021-01-12\",\"median_TTP\":910.5,\"MAD_TTP\":571.5423,\"MAD_low\":338,\"MAD_high\":1483,\"x\":1610409600000,\"low\":338,\"high\":1483},{\"event_date\":\"2021-01-13\",\"median_TTP\":820,\"MAD_TTP\":643.4484,\"MAD_low\":176,\"MAD_high\":1464,\"x\":1610496000000,\"low\":176,\"high\":1464},{\"event_date\":\"2021-01-14\",\"median_TTP\":723,\"MAD_TTP\":517.4274,\"MAD_low\":205,\"MAD_high\":1241,\"x\":1610582400000,\"low\":205,\"high\":1241},{\"event_date\":\"2021-01-15\",\"median_TTP\":868,\"MAD_TTP\":587.1096,\"MAD_low\":280,\"MAD_high\":1456,\"x\":1610668800000,\"low\":280,\"high\":1456},{\"event_date\":\"2021-01-16\",\"median_TTP\":1047,\"MAD_TTP\":567.0945,\"MAD_low\":479,\"MAD_high\":1615,\"x\":1610755200000,\"low\":479,\"high\":1615},{\"event_date\":\"2021-01-17\",\"median_TTP\":516,\"MAD_TTP\":250.5594,\"MAD_low\":265,\"MAD_high\":767,\"x\":1610841600000,\"low\":265,\"high\":767},{\"event_date\":\"2021-01-18\",\"median_TTP\":874,\"MAD_TTP\":625.6572,\"MAD_low\":248,\"MAD_high\":1500,\"x\":1610928000000,\"low\":248,\"high\":1500},{\"event_date\":\"2021-01-19\",\"median_TTP\":843,\"MAD_TTP\":486.2928,\"MAD_low\":356,\"MAD_high\":1330,\"x\":1611014400000,\"low\":356,\"high\":1330},{\"event_date\":\"2021-01-20\",\"median_TTP\":898,\"MAD_TTP\":788.7432,\"MAD_low\":109,\"MAD_high\":1687,\"x\":1611100800000,\"low\":109,\"high\":1687},{\"event_date\":\"2021-01-21\",\"median_TTP\":982,\"MAD_TTP\":781.3302,\"MAD_low\":200,\"MAD_high\":1764,\"x\":1611187200000,\"low\":200,\"high\":1764},{\"event_date\":\"2021-01-22\",\"median_TTP\":769.5,\"MAD_TTP\":434.4018,\"MAD_low\":335,\"MAD_high\":1204,\"x\":1611273600000,\"low\":335,\"high\":1204},{\"event_date\":\"2021-01-23\",\"median_TTP\":820,\"MAD_TTP\":474.432,\"MAD_low\":345,\"MAD_high\":1295,\"x\":1611360000000,\"low\":345,\"high\":1295},{\"event_date\":\"2021-01-24\",\"median_TTP\":718,\"MAD_TTP\":579.6966,\"MAD_low\":138,\"MAD_high\":1298,\"x\":1611446400000,\"low\":138,\"high\":1298},{\"event_date\":\"2021-01-25\",\"median_TTP\":783.5,\"MAD_TTP\":444.0387,\"MAD_low\":339,\"MAD_high\":1228,\"x\":1611532800000,\"low\":339,\"high\":1228},{\"event_date\":\"2021-01-26\",\"median_TTP\":761,\"MAD_TTP\":299.4852,\"MAD_low\":461,\"MAD_high\":1061,\"x\":1611619200000,\"low\":461,\"high\":1061},{\"event_date\":\"2021-01-27\",\"median_TTP\":420.5,\"MAD_TTP\":289.8483,\"MAD_low\":130,\"MAD_high\":711,\"x\":1611705600000,\"low\":130,\"high\":711},{\"event_date\":\"2021-01-28\",\"median_TTP\":375,\"MAD_TTP\":214.977,\"MAD_low\":160,\"MAD_high\":590,\"x\":1611792000000,\"low\":160,\"high\":590},{\"event_date\":\"2021-01-29\",\"median_TTP\":551.5,\"MAD_TTP\":477.3972,\"MAD_low\":74,\"MAD_high\":1029,\"x\":1611878400000,\"low\":74,\"high\":1029},{\"event_date\":\"2021-01-30\",\"median_TTP\":777.5,\"MAD_TTP\":504.084,\"MAD_low\":273,\"MAD_high\":1282,\"x\":1611964800000,\"low\":273,\"high\":1282}],\"type\":\"arearange\",\"name\":\"MAD\",\"color\":\"lightblue\",\"opacity\":0.5}],\"xAxis\":{\"type\":\"datetime\",\"title\":{\"text\":\"event_date\"}},\"tooltip\":{\"shared\":true}},\"theme\":{\"chart\":{\"backgroundColor\":\"transparent\"},\"colors\":[\"#7cb5ec\",\"#434348\",\"#90ed7d\",\"#f7a35c\",\"#8085e9\",\"#f15c80\",\"#e4d354\",\"#2b908f\",\"#f45b5b\",\"#91e8e1\"]},\"conf_opts\":{\"global\":{\"Date\":null,\"VMLRadialGradientURL\":\"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png\",\"canvasToolsURL\":\"http =//code.highcharts.com/list(version)/modules/canvas-tools.js\",\"getTimezoneOffset\":null,\"timezoneOffset\":0,\"useUTC\":true},\"lang\":{\"contextButtonTitle\":\"Chart context menu\",\"decimalPoint\":\".\",\"downloadCSV\":\"Download CSV\",\"downloadJPEG\":\"Download JPEG image\",\"downloadPDF\":\"Download PDF document\",\"downloadPNG\":\"Download PNG image\",\"downloadSVG\":\"Download SVG vector image\",\"downloadXLS\":\"Download XLS\",\"drillUpText\":\"◁ Back to {series.name}\",\"exitFullscreen\":\"Exit from full screen\",\"exportData\":{\"annotationHeader\":\"Annotations\",\"categoryDatetimeHeader\":\"DateTime\",\"categoryHeader\":\"Category\"},\"hideData\":\"Hide data table\",\"invalidDate\":null,\"loading\":\"Loading...\",\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"noData\":\"No data to display\",\"numericSymbolMagnitude\":1000,\"numericSymbols\":[\"k\",\"M\",\"G\",\"T\",\"P\",\"E\"],\"printChart\":\"Print chart\",\"resetZoom\":\"Reset zoom\",\"resetZoomTitle\":\"Reset zoom level 1:1\",\"shortMonths\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"shortWeekdays\":[\"Sat\",\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\"],\"thousandsSep\":\" \",\"viewData\":\"View data table\",\"viewFullscreen\":\"View in full screen\",\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]}},\"type\":\"chart\",\"fonts\":[],\"debug\":false},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n\n### Week level\n\n::: {.cell}\n\n```{.r .cell-code}\nddf <- df %>% \n select(TTP,event_date) %>%\n mutate(year = year(event_date)) %>% \n mutate(week_number = paste0(year,\"-\",week(event_date)) ) %>%\n group_by(week_number) %>%\n reframe(\n  median_TTP = median(TTP),\n  MAD_TTP = mad(TTP),\n  MAD_low = floor(median(TTP) - mad(TTP)),\n  MAD_high = ceiling(median(TTP) + mad(TTP))\n ) %>% \n ungroup()\n \n\nddf %>% \n hchart(type = \"column\", hcaes(y = median_TTP, x = week_number), name = \"median TTP\") %>% \n hc_add_series(\n  data = ddf, type = \"errorbar\", hcaes(y = median_TTP, low = MAD_low, high = MAD_high),\n  name = \"MAD\"\n ) %>% \n hc_title(text = \"TTP Range per week\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"highchart html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-ac93338813802f2f036b\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-ac93338813802f2f036b\">{\"x\":{\"hc_opts\":{\"chart\":{\"reflow\":true},\"title\":{\"text\":\"TTP Range per week\"},\"yAxis\":{\"title\":{\"text\":\"median_TTP\"},\"type\":\"linear\"},\"credits\":{\"enabled\":false},\"exporting\":{\"enabled\":false},\"boost\":{\"enabled\":false},\"plotOptions\":{\"series\":{\"label\":{\"enabled\":false},\"turboThreshold\":0,\"showInLegend\":false},\"treemap\":{\"layoutAlgorithm\":\"squarified\"},\"scatter\":{\"marker\":{\"symbol\":\"circle\"}}},\"series\":[{\"group\":\"group\",\"data\":[{\"week_number\":\"2020-44\",\"median_TTP\":758,\"MAD_TTP\":416.6106,\"MAD_low\":341,\"MAD_high\":1175,\"y\":758,\"name\":\"2020-44\"},{\"week_number\":\"2020-45\",\"median_TTP\":920.5,\"MAD_TTP\":685.7025,\"MAD_low\":234,\"MAD_high\":1607,\"y\":920.5,\"name\":\"2020-45\"},{\"week_number\":\"2020-46\",\"median_TTP\":780,\"MAD_TTP\":548.562,\"MAD_low\":231,\"MAD_high\":1329,\"y\":780,\"name\":\"2020-46\"},{\"week_number\":\"2020-47\",\"median_TTP\":827,\"MAD_TTP\":554.4924,\"MAD_low\":272,\"MAD_high\":1382,\"y\":827,\"name\":\"2020-47\"},{\"week_number\":\"2020-48\",\"median_TTP\":987,\"MAD_TTP\":763.539,\"MAD_low\":223,\"MAD_high\":1751,\"y\":987,\"name\":\"2020-48\"},{\"week_number\":\"2020-49\",\"median_TTP\":873.5,\"MAD_TTP\":700.5285,\"MAD_low\":172,\"MAD_high\":1575,\"y\":873.5,\"name\":\"2020-49\"},{\"week_number\":\"2020-50\",\"median_TTP\":968,\"MAD_TTP\":788.7432,\"MAD_low\":179,\"MAD_high\":1757,\"y\":968,\"name\":\"2020-50\"},{\"week_number\":\"2020-51\",\"median_TTP\":840,\"MAD_TTP\":631.5876,\"MAD_low\":208,\"MAD_high\":1472,\"y\":840,\"name\":\"2020-51\"},{\"week_number\":\"2020-52\",\"median_TTP\":850,\"MAD_TTP\":644.1897,\"MAD_low\":205,\"MAD_high\":1495,\"y\":850,\"name\":\"2020-52\"},{\"week_number\":\"2020-53\",\"median_TTP\":752,\"MAD_TTP\":601.9356,\"MAD_low\":150,\"MAD_high\":1354,\"y\":752,\"name\":\"2020-53\"},{\"week_number\":\"2021-1\",\"median_TTP\":846,\"MAD_TTP\":575.2488,\"MAD_low\":270,\"MAD_high\":1422,\"y\":846,\"name\":\"2021-1\"},{\"week_number\":\"2021-2\",\"median_TTP\":795,\"MAD_TTP\":598.9704,\"MAD_low\":196,\"MAD_high\":1394,\"y\":795,\"name\":\"2021-2\"},{\"week_number\":\"2021-3\",\"median_TTP\":883.5,\"MAD_TTP\":679.7721,\"MAD_low\":203,\"MAD_high\":1564,\"y\":883.5,\"name\":\"2021-3\"},{\"week_number\":\"2021-4\",\"median_TTP\":768.5,\"MAD_TTP\":521.1339,\"MAD_low\":247,\"MAD_high\":1290,\"y\":768.5,\"name\":\"2021-4\"},{\"week_number\":\"2021-5\",\"median_TTP\":743,\"MAD_TTP\":736.8522,\"MAD_low\":6,\"MAD_high\":1480,\"y\":743,\"name\":\"2021-5\"}],\"type\":\"column\",\"name\":\"median TTP\"},{\"group\":\"group\",\"data\":[{\"week_number\":\"2020-44\",\"median_TTP\":758,\"MAD_TTP\":416.6106,\"MAD_low\":341,\"MAD_high\":1175,\"y\":758,\"low\":341,\"high\":1175},{\"week_number\":\"2020-45\",\"median_TTP\":920.5,\"MAD_TTP\":685.7025,\"MAD_low\":234,\"MAD_high\":1607,\"y\":920.5,\"low\":234,\"high\":1607},{\"week_number\":\"2020-46\",\"median_TTP\":780,\"MAD_TTP\":548.562,\"MAD_low\":231,\"MAD_high\":1329,\"y\":780,\"low\":231,\"high\":1329},{\"week_number\":\"2020-47\",\"median_TTP\":827,\"MAD_TTP\":554.4924,\"MAD_low\":272,\"MAD_high\":1382,\"y\":827,\"low\":272,\"high\":1382},{\"week_number\":\"2020-48\",\"median_TTP\":987,\"MAD_TTP\":763.539,\"MAD_low\":223,\"MAD_high\":1751,\"y\":987,\"low\":223,\"high\":1751},{\"week_number\":\"2020-49\",\"median_TTP\":873.5,\"MAD_TTP\":700.5285,\"MAD_low\":172,\"MAD_high\":1575,\"y\":873.5,\"low\":172,\"high\":1575},{\"week_number\":\"2020-50\",\"median_TTP\":968,\"MAD_TTP\":788.7432,\"MAD_low\":179,\"MAD_high\":1757,\"y\":968,\"low\":179,\"high\":1757},{\"week_number\":\"2020-51\",\"median_TTP\":840,\"MAD_TTP\":631.5876,\"MAD_low\":208,\"MAD_high\":1472,\"y\":840,\"low\":208,\"high\":1472},{\"week_number\":\"2020-52\",\"median_TTP\":850,\"MAD_TTP\":644.1897,\"MAD_low\":205,\"MAD_high\":1495,\"y\":850,\"low\":205,\"high\":1495},{\"week_number\":\"2020-53\",\"median_TTP\":752,\"MAD_TTP\":601.9356,\"MAD_low\":150,\"MAD_high\":1354,\"y\":752,\"low\":150,\"high\":1354},{\"week_number\":\"2021-1\",\"median_TTP\":846,\"MAD_TTP\":575.2488,\"MAD_low\":270,\"MAD_high\":1422,\"y\":846,\"low\":270,\"high\":1422},{\"week_number\":\"2021-2\",\"median_TTP\":795,\"MAD_TTP\":598.9704,\"MAD_low\":196,\"MAD_high\":1394,\"y\":795,\"low\":196,\"high\":1394},{\"week_number\":\"2021-3\",\"median_TTP\":883.5,\"MAD_TTP\":679.7721,\"MAD_low\":203,\"MAD_high\":1564,\"y\":883.5,\"low\":203,\"high\":1564},{\"week_number\":\"2021-4\",\"median_TTP\":768.5,\"MAD_TTP\":521.1339,\"MAD_low\":247,\"MAD_high\":1290,\"y\":768.5,\"low\":247,\"high\":1290},{\"week_number\":\"2021-5\",\"median_TTP\":743,\"MAD_TTP\":736.8522,\"MAD_low\":6,\"MAD_high\":1480,\"y\":743,\"low\":6,\"high\":1480}],\"type\":\"errorbar\",\"name\":\"MAD\"}],\"xAxis\":{\"type\":\"category\",\"title\":{\"text\":\"week_number\"},\"categories\":null}},\"theme\":{\"chart\":{\"backgroundColor\":\"transparent\"},\"colors\":[\"#7cb5ec\",\"#434348\",\"#90ed7d\",\"#f7a35c\",\"#8085e9\",\"#f15c80\",\"#e4d354\",\"#2b908f\",\"#f45b5b\",\"#91e8e1\"]},\"conf_opts\":{\"global\":{\"Date\":null,\"VMLRadialGradientURL\":\"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png\",\"canvasToolsURL\":\"http =//code.highcharts.com/list(version)/modules/canvas-tools.js\",\"getTimezoneOffset\":null,\"timezoneOffset\":0,\"useUTC\":true},\"lang\":{\"contextButtonTitle\":\"Chart context menu\",\"decimalPoint\":\".\",\"downloadCSV\":\"Download CSV\",\"downloadJPEG\":\"Download JPEG image\",\"downloadPDF\":\"Download PDF document\",\"downloadPNG\":\"Download PNG image\",\"downloadSVG\":\"Download SVG vector image\",\"downloadXLS\":\"Download XLS\",\"drillUpText\":\"◁ Back to {series.name}\",\"exitFullscreen\":\"Exit from full screen\",\"exportData\":{\"annotationHeader\":\"Annotations\",\"categoryDatetimeHeader\":\"DateTime\",\"categoryHeader\":\"Category\"},\"hideData\":\"Hide data table\",\"invalidDate\":null,\"loading\":\"Loading...\",\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"noData\":\"No data to display\",\"numericSymbolMagnitude\":1000,\"numericSymbols\":[\"k\",\"M\",\"G\",\"T\",\"P\",\"E\"],\"printChart\":\"Print chart\",\"resetZoom\":\"Reset zoom\",\"resetZoomTitle\":\"Reset zoom level 1:1\",\"shortMonths\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"shortWeekdays\":[\"Sat\",\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\"],\"thousandsSep\":\" \",\"viewData\":\"View data table\",\"viewFullscreen\":\"View in full screen\",\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]}},\"type\":\"chart\",\"fonts\":[],\"debug\":false},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n\n\n### By part of the day\n\n::: {.cell}\n\n```{.r .cell-code}\nddf <- df %>% \n select(TTP, total_due, min_purchase_time) %>%\n rename(purchase_time = min_purchase_time) %>% \n mutate(\n    day_segment = case_when(\n      between(hour(purchase_time), 7, 12) ~ \"Morning\",\n      between(hour(purchase_time), 13, 17) ~ \"Afternoon\",\n      between(hour(purchase_time), 18, 24) ~ \"Evening\",\n      TRUE ~ \"Night\"\n    )\n  ) %>% \n group_by(day_segment) %>% \n reframe(\n  median_TTP = median(TTP),\n  MAD_TTP = mad(TTP),\n  MAD_low = floor(median(TTP) - mad(TTP)),\n  MAD_high = ceiling(median(TTP) + mad(TTP))\n ) %>% \n ungroup()\n\n# plot\nddf %>% \n arrange(match(day_segment, c(\"Morning\", \"Afternoon\", \"Evening\", \"Night\") )) %>% \n hchart(type = \"column\", hcaes(y = median_TTP, x = day_segment), name = \"day segment\") %>% \n hc_add_series(\n  data = ddf, type = \"errorbar\", hcaes(y = median_TTP, low = MAD_low, high = MAD_high),\n  name = \"MAD\"\n ) %>% \n hc_title(text = \"TTP Range per day segment\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"highchart html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-c0d7a2f58fc95775b9ba\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-c0d7a2f58fc95775b9ba\">{\"x\":{\"hc_opts\":{\"chart\":{\"reflow\":true},\"title\":{\"text\":\"TTP Range per day segment\"},\"yAxis\":{\"title\":{\"text\":\"median_TTP\"},\"type\":\"linear\"},\"credits\":{\"enabled\":false},\"exporting\":{\"enabled\":false},\"boost\":{\"enabled\":false},\"plotOptions\":{\"series\":{\"label\":{\"enabled\":false},\"turboThreshold\":0,\"showInLegend\":false},\"treemap\":{\"layoutAlgorithm\":\"squarified\"},\"scatter\":{\"marker\":{\"symbol\":\"circle\"}}},\"series\":[{\"group\":\"group\",\"data\":[{\"day_segment\":\"Morning\",\"median_TTP\":862.5,\"MAD_TTP\":693.1155,\"MAD_low\":169,\"MAD_high\":1556,\"y\":862.5,\"name\":\"Morning\"},{\"day_segment\":\"Afternoon\",\"median_TTP\":874.5,\"MAD_TTP\":653.8266,\"MAD_low\":220,\"MAD_high\":1529,\"y\":874.5,\"name\":\"Afternoon\"},{\"day_segment\":\"Evening\",\"median_TTP\":941,\"MAD_TTP\":702.7524,\"MAD_low\":238,\"MAD_high\":1644,\"y\":941,\"name\":\"Evening\"},{\"day_segment\":\"Night\",\"median_TTP\":822,\"MAD_TTP\":606.3834,\"MAD_low\":215,\"MAD_high\":1429,\"y\":822,\"name\":\"Night\"}],\"type\":\"column\",\"name\":\"day segment\"},{\"group\":\"group\",\"data\":[{\"day_segment\":\"Afternoon\",\"median_TTP\":874.5,\"MAD_TTP\":653.8266,\"MAD_low\":220,\"MAD_high\":1529,\"y\":874.5,\"low\":220,\"high\":1529},{\"day_segment\":\"Evening\",\"median_TTP\":941,\"MAD_TTP\":702.7524,\"MAD_low\":238,\"MAD_high\":1644,\"y\":941,\"low\":238,\"high\":1644},{\"day_segment\":\"Morning\",\"median_TTP\":862.5,\"MAD_TTP\":693.1155,\"MAD_low\":169,\"MAD_high\":1556,\"y\":862.5,\"low\":169,\"high\":1556},{\"day_segment\":\"Night\",\"median_TTP\":822,\"MAD_TTP\":606.3834,\"MAD_low\":215,\"MAD_high\":1429,\"y\":822,\"low\":215,\"high\":1429}],\"type\":\"errorbar\",\"name\":\"MAD\"}],\"xAxis\":{\"type\":\"category\",\"title\":{\"text\":\"day_segment\"},\"categories\":null}},\"theme\":{\"chart\":{\"backgroundColor\":\"transparent\"},\"colors\":[\"#7cb5ec\",\"#434348\",\"#90ed7d\",\"#f7a35c\",\"#8085e9\",\"#f15c80\",\"#e4d354\",\"#2b908f\",\"#f45b5b\",\"#91e8e1\"]},\"conf_opts\":{\"global\":{\"Date\":null,\"VMLRadialGradientURL\":\"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png\",\"canvasToolsURL\":\"http =//code.highcharts.com/list(version)/modules/canvas-tools.js\",\"getTimezoneOffset\":null,\"timezoneOffset\":0,\"useUTC\":true},\"lang\":{\"contextButtonTitle\":\"Chart context menu\",\"decimalPoint\":\".\",\"downloadCSV\":\"Download CSV\",\"downloadJPEG\":\"Download JPEG image\",\"downloadPDF\":\"Download PDF document\",\"downloadPNG\":\"Download PNG image\",\"downloadSVG\":\"Download SVG vector image\",\"downloadXLS\":\"Download XLS\",\"drillUpText\":\"◁ Back to {series.name}\",\"exitFullscreen\":\"Exit from full screen\",\"exportData\":{\"annotationHeader\":\"Annotations\",\"categoryDatetimeHeader\":\"DateTime\",\"categoryHeader\":\"Category\"},\"hideData\":\"Hide data table\",\"invalidDate\":null,\"loading\":\"Loading...\",\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"noData\":\"No data to display\",\"numericSymbolMagnitude\":1000,\"numericSymbols\":[\"k\",\"M\",\"G\",\"T\",\"P\",\"E\"],\"printChart\":\"Print chart\",\"resetZoom\":\"Reset zoom\",\"resetZoomTitle\":\"Reset zoom level 1:1\",\"shortMonths\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"shortWeekdays\":[\"Sat\",\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\"],\"thousandsSep\":\" \",\"viewData\":\"View data table\",\"viewFullscreen\":\"View in full screen\",\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]}},\"type\":\"chart\",\"fonts\":[],\"debug\":false},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n\n```{.r .cell-code}\n# --- comparison below -----\nddf <- df %>% \n select(TTP, total_due, min_purchase_time) %>%\n rename(purchase_time = min_purchase_time) %>% \n mutate(\n    day_segment = case_when(\n      between(hour(purchase_time), 7, 12) ~ \"Morning\",\n      between(hour(purchase_time), 13, 17) ~ \"Afternoon\",\n      between(hour(purchase_time), 18, 24) ~ \"Evening\",\n      TRUE ~ \"Night\"\n    )\n  )\n\nggbetweenstats(\n data = ddf,\n x = day_segment,\n y = total_due,\n type = \"nonparametric\"\n) + scale_y_continuous(trans = \"log\", labels = function(x) round(x))\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/parts_of_the_day-2.png){width=672}\n:::\n:::\n\n\n### By hour\n\n::: {.cell}\n\n```{.r .cell-code}\n# median TTP\nddf <- df %>% \n select(TTP, total_due, min_purchase_time) %>%\n mutate(hour_purchase = hour(min_purchase_time)) %>%  \n group_by(hour_purchase) %>% \n reframe(\n  median_TTP = median(TTP),\n  MAD_TTP = mad(TTP),\n  MAD_low = floor(median(TTP) - mad(TTP)),\n  MAD_high = ceiling(median(TTP) + mad(TTP))\n ) %>% \n ungroup()\n\n\n# plot\nddf %>% \n hchart(type = \"column\", hcaes(y = median_TTP, x = hour_purchase), name = \"hour\") %>% \n hc_add_series(\n  data = ddf, type = \"errorbar\", hcaes(y = median_TTP, low = MAD_low, high = MAD_high),\n  name = \"MAD\"\n ) %>% \n hc_title(text = \"TTP Range per hour segment\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"highchart html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-0f349cf38f758ce82db6\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-0f349cf38f758ce82db6\">{\"x\":{\"hc_opts\":{\"chart\":{\"reflow\":true},\"title\":{\"text\":\"TTP Range per hour segment\"},\"yAxis\":{\"title\":{\"text\":\"median_TTP\"},\"type\":\"linear\"},\"credits\":{\"enabled\":false},\"exporting\":{\"enabled\":false},\"boost\":{\"enabled\":false},\"plotOptions\":{\"series\":{\"label\":{\"enabled\":false},\"turboThreshold\":0,\"showInLegend\":false},\"treemap\":{\"layoutAlgorithm\":\"squarified\"},\"scatter\":{\"marker\":{\"symbol\":\"circle\"}}},\"series\":[{\"group\":\"group\",\"data\":[{\"hour_purchase\":0,\"median_TTP\":604.5,\"MAD_TTP\":401.0433,\"MAD_low\":203,\"MAD_high\":1006,\"x\":0,\"y\":604.5},{\"hour_purchase\":1,\"median_TTP\":823,\"MAD_TTP\":584.1444,\"MAD_low\":238,\"MAD_high\":1408,\"x\":1,\"y\":823},{\"hour_purchase\":2,\"median_TTP\":982,\"MAD_TTP\":748.713,\"MAD_low\":233,\"MAD_high\":1731,\"x\":2,\"y\":982},{\"hour_purchase\":3,\"median_TTP\":847,\"MAD_TTP\":578.214,\"MAD_low\":268,\"MAD_high\":1426,\"x\":3,\"y\":847},{\"hour_purchase\":4,\"median_TTP\":856.5,\"MAD_TTP\":605.6421,\"MAD_low\":250,\"MAD_high\":1463,\"x\":4,\"y\":856.5},{\"hour_purchase\":5,\"median_TTP\":784,\"MAD_TTP\":511.497,\"MAD_low\":272,\"MAD_high\":1296,\"x\":5,\"y\":784},{\"hour_purchase\":6,\"median_TTP\":889,\"MAD_TTP\":680.5134,\"MAD_low\":208,\"MAD_high\":1570,\"x\":6,\"y\":889},{\"hour_purchase\":7,\"median_TTP\":794,\"MAD_TTP\":619.7268,\"MAD_low\":174,\"MAD_high\":1414,\"x\":7,\"y\":794},{\"hour_purchase\":8,\"median_TTP\":994,\"MAD_TTP\":717.5784,\"MAD_low\":276,\"MAD_high\":1712,\"x\":8,\"y\":994},{\"hour_purchase\":9,\"median_TTP\":899.5,\"MAD_TTP\":664.9461,\"MAD_low\":234,\"MAD_high\":1565,\"x\":9,\"y\":899.5},{\"hour_purchase\":10,\"median_TTP\":734,\"MAD_TTP\":627.1398,\"MAD_low\":106,\"MAD_high\":1362,\"x\":10,\"y\":734},{\"hour_purchase\":11,\"median_TTP\":825.5,\"MAD_TTP\":534.4773,\"MAD_low\":291,\"MAD_high\":1360,\"x\":11,\"y\":825.5},{\"hour_purchase\":12,\"median_TTP\":844.5,\"MAD_TTP\":714.6132,\"MAD_low\":129,\"MAD_high\":1560,\"x\":12,\"y\":844.5},{\"hour_purchase\":13,\"median_TTP\":822,\"MAD_TTP\":655.3092,\"MAD_low\":166,\"MAD_high\":1478,\"x\":13,\"y\":822},{\"hour_purchase\":14,\"median_TTP\":856,\"MAD_TTP\":633.0702,\"MAD_low\":222,\"MAD_high\":1490,\"x\":14,\"y\":856},{\"hour_purchase\":15,\"median_TTP\":917.5,\"MAD_TTP\":707.2002,\"MAD_low\":210,\"MAD_high\":1625,\"x\":15,\"y\":917.5},{\"hour_purchase\":16,\"median_TTP\":892,\"MAD_TTP\":584.1444,\"MAD_low\":307,\"MAD_high\":1477,\"x\":16,\"y\":892},{\"hour_purchase\":17,\"median_TTP\":886,\"MAD_TTP\":676.0656,\"MAD_low\":209,\"MAD_high\":1563,\"x\":17,\"y\":886},{\"hour_purchase\":18,\"median_TTP\":824.5,\"MAD_TTP\":664.9461,\"MAD_low\":159,\"MAD_high\":1490,\"x\":18,\"y\":824.5},{\"hour_purchase\":19,\"median_TTP\":784,\"MAD_TTP\":622.692,\"MAD_low\":161,\"MAD_high\":1407,\"x\":19,\"y\":784},{\"hour_purchase\":20,\"median_TTP\":1021,\"MAD_TTP\":716.0958,\"MAD_low\":304,\"MAD_high\":1738,\"x\":20,\"y\":1021},{\"hour_purchase\":21,\"median_TTP\":957,\"MAD_TTP\":722.7675,\"MAD_low\":234,\"MAD_high\":1680,\"x\":21,\"y\":957},{\"hour_purchase\":22,\"median_TTP\":919,\"MAD_TTP\":587.1096,\"MAD_low\":331,\"MAD_high\":1507,\"x\":22,\"y\":919},{\"hour_purchase\":23,\"median_TTP\":1033,\"MAD_TTP\":765.0216,\"MAD_low\":267,\"MAD_high\":1799,\"x\":23,\"y\":1033}],\"type\":\"column\",\"name\":\"hour\"},{\"group\":\"group\",\"data\":[{\"hour_purchase\":0,\"median_TTP\":604.5,\"MAD_TTP\":401.0433,\"MAD_low\":203,\"MAD_high\":1006,\"y\":604.5,\"low\":203,\"high\":1006},{\"hour_purchase\":1,\"median_TTP\":823,\"MAD_TTP\":584.1444,\"MAD_low\":238,\"MAD_high\":1408,\"y\":823,\"low\":238,\"high\":1408},{\"hour_purchase\":2,\"median_TTP\":982,\"MAD_TTP\":748.713,\"MAD_low\":233,\"MAD_high\":1731,\"y\":982,\"low\":233,\"high\":1731},{\"hour_purchase\":3,\"median_TTP\":847,\"MAD_TTP\":578.214,\"MAD_low\":268,\"MAD_high\":1426,\"y\":847,\"low\":268,\"high\":1426},{\"hour_purchase\":4,\"median_TTP\":856.5,\"MAD_TTP\":605.6421,\"MAD_low\":250,\"MAD_high\":1463,\"y\":856.5,\"low\":250,\"high\":1463},{\"hour_purchase\":5,\"median_TTP\":784,\"MAD_TTP\":511.497,\"MAD_low\":272,\"MAD_high\":1296,\"y\":784,\"low\":272,\"high\":1296},{\"hour_purchase\":6,\"median_TTP\":889,\"MAD_TTP\":680.5134,\"MAD_low\":208,\"MAD_high\":1570,\"y\":889,\"low\":208,\"high\":1570},{\"hour_purchase\":7,\"median_TTP\":794,\"MAD_TTP\":619.7268,\"MAD_low\":174,\"MAD_high\":1414,\"y\":794,\"low\":174,\"high\":1414},{\"hour_purchase\":8,\"median_TTP\":994,\"MAD_TTP\":717.5784,\"MAD_low\":276,\"MAD_high\":1712,\"y\":994,\"low\":276,\"high\":1712},{\"hour_purchase\":9,\"median_TTP\":899.5,\"MAD_TTP\":664.9461,\"MAD_low\":234,\"MAD_high\":1565,\"y\":899.5,\"low\":234,\"high\":1565},{\"hour_purchase\":10,\"median_TTP\":734,\"MAD_TTP\":627.1398,\"MAD_low\":106,\"MAD_high\":1362,\"y\":734,\"low\":106,\"high\":1362},{\"hour_purchase\":11,\"median_TTP\":825.5,\"MAD_TTP\":534.4773,\"MAD_low\":291,\"MAD_high\":1360,\"y\":825.5,\"low\":291,\"high\":1360},{\"hour_purchase\":12,\"median_TTP\":844.5,\"MAD_TTP\":714.6132,\"MAD_low\":129,\"MAD_high\":1560,\"y\":844.5,\"low\":129,\"high\":1560},{\"hour_purchase\":13,\"median_TTP\":822,\"MAD_TTP\":655.3092,\"MAD_low\":166,\"MAD_high\":1478,\"y\":822,\"low\":166,\"high\":1478},{\"hour_purchase\":14,\"median_TTP\":856,\"MAD_TTP\":633.0702,\"MAD_low\":222,\"MAD_high\":1490,\"y\":856,\"low\":222,\"high\":1490},{\"hour_purchase\":15,\"median_TTP\":917.5,\"MAD_TTP\":707.2002,\"MAD_low\":210,\"MAD_high\":1625,\"y\":917.5,\"low\":210,\"high\":1625},{\"hour_purchase\":16,\"median_TTP\":892,\"MAD_TTP\":584.1444,\"MAD_low\":307,\"MAD_high\":1477,\"y\":892,\"low\":307,\"high\":1477},{\"hour_purchase\":17,\"median_TTP\":886,\"MAD_TTP\":676.0656,\"MAD_low\":209,\"MAD_high\":1563,\"y\":886,\"low\":209,\"high\":1563},{\"hour_purchase\":18,\"median_TTP\":824.5,\"MAD_TTP\":664.9461,\"MAD_low\":159,\"MAD_high\":1490,\"y\":824.5,\"low\":159,\"high\":1490},{\"hour_purchase\":19,\"median_TTP\":784,\"MAD_TTP\":622.692,\"MAD_low\":161,\"MAD_high\":1407,\"y\":784,\"low\":161,\"high\":1407},{\"hour_purchase\":20,\"median_TTP\":1021,\"MAD_TTP\":716.0958,\"MAD_low\":304,\"MAD_high\":1738,\"y\":1021,\"low\":304,\"high\":1738},{\"hour_purchase\":21,\"median_TTP\":957,\"MAD_TTP\":722.7675,\"MAD_low\":234,\"MAD_high\":1680,\"y\":957,\"low\":234,\"high\":1680},{\"hour_purchase\":22,\"median_TTP\":919,\"MAD_TTP\":587.1096,\"MAD_low\":331,\"MAD_high\":1507,\"y\":919,\"low\":331,\"high\":1507},{\"hour_purchase\":23,\"median_TTP\":1033,\"MAD_TTP\":765.0216,\"MAD_low\":267,\"MAD_high\":1799,\"y\":1033,\"low\":267,\"high\":1799}],\"type\":\"errorbar\",\"name\":\"MAD\"}],\"xAxis\":{\"type\":\"linear\",\"title\":{\"text\":\"hour_purchase\"},\"categories\":null}},\"theme\":{\"chart\":{\"backgroundColor\":\"transparent\"},\"colors\":[\"#7cb5ec\",\"#434348\",\"#90ed7d\",\"#f7a35c\",\"#8085e9\",\"#f15c80\",\"#e4d354\",\"#2b908f\",\"#f45b5b\",\"#91e8e1\"]},\"conf_opts\":{\"global\":{\"Date\":null,\"VMLRadialGradientURL\":\"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png\",\"canvasToolsURL\":\"http =//code.highcharts.com/list(version)/modules/canvas-tools.js\",\"getTimezoneOffset\":null,\"timezoneOffset\":0,\"useUTC\":true},\"lang\":{\"contextButtonTitle\":\"Chart context menu\",\"decimalPoint\":\".\",\"downloadCSV\":\"Download CSV\",\"downloadJPEG\":\"Download JPEG image\",\"downloadPDF\":\"Download PDF document\",\"downloadPNG\":\"Download PNG image\",\"downloadSVG\":\"Download SVG vector image\",\"downloadXLS\":\"Download XLS\",\"drillUpText\":\"◁ Back to {series.name}\",\"exitFullscreen\":\"Exit from full screen\",\"exportData\":{\"annotationHeader\":\"Annotations\",\"categoryDatetimeHeader\":\"DateTime\",\"categoryHeader\":\"Category\"},\"hideData\":\"Hide data table\",\"invalidDate\":null,\"loading\":\"Loading...\",\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"noData\":\"No data to display\",\"numericSymbolMagnitude\":1000,\"numericSymbols\":[\"k\",\"M\",\"G\",\"T\",\"P\",\"E\"],\"printChart\":\"Print chart\",\"resetZoom\":\"Reset zoom\",\"resetZoomTitle\":\"Reset zoom level 1:1\",\"shortMonths\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"shortWeekdays\":[\"Sat\",\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\"],\"thousandsSep\":\" \",\"viewData\":\"View data table\",\"viewFullscreen\":\"View in full screen\",\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]}},\"type\":\"chart\",\"fonts\":[],\"debug\":false},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n\n```{.r .cell-code}\n# median total_due\nddf <- df %>% \n select(TTP, total_due, min_purchase_time) %>%\n mutate(hour_purchase = hour(min_purchase_time)) %>%  \n group_by(hour_purchase) %>% \n reframe(\n  median_USD = median(total_due),\n  MAD_USD = mad(total_due),\n  MAD_low = floor(median(total_due) - mad(total_due)),\n  MAD_high = ceiling(median(total_due) + mad(total_due))\n ) %>% \n ungroup()\n\n\n\n# plot\nddf %>% \n hchart(type = \"column\", hcaes(y = median_USD, x = hour_purchase), name = \"hour\") %>% \n hc_add_series(\n  data = ddf, type = \"errorbar\", hcaes(y = median_USD, low = MAD_low, high = MAD_high),\n  name = \"MAD\"\n ) %>% \n hc_title(text = \"US$ per hour segment\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"highchart html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-ec9553da2cac271800d2\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-ec9553da2cac271800d2\">{\"x\":{\"hc_opts\":{\"chart\":{\"reflow\":true},\"title\":{\"text\":\"US$ per hour segment\"},\"yAxis\":{\"title\":{\"text\":\"median_USD\"},\"type\":\"linear\"},\"credits\":{\"enabled\":false},\"exporting\":{\"enabled\":false},\"boost\":{\"enabled\":false},\"plotOptions\":{\"series\":{\"label\":{\"enabled\":false},\"turboThreshold\":0,\"showInLegend\":false},\"treemap\":{\"layoutAlgorithm\":\"squarified\"},\"scatter\":{\"marker\":{\"symbol\":\"circle\"}}},\"series\":[{\"group\":\"group\",\"data\":[{\"hour_purchase\":0,\"median_USD\":42.5,\"MAD_USD\":35.5824,\"MAD_low\":6,\"MAD_high\":79,\"x\":0,\"y\":42.5},{\"hour_purchase\":1,\"median_USD\":46,\"MAD_USD\":36.3237,\"MAD_low\":9,\"MAD_high\":83,\"x\":1,\"y\":46},{\"hour_purchase\":2,\"median_USD\":46,\"MAD_USD\":37.065,\"MAD_low\":8,\"MAD_high\":84,\"x\":2,\"y\":46},{\"hour_purchase\":3,\"median_USD\":55,\"MAD_USD\":38.5476,\"MAD_low\":16,\"MAD_high\":94,\"x\":3,\"y\":55},{\"hour_purchase\":4,\"median_USD\":46,\"MAD_USD\":36.3237,\"MAD_low\":9,\"MAD_high\":83,\"x\":4,\"y\":46},{\"hour_purchase\":5,\"median_USD\":50,\"MAD_USD\":38.5476,\"MAD_low\":11,\"MAD_high\":89,\"x\":5,\"y\":50},{\"hour_purchase\":6,\"median_USD\":57,\"MAD_USD\":45.9606,\"MAD_low\":11,\"MAD_high\":103,\"x\":6,\"y\":57},{\"hour_purchase\":7,\"median_USD\":44,\"MAD_USD\":32.6172,\"MAD_low\":11,\"MAD_high\":77,\"x\":7,\"y\":44},{\"hour_purchase\":8,\"median_USD\":49.5,\"MAD_USD\":37.8063,\"MAD_low\":11,\"MAD_high\":88,\"x\":8,\"y\":49.5},{\"hour_purchase\":9,\"median_USD\":46.5,\"MAD_USD\":34.0998,\"MAD_low\":12,\"MAD_high\":81,\"x\":9,\"y\":46.5},{\"hour_purchase\":10,\"median_USD\":48,\"MAD_USD\":34.0998,\"MAD_low\":13,\"MAD_high\":83,\"x\":10,\"y\":48},{\"hour_purchase\":11,\"median_USD\":47,\"MAD_USD\":35.5824,\"MAD_low\":11,\"MAD_high\":83,\"x\":11,\"y\":47},{\"hour_purchase\":12,\"median_USD\":45.5,\"MAD_USD\":31.8759,\"MAD_low\":13,\"MAD_high\":78,\"x\":12,\"y\":45.5},{\"hour_purchase\":13,\"median_USD\":46,\"MAD_USD\":34.0998,\"MAD_low\":11,\"MAD_high\":81,\"x\":13,\"y\":46},{\"hour_purchase\":14,\"median_USD\":44,\"MAD_USD\":34.0998,\"MAD_low\":9,\"MAD_high\":79,\"x\":14,\"y\":44},{\"hour_purchase\":15,\"median_USD\":53.5,\"MAD_USD\":37.8063,\"MAD_low\":15,\"MAD_high\":92,\"x\":15,\"y\":53.5},{\"hour_purchase\":16,\"median_USD\":48,\"MAD_USD\":36.3237,\"MAD_low\":11,\"MAD_high\":85,\"x\":16,\"y\":48},{\"hour_purchase\":17,\"median_USD\":51,\"MAD_USD\":37.065,\"MAD_low\":13,\"MAD_high\":89,\"x\":17,\"y\":51},{\"hour_purchase\":18,\"median_USD\":49,\"MAD_USD\":40.0302,\"MAD_low\":8,\"MAD_high\":90,\"x\":18,\"y\":49},{\"hour_purchase\":19,\"median_USD\":46,\"MAD_USD\":34.0998,\"MAD_low\":11,\"MAD_high\":81,\"x\":19,\"y\":46},{\"hour_purchase\":20,\"median_USD\":48,\"MAD_USD\":44.478,\"MAD_low\":3,\"MAD_high\":93,\"x\":20,\"y\":48},{\"hour_purchase\":21,\"median_USD\":52,\"MAD_USD\":41.5128,\"MAD_low\":10,\"MAD_high\":94,\"x\":21,\"y\":52},{\"hour_purchase\":22,\"median_USD\":47,\"MAD_USD\":35.5824,\"MAD_low\":11,\"MAD_high\":83,\"x\":22,\"y\":47},{\"hour_purchase\":23,\"median_USD\":48,\"MAD_USD\":34.0998,\"MAD_low\":13,\"MAD_high\":83,\"x\":23,\"y\":48}],\"type\":\"column\",\"name\":\"hour\"},{\"group\":\"group\",\"data\":[{\"hour_purchase\":0,\"median_USD\":42.5,\"MAD_USD\":35.5824,\"MAD_low\":6,\"MAD_high\":79,\"y\":42.5,\"low\":6,\"high\":79},{\"hour_purchase\":1,\"median_USD\":46,\"MAD_USD\":36.3237,\"MAD_low\":9,\"MAD_high\":83,\"y\":46,\"low\":9,\"high\":83},{\"hour_purchase\":2,\"median_USD\":46,\"MAD_USD\":37.065,\"MAD_low\":8,\"MAD_high\":84,\"y\":46,\"low\":8,\"high\":84},{\"hour_purchase\":3,\"median_USD\":55,\"MAD_USD\":38.5476,\"MAD_low\":16,\"MAD_high\":94,\"y\":55,\"low\":16,\"high\":94},{\"hour_purchase\":4,\"median_USD\":46,\"MAD_USD\":36.3237,\"MAD_low\":9,\"MAD_high\":83,\"y\":46,\"low\":9,\"high\":83},{\"hour_purchase\":5,\"median_USD\":50,\"MAD_USD\":38.5476,\"MAD_low\":11,\"MAD_high\":89,\"y\":50,\"low\":11,\"high\":89},{\"hour_purchase\":6,\"median_USD\":57,\"MAD_USD\":45.9606,\"MAD_low\":11,\"MAD_high\":103,\"y\":57,\"low\":11,\"high\":103},{\"hour_purchase\":7,\"median_USD\":44,\"MAD_USD\":32.6172,\"MAD_low\":11,\"MAD_high\":77,\"y\":44,\"low\":11,\"high\":77},{\"hour_purchase\":8,\"median_USD\":49.5,\"MAD_USD\":37.8063,\"MAD_low\":11,\"MAD_high\":88,\"y\":49.5,\"low\":11,\"high\":88},{\"hour_purchase\":9,\"median_USD\":46.5,\"MAD_USD\":34.0998,\"MAD_low\":12,\"MAD_high\":81,\"y\":46.5,\"low\":12,\"high\":81},{\"hour_purchase\":10,\"median_USD\":48,\"MAD_USD\":34.0998,\"MAD_low\":13,\"MAD_high\":83,\"y\":48,\"low\":13,\"high\":83},{\"hour_purchase\":11,\"median_USD\":47,\"MAD_USD\":35.5824,\"MAD_low\":11,\"MAD_high\":83,\"y\":47,\"low\":11,\"high\":83},{\"hour_purchase\":12,\"median_USD\":45.5,\"MAD_USD\":31.8759,\"MAD_low\":13,\"MAD_high\":78,\"y\":45.5,\"low\":13,\"high\":78},{\"hour_purchase\":13,\"median_USD\":46,\"MAD_USD\":34.0998,\"MAD_low\":11,\"MAD_high\":81,\"y\":46,\"low\":11,\"high\":81},{\"hour_purchase\":14,\"median_USD\":44,\"MAD_USD\":34.0998,\"MAD_low\":9,\"MAD_high\":79,\"y\":44,\"low\":9,\"high\":79},{\"hour_purchase\":15,\"median_USD\":53.5,\"MAD_USD\":37.8063,\"MAD_low\":15,\"MAD_high\":92,\"y\":53.5,\"low\":15,\"high\":92},{\"hour_purchase\":16,\"median_USD\":48,\"MAD_USD\":36.3237,\"MAD_low\":11,\"MAD_high\":85,\"y\":48,\"low\":11,\"high\":85},{\"hour_purchase\":17,\"median_USD\":51,\"MAD_USD\":37.065,\"MAD_low\":13,\"MAD_high\":89,\"y\":51,\"low\":13,\"high\":89},{\"hour_purchase\":18,\"median_USD\":49,\"MAD_USD\":40.0302,\"MAD_low\":8,\"MAD_high\":90,\"y\":49,\"low\":8,\"high\":90},{\"hour_purchase\":19,\"median_USD\":46,\"MAD_USD\":34.0998,\"MAD_low\":11,\"MAD_high\":81,\"y\":46,\"low\":11,\"high\":81},{\"hour_purchase\":20,\"median_USD\":48,\"MAD_USD\":44.478,\"MAD_low\":3,\"MAD_high\":93,\"y\":48,\"low\":3,\"high\":93},{\"hour_purchase\":21,\"median_USD\":52,\"MAD_USD\":41.5128,\"MAD_low\":10,\"MAD_high\":94,\"y\":52,\"low\":10,\"high\":94},{\"hour_purchase\":22,\"median_USD\":47,\"MAD_USD\":35.5824,\"MAD_low\":11,\"MAD_high\":83,\"y\":47,\"low\":11,\"high\":83},{\"hour_purchase\":23,\"median_USD\":48,\"MAD_USD\":34.0998,\"MAD_low\":13,\"MAD_high\":83,\"y\":48,\"low\":13,\"high\":83}],\"type\":\"errorbar\",\"name\":\"MAD\"}],\"xAxis\":{\"type\":\"linear\",\"title\":{\"text\":\"hour_purchase\"},\"categories\":null}},\"theme\":{\"chart\":{\"backgroundColor\":\"transparent\"},\"colors\":[\"#7cb5ec\",\"#434348\",\"#90ed7d\",\"#f7a35c\",\"#8085e9\",\"#f15c80\",\"#e4d354\",\"#2b908f\",\"#f45b5b\",\"#91e8e1\"]},\"conf_opts\":{\"global\":{\"Date\":null,\"VMLRadialGradientURL\":\"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png\",\"canvasToolsURL\":\"http =//code.highcharts.com/list(version)/modules/canvas-tools.js\",\"getTimezoneOffset\":null,\"timezoneOffset\":0,\"useUTC\":true},\"lang\":{\"contextButtonTitle\":\"Chart context menu\",\"decimalPoint\":\".\",\"downloadCSV\":\"Download CSV\",\"downloadJPEG\":\"Download JPEG image\",\"downloadPDF\":\"Download PDF document\",\"downloadPNG\":\"Download PNG image\",\"downloadSVG\":\"Download SVG vector image\",\"downloadXLS\":\"Download XLS\",\"drillUpText\":\"◁ Back to {series.name}\",\"exitFullscreen\":\"Exit from full screen\",\"exportData\":{\"annotationHeader\":\"Annotations\",\"categoryDatetimeHeader\":\"DateTime\",\"categoryHeader\":\"Category\"},\"hideData\":\"Hide data table\",\"invalidDate\":null,\"loading\":\"Loading...\",\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"noData\":\"No data to display\",\"numericSymbolMagnitude\":1000,\"numericSymbols\":[\"k\",\"M\",\"G\",\"T\",\"P\",\"E\"],\"printChart\":\"Print chart\",\"resetZoom\":\"Reset zoom\",\"resetZoomTitle\":\"Reset zoom level 1:1\",\"shortMonths\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"shortWeekdays\":[\"Sat\",\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\"],\"thousandsSep\":\" \",\"viewData\":\"View data table\",\"viewFullscreen\":\"View in full screen\",\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]}},\"type\":\"chart\",\"fonts\":[],\"debug\":false},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n\n:::\n\n<br>\n\n# Summary of Main Results\n\n- The session duration decreases exponentially: **the median session** - when counting all timepoints - **is just less than 20 minutes**. When the estimate is restricted to sessions within an hour, purchases happen in less than 15 minutes (median).\n\n- **80% of all sessions last less than 1 hour, and ~ 70% less than 30 minutes**, with no apparent effect of time of the day, week or year.\n\n- This is also the timeframe in which the amount order tend to increase, although only in a fraction of purchases\n\n- User who choose the **ON SALE category** of the website have **longer sessions**, record more events and **spend more**\n\n- **Returning customers** purchase within **a few minutes less (~ 4 minutes)** than new customers. However, returning customers do _not_ spend more than new customers\n\n- Session duration and order amount for **referral purchases are comparable to non-referral purchases** (difference is significant but effect size is too small to be relevant : ~ 1 minute)\n\n- Interestingly, there is no significant difference in session time for people using either a desktop or a mobile device \n\n\n<br>\n\n# Insights\n\n- **Focus on sleek UX**: It does not appear that longer session would increase sales or order value, therefore any plan (if present) to increase the complexity of the webstore - to increase the time spent navigating the webstore - should be evaluated with caution\n\n- **Potentiate the ON SALE section**: The ON SALE section of the website drives longer sessions (~ 25 minutes) and higher revenues than all the other sections. Currently it attracts about 12% of the visitors. On the basis of the current data, a potentiation of the ON SALE section has the best prospect for increasing revenues\n\n- **Activate recurring customer**: Currently, recurring customers are faster to purchase, but do not spend more than new customers. This suggests that the UX is not building enthusiasm for the products. One could explore using personalized recommendation and - if this improves sales - implementing a \"Suggested for You\" section on the website based on historical data.\n\n\n\n# Appendix: Box-Cox transformation\n\nThe session time data follows a power law. We used a log transformation to make the data more close to a normal distribution, however this transformation was suboptimal, as it can be seen from the following.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# limit TTP to one hour max\nx <- df$TTP[df$TTP < 3600]\n\npar(mfrow = c(2,2))\n\nhist(x)\nhist(log(x))\n\nqqnorm(x, main = \"Q-Q plot of TTP\")\nqqnorm(log(x), main = \"Q-Q plot of log(TTP)\")\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n\n```{.r .cell-code}\nshapiro.test(log(x))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tShapiro-Wilk normality test\n\ndata:  log(x)\nW = 0.98783, p-value = 2.715e-16\n```\n:::\n:::\n\n\nTo work around this issue, we used nonparametric tests in our comparisons (although permutation tests would have probably be better).\n\nNow we try a better way to transform data, namely using the **Box-Cox transformation**.\nFor this we follow the book \"R for Marketing Analytics\" at page 102 and subsequent.\n\nBox-Cox transformation is useful whenever our data follow a power law, such as $y = x^{-m} = 1/x^{m}$\n\nIn these cases, the Box-Cox transformation works by estimating a value $lambda$ which is used as follows:\n\n- $y^\\lambda = \\frac{y^{\\lambda} - 1}{\\lambda}$ if $\\lambda \\neq 0$\n- $y^\\lambda = log(\\lambda)$ if $\\lambda = 0$\n\nWith the aim of approximating a normal distribution in the transformed data.\n\nTo estimate the value of lambda, we can use `car::powerTransform`\n\n\n::: {.cell}\n\n```{.r .fold-show .cell-code}\nlibrary(car)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: carData\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'car'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:dplyr':\n\n    recode\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:purrr':\n\n    some\n```\n:::\n\n```{.r .fold-show .cell-code}\nlambda <- powerTransform(1/x) %>% coef\n```\n:::\n\n\nand then using this value to transform our data:\n\n\n::: {.cell}\n\n```{.r .fold-show .cell-code}\nxbc <- bcPower(x, lambda)\n```\n:::\n\n::: {.cell}\n\n```{.r .fold-show .cell-code}\npar(mfrow = c(2,2))\n\nhist(xbc, breaks = 30, main = \"PMF of Box-Cox(x)\")\n\nhist(log(x), breaks = 30, main = \"PMF of log(x)\")\n\nqqnorm(xbc, main = \"Q-Q plot of the Box-Cox transform of x\")\n\nqqplot(xbc, log(x), main = \"Q-Q plot of xbc ~ log(x)\")\n```\n\n::: {.cell-output-display}\n![](Product_Analysis_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n\n```{.r .fold-show .cell-code}\nshapiro.test(xbc)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tShapiro-Wilk normality test\n\ndata:  xbc\nW = 0.97822, p-value < 2.2e-16\n```\n:::\n:::\n\n\n\nIn this case we can see - from the plots and from the Shapiro test for normality - that the Box-Cox transformation does not manage to achieve a better approximation to normality with respect to our choice of log(TTP)\n\n\n\n\n\n\n\n",
    "supporting": [
      "Product_Analysis_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.6.0/htmlwidgets.js\"></script>\n<script src=\"../../site_libs/plotly-binding-4.10.1/plotly.js\"></script>\n<script src=\"../../site_libs/typedarray-0.1/typedarray.min.js\"></script>\n<script src=\"../../site_libs/jquery-3.5.1/jquery.min.js\"></script>\n<link href=\"../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\n<link href=\"../../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/plotly-main-2.11.1/plotly-latest.min.js\"></script>\n<script src=\"../../site_libs/core-js-2.5.3/shim.min.js\"></script>\n<script src=\"../../site_libs/react-17.0.0/react.min.js\"></script>\n<script src=\"../../site_libs/react-17.0.0/react-dom.min.js\"></script>\n<script src=\"../../site_libs/reactwidget-1.0.0/react-tools.js\"></script>\n<link href=\"../../site_libs/reactable-0.4.1/reactable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/reactable-binding-0.4.1/reactable.js\"></script>\n<script src=\"../../site_libs/proj4js-2.3.15/proj4.js\"></script>\n<link href=\"../../site_libs/highcharts-9.3.1/css/motion.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/highcharts-9.3.1/highcharts.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/highcharts-3d.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/highcharts-more.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/stock.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/map.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/data.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/exporting.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/offline-exporting.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/drilldown.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/item-series.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/overlapping-datalabels.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/annotations.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/export-data.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/funnel.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/heatmap.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/treemap.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/sankey.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/dependency-wheel.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/organization.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/solid-gauge.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/streamgraph.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/sunburst.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/vector.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/wordcloud.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/xrange.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/tilemap.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/venn.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/gantt.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/timeline.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/parallel-coordinates.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/bullet.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/coloraxis.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/dumbbell.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/lollipop.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/series-label.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/plugins/motion.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/custom/reset.js\"></script>\n<script src=\"../../site_libs/highcharts-9.3.1/modules/boost.js\"></script>\n<script src=\"../../site_libs/highchart-binding-0.9.4/highchart.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}