<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Leonardo Cerliani">
<meta name="dcterms.date" content="2023-07-23">

<title>LC - Framingham CHD logistic regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<link href="../../site_libs/tabwid-1.1.2/tabwid.css" rel="stylesheet">
<script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="../../site_libs/htmlwidgets-1.6.0/htmlwidgets.js"></script>
<script src="../../site_libs/jquery-3.5.1/jquery.min.js"></script>
<script src="../../site_libs/proj4js-2.3.15/proj4.js"></script>
<link href="../../site_libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="../../site_libs/highcharts-9.3.1/highcharts.js"></script>
<script src="../../site_libs/highcharts-9.3.1/highcharts-3d.js"></script>
<script src="../../site_libs/highcharts-9.3.1/highcharts-more.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/stock.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/map.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/data.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/exporting.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/offline-exporting.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/drilldown.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/item-series.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/annotations.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/export-data.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/funnel.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/heatmap.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/treemap.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/sankey.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/dependency-wheel.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/organization.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/solid-gauge.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/streamgraph.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/sunburst.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/vector.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/wordcloud.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/xrange.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/tilemap.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/venn.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/gantt.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/timeline.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/bullet.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/coloraxis.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/dumbbell.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/lollipop.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/series-label.js"></script>
<script src="../../site_libs/highcharts-9.3.1/plugins/motion.js"></script>
<script src="../../site_libs/highcharts-9.3.1/custom/reset.js"></script>
<script src="../../site_libs/highcharts-9.3.1/modules/boost.js"></script>
<script src="../../site_libs/highchart-binding-0.9.4/highchart.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">LC</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">about</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html">
 <span class="menu-text">blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../showcase.html">
 <span class="menu-text">showcase</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#main-takeaways" id="toc-main-takeaways" class="nav-link" data-scroll-target="#main-takeaways">Main takeaways</a></li>
  <li><a href="#column-description" id="toc-column-description" class="nav-link" data-scroll-target="#column-description">Column description</a></li>
  <li><a href="#load-libraries-and-data" id="toc-load-libraries-and-data" class="nav-link" data-scroll-target="#load-libraries-and-data">Load libraries and data</a></li>
  <li><a href="#split-traintest" id="toc-split-traintest" class="nav-link" data-scroll-target="#split-traintest">Split train/test</a></li>
  <li><a href="#outliers-check" id="toc-outliers-check" class="nav-link" data-scroll-target="#outliers-check">Outliers check</a></li>
  <li><a href="#eda-of-numerical-variables" id="toc-eda-of-numerical-variables" class="nav-link" data-scroll-target="#eda-of-numerical-variables">EDA of numerical variables</a>
  <ul class="collapse">
  <li><a href="#two-independent-samples-t-tests" id="toc-two-independent-samples-t-tests" class="nav-link" data-scroll-target="#two-independent-samples-t-tests">Two-independent-samples t-tests</a>
  <ul class="collapse">
  <li><a href="#age" id="toc-age" class="nav-link" data-scroll-target="#age">Age</a></li>
  <li><a href="#systolic-blood-pressure" id="toc-systolic-blood-pressure" class="nav-link" data-scroll-target="#systolic-blood-pressure">Systolic blood pressure</a></li>
  <li><a href="#diastolic-blood-pressure" id="toc-diastolic-blood-pressure" class="nav-link" data-scroll-target="#diastolic-blood-pressure">Diastolic blood pressure</a></li>
  <li><a href="#glucose" id="toc-glucose" class="nav-link" data-scroll-target="#glucose">Glucose</a></li>
  <li><a href="#bmi" id="toc-bmi" class="nav-link" data-scroll-target="#bmi">BMI</a></li>
  <li><a href="#cholesterol-level" id="toc-cholesterol-level" class="nav-link" data-scroll-target="#cholesterol-level">Cholesterol level</a></li>
  </ul></li>
  <li><a href="#correlation-matrix" id="toc-correlation-matrix" class="nav-link" data-scroll-target="#correlation-matrix">Correlation matrix</a></li>
  <li><a href="#observations---numerical-evs" id="toc-observations---numerical-evs" class="nav-link" data-scroll-target="#observations---numerical-evs">Observations - numerical EVs</a></li>
  </ul></li>
  <li><a href="#eda-of-categorical-variables" id="toc-eda-of-categorical-variables" class="nav-link" data-scroll-target="#eda-of-categorical-variables">EDA of categorical variables</a>
  <ul class="collapse">
  <li><a href="#chi-square-tests" id="toc-chi-square-tests" class="nav-link" data-scroll-target="#chi-square-tests">Chi-square tests</a>
  <ul class="collapse">
  <li><a href="#sex-male" id="toc-sex-male" class="nav-link" data-scroll-target="#sex-male">Sex (male)</a></li>
  <li><a href="#hypertension" id="toc-hypertension" class="nav-link" data-scroll-target="#hypertension">Hypertension</a></li>
  <li><a href="#cigarettes-per-day" id="toc-cigarettes-per-day" class="nav-link" data-scroll-target="#cigarettes-per-day">Cigarettes per day</a></li>
  <li><a href="#current-smoker" id="toc-current-smoker" class="nav-link" data-scroll-target="#current-smoker">Current smoker</a></li>
  <li><a href="#blood-pressure-medication" id="toc-blood-pressure-medication" class="nav-link" data-scroll-target="#blood-pressure-medication">Blood pressure medication</a></li>
  <li><a href="#education" id="toc-education" class="nav-link" data-scroll-target="#education">Education</a></li>
  </ul></li>
  <li><a href="#association-matrix-categorical" id="toc-association-matrix-categorical" class="nav-link" data-scroll-target="#association-matrix-categorical">Association matrix (categorical)</a></li>
  <li><a href="#observations---categorical-evs" id="toc-observations---categorical-evs" class="nav-link" data-scroll-target="#observations---categorical-evs">Observations - categorical EVs</a></li>
  </ul></li>
  <li><a href="#choice-of-predictors" id="toc-choice-of-predictors" class="nav-link" data-scroll-target="#choice-of-predictors">Choice of predictors</a>
  <ul class="collapse">
  <li><a href="#age-1" id="toc-age-1" class="nav-link" data-scroll-target="#age-1">age</a></li>
  <li><a href="#bmi-1" id="toc-bmi-1" class="nav-link" data-scroll-target="#bmi-1">bmi</a></li>
  <li><a href="#hypertension-sys_bp" id="toc-hypertension-sys_bp" class="nav-link" data-scroll-target="#hypertension-sys_bp">hypertension (sys_bp)</a></li>
  <li><a href="#glucose-level" id="toc-glucose-level" class="nav-link" data-scroll-target="#glucose-level">glucose level</a></li>
  <li><a href="#cholesterol-level-1" id="toc-cholesterol-level-1" class="nav-link" data-scroll-target="#cholesterol-level-1">cholesterol level</a></li>
  </ul></li>
  <li><a href="#na-assessment" id="toc-na-assessment" class="nav-link" data-scroll-target="#na-assessment">NA Assessment</a>
  <ul class="collapse">
  <li><a href="#bmi-2" id="toc-bmi-2" class="nav-link" data-scroll-target="#bmi-2">bmi</a></li>
  <li><a href="#glucose-1" id="toc-glucose-1" class="nav-link" data-scroll-target="#glucose-1">glucose</a></li>
  <li><a href="#cholesterol" id="toc-cholesterol" class="nav-link" data-scroll-target="#cholesterol">cholesterol</a></li>
  <li><a href="#bp_meds" id="toc-bp_meds" class="nav-link" data-scroll-target="#bp_meds">bp_meds</a></li>
  </ul></li>
  <li><a href="#analytic-strategy" id="toc-analytic-strategy" class="nav-link" data-scroll-target="#analytic-strategy">Analytic strategy</a></li>
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression">Logistic regression</a>
  <ul class="collapse">
  <li><a href="#procedure-for-stepwise-modelling" id="toc-procedure-for-stepwise-modelling" class="nav-link" data-scroll-target="#procedure-for-stepwise-modelling">Procedure for stepwise modelling</a></li>
  <li><a href="#format-of-the-summary-tables" id="toc-format-of-the-summary-tables" class="nav-link" data-scroll-target="#format-of-the-summary-tables">Format of the summary tables</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  <li><a href="#manual-stepwise" id="toc-manual-stepwise" class="nav-link" data-scroll-target="#manual-stepwise">Manual stepwise</a>
  <ul class="collapse">
  <li><a href="#maximal-model" id="toc-maximal-model" class="nav-link" data-scroll-target="#maximal-model">Maximal model</a></li>
  <li><a href="#full-with-selected-variables" id="toc-full-with-selected-variables" class="nav-link" data-scroll-target="#full-with-selected-variables">Full with selected variables</a></li>
  <li><a href="#remove-no-effect-evs" id="toc-remove-no-effect-evs" class="nav-link" data-scroll-target="#remove-no-effect-evs">Remove no-effect EVs</a></li>
  <li><a href="#remove-prevalent_hyp" id="toc-remove-prevalent_hyp" class="nav-link" data-scroll-target="#remove-prevalent_hyp">Remove prevalent_hyp</a></li>
  <li><a href="#assess-categorical-interactions" id="toc-assess-categorical-interactions" class="nav-link" data-scroll-target="#assess-categorical-interactions">Assess categorical interactions</a></li>
  <li><a href="#sigmoid-for-age" id="toc-sigmoid-for-age" class="nav-link" data-scroll-target="#sigmoid-for-age">Sigmoid for age</a></li>
  <li><a href="#final-model-using-thr-0.5" id="toc-final-model-using-thr-0.5" class="nav-link" data-scroll-target="#final-model-using-thr-0.5">Final model using thr = 0.5</a></li>
  <li><a href="#final-model-using-thr-0.1" id="toc-final-model-using-thr-0.1" class="nav-link" data-scroll-target="#final-model-using-thr-0.1">Final model using thr = 0.1</a></li>
  </ul></li>
  <li><a href="#automatic-stepwise" id="toc-automatic-stepwise" class="nav-link" data-scroll-target="#automatic-stepwise">Automatic stepwise</a></li>
  <li><a href="#samples-balanced-for-chd-risk" id="toc-samples-balanced-for-chd-risk" class="nav-link" data-scroll-target="#samples-balanced-for-chd-risk">Samples balanced for CHD risk</a></li>
  </ul></li>
  <li><a href="#chd-prediction-app" id="toc-chd-prediction-app" class="nav-link" data-scroll-target="#chd-prediction-app">CHD Prediction app</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Framingham CHD logistic regression</h1>
<p class="subtitle lead">Modelling the 10-years risk of coronary heart disease</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Leonardo Cerliani </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 23, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The <a href="https://datacatalog.med.nyu.edu/dataset/10046">Framingham dataset</a> (available also on <a href="https://www.kaggle.com/datasets/aasheesh200/framingham-heart-study-dataset">kaggle</a>) is an ongoing study which has been running since 1948. It aims to identify demographic, lifestyle and medical factors which are associated with the 10-year risk of developing heart disease.</p>
<p>Here we use logistic regression to model the 10-year risk of coronary heart disease (CHD). The dataset consists of:</p>
<ul>
<li><p>4238 individuals, 15% of which with assessed risk of CHD</p></li>
<li><p>43% males, 57% females between 32 and 70 yrs (median age = 49)</p></li>
<li><p>15 recorded variables, including education, smoking habits, blood pressure measurements and anomalies, blood sample indices (e.g.&nbsp;glucose), medicament assumptions.</p></li>
</ul>
</section>
<section id="main-takeaways" class="level1">
<h1>Main takeaways</h1>
<p><a href="https://github.com/leonardocerliani/TC_projects/blob/main/CHD_Logistic_regression/presentation_framingham.pdf">Presentation slides</a></p>
<ul>
<li><p><strong>The final model correctly predicts risk of CHD in 10 years in 83% of the people who are actually at risk (sensitivity)</strong> when the threshold for binary classification is set at 0.1</p></li>
<li><p>The choice of this threshold (0.1) leads to many false positives, however given the potential life-threatening implications of false negatives - and the relatively simple continous monitoring of the patients with positive prediction - the choice obviously falls on maximising the sensitivity.</p></li>
<li><p><strong>The model is simple, contaning only easily retrievable variables</strong>: sex, age, systolic blood pressure, glucose and smoking habits</p></li>
<li><p>Assumption of blood pressure medicaments does <em>not</em> appear to decrease the odds of CHD risk</p></li>
<li><p>The amount of explained variance is moderate (17%). Other unexplored variables such as alcohol consumption, stress and wealth (among others) might improve model fit and performance.</p></li>
</ul>
</section>
<section id="column-description" class="level1">
<h1>Column description</h1>
<ul>
<li><strong>Sex</strong>: male or female(Nominal)</li>
<li><strong>Age</strong>: Age of the patient;(Continuous - Although the recorded ages have been truncated to whole numbers, the concept of age is continuous)</li>
<li><strong>Current Smoker</strong>: whether or not the patient is a current smoker (Nominal)</li>
<li><strong>Cigs Per Day</strong>: the number of cigarettes that the person smoked on average in one day.(can be considered continuous as one can have any number of cigarettes, even half a cigarette.)</li>
</ul>
<p>Medical( history)</p>
<ul>
<li><strong>BP Meds</strong>: whether or not the patient was on blood pressure medication (Nominal)</li>
<li><strong>Prevalent Stroke</strong>: whether or not the patient had previously had a stroke (Nominal)</li>
<li><strong>Prevalent Hyp</strong>: whether or not the patient was hypertensive (Nominal)</li>
<li><strong>Diabetes</strong>: whether or not the patient had diabetes (Nominal)</li>
<li><strong>Tot Chol</strong>: total cholesterol level (Continuous)</li>
<li><strong>Sys BP</strong>: systolic blood pressure (Continuous)</li>
<li><strong>Dia BP</strong>: diastolic blood pressure (Continuous)</li>
<li><strong>BMI</strong>: Body Mass Index (Continuous)</li>
<li><strong>Heart Rate</strong>: heart rate (Continuous - In medical research, variables such as heart rate though in fact discrete, yet are considered continuous because of large number of possible values.)</li>
<li><strong>Glucose</strong>: glucose level (Continuous)</li>
</ul>
<p>Predict variable (desired target) - <strong>10 year risk of coronary heart disease CHD</strong> (binary: “1”, means “Yes”, “0” means “No”)</p>
<p><em>Abbreviations:</em> - <strong>EDA</strong> : Exploratory Data Analysis - <strong>EV</strong> : Explanatory Variable (i.e.&nbsp;predictor)</p>
</section>
<section id="load-libraries-and-data" class="level1">
<h1>Load libraries and data</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dlookr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flextable)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jtools)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggstatsplot)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jtools)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(highcharter)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>select <span class="ot">&lt;-</span> dplyr<span class="sc">::</span>select</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Graded_task_Heart_disease_data.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a> tibble <span class="sc">%&gt;%</span> </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a> janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># change appropriate variables to factor</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate_at</span>(</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a> <span class="fu">c</span>(<span class="st">"male"</span>,<span class="st">"education"</span>,<span class="st">"current_smoker"</span>,<span class="st">"bp_meds"</span>,</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>   <span class="st">"prevalent_stroke"</span>,<span class="st">"prevalent_hyp"</span>,</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>   <span class="st">"diabetes"</span>,<span class="st">"ten_year_chd"</span>), factor</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># df %&gt;% glimpse()</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># dlookr::diagnose(df) %&gt;% flextable</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="split-traintest" class="level1">
<h1>Split train/test</h1>
<p>To estimate the perfomance of the model with out-of-sample data, we split the whole dataset in a train (60% - 2543 data points) and test (40% - 1695 data points) set.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">124</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="fu">nrow</span>(df)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>split_index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"train"</span>,<span class="st">"test"</span>), N, <span class="at">replace =</span> T, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.6</span>,<span class="fl">0.4</span>))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> df[<span class="fu">which</span>(split_index <span class="sc">==</span> <span class="st">"train"</span>),]  <span class="co"># train set</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> df[<span class="fu">which</span>(split_index <span class="sc">==</span> <span class="st">"test"</span>),]  <span class="co"># test set</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="outliers-check" class="level1">
<h1>Outliers check</h1>
<p>We will carry out the check for outliers - and subsequently evaluate potential imputation for NA - only on the train data, and blindly apply this to the test. In a real world situation, the test set can grow continously, therefore we need to take decisions only on the train data.</p>
<p>The evaluation for potential NA imputation will be carried out later, just before modelling. The reason for this is that carrying out NA imputation first would bias the EDA.</p>
<p><strong>Observations</strong> All the numerical values are in the norm, except for blood pressure. Specifically, the systolic blood pressure <code>sys_bp</code> is way too high, with about 4% of the participants having a bp &gt; 180 (requiring immediate medical care).</p>
<p>However, in published papers on the Framinghton studies these values are accepted as plausible. We will therefore only exclude values above 250 mmHg.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># train %&gt;% select_if(is.numeric) %&gt;% summary()</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># boxplot(glucose ~ diabetes, data = train, main = "glucose ~ diabetes")</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(sys_bp <span class="sc">~</span> bp_meds, <span class="at">data =</span> train, <span class="at">main =</span> <span class="st">"systolic blood pressure ~ bp_meds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(sys_bp <span class="sc">~</span> prevalent_hyp, <span class="at">data =</span> train, <span class="at">main =</span> <span class="st">"systolic blood pressure ~ hypertension"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># percent of people with sys_bp &gt; 180</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>pct_high_sys_bp <span class="ot">&lt;-</span> <span class="fu">round</span>((train<span class="sc">$</span>sys_bp <span class="sc">&gt;</span> <span class="dv">180</span>) <span class="sc">%&gt;%</span> <span class="fu">sum</span>() <span class="sc">/</span> <span class="fu">nrow</span>(train) <span class="sc">*</span> <span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># xtabs(~ prevalent_hyp + bp_meds, data = train)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sys_bp <span class="sc">&lt;=</span> <span class="dv">250</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sys_bp <span class="sc">&lt;=</span> <span class="dv">250</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="eda-of-numerical-variables" class="level1">
<h1>EDA of numerical variables</h1>
<p>Initially, we carry out t-tests to discover which EVs exhibit (corrected) significant differences between people with and without risk of CHD.</p>
<p>Then we will also examine the potential correlations between variables. If the latter are substantial, we will evaluate the possibility of discarding some EVs due to collinearity.</p>
<section id="two-independent-samples-t-tests" class="level2 tabset">
<h2 class="tabset anchored" data-anchor-id="two-independent-samples-t-tests">Two-independent-samples t-tests</h2>
<p>(an excercise in <a href="https://www.youtube.com/watch?v=rz3_FDVt9eg">fitting many models using <code>purrr::map</code></a>)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>ttests <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>   <span class="co"># select("ten_year_chd", "age", "glucose") %&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"education"</span>,<span class="st">"male"</span>,<span class="st">"current_smoker"</span>,<span class="st">"bp_meds"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>           <span class="st">"prevalent_stroke"</span>,<span class="st">"prevalent_hyp"</span>, <span class="st">"diabetes"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>   <span class="co"># pivot longer to prepare the nesting</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">pivot_longer</span>(</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">cols =</span> <span class="sc">-</span>ten_year_chd, </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span> </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>   <span class="co"># fit a model to each nested df</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">ttmod =</span> <span class="fu">map</span>(data, <span class="sc">~</span> <span class="fu">lm</span>(value <span class="sc">~</span> ten_year_chd, <span class="at">data =</span> .x))</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>   <span class="co"># get the stats</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">tidy =</span> <span class="fu">map</span>(ttmod, broom<span class="sc">::</span>tidy)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>   <span class="fu">unnest</span>(tidy) <span class="sc">%&gt;%</span> </span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"ten_year_chd1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>   <span class="co"># correct for multiple comparisons</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">adj_pval =</span> <span class="fu">p.adjust</span>(p.value, <span class="at">method =</span> <span class="st">"fdr"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>   <span class="co"># filter(adj_pval &lt;= 0.01) %&gt;% </span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>   <span class="fu">relocate</span>(adj_pval, <span class="at">.after=</span>variable) <span class="sc">%&gt;%</span> </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(adj_pval)</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>ttests <span class="sc">%&gt;%</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(variable, statistic, adj_pval) <span class="sc">%&gt;%</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">t value</span><span class="st">`</span> <span class="ot">=</span> statistic) <span class="sc">%&gt;%</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flextable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_formatter</span>(<span class="at">adj_pval =</span> <span class="cf">function</span>(x) <span class="fu">sprintf</span>(<span class="st">"%.2e"</span>, x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="tabwid"><style>.cl-c8f5178c{}.cl-c8ebe3ce{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-c8efd97a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-c8efd984{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-c8eff14e{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-c8eff158{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-c8eff162{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-c8eff16c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-c8eff16d{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-c8eff176{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-c8f5178c"><thead><tr style="overflow-wrap:break-word;"><th class="cl-c8eff14e"><p class="cl-c8efd97a"><span class="cl-c8ebe3ce">variable</span></p></th><th class="cl-c8eff158"><p class="cl-c8efd984"><span class="cl-c8ebe3ce">t value</span></p></th><th class="cl-c8eff158"><p class="cl-c8efd984"><span class="cl-c8ebe3ce">adj_pval</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-c8eff162"><p class="cl-c8efd97a"><span class="cl-c8ebe3ce">age</span></p></td><td class="cl-c8eff16c"><p class="cl-c8efd984"><span class="cl-c8ebe3ce">12.0815563</span></p></td><td class="cl-c8eff16c"><p class="cl-c8efd984"><span class="cl-c8ebe3ce">1.01e-31</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-c8eff162"><p class="cl-c8efd97a"><span class="cl-c8ebe3ce">sys_bp</span></p></td><td class="cl-c8eff16c"><p class="cl-c8efd984"><span class="cl-c8ebe3ce">11.9732840</span></p></td><td class="cl-c8eff16c"><p class="cl-c8efd984"><span class="cl-c8ebe3ce">1.73e-31</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-c8eff162"><p class="cl-c8efd97a"><span class="cl-c8ebe3ce">dia_bp</span></p></td><td class="cl-c8eff16c"><p class="cl-c8efd984"><span class="cl-c8ebe3ce">8.2215602</span></p></td><td class="cl-c8eff16c"><p class="cl-c8efd984"><span class="cl-c8ebe3ce">8.85e-16</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-c8eff162"><p class="cl-c8efd97a"><span class="cl-c8ebe3ce">glucose</span></p></td><td class="cl-c8eff16c"><p class="cl-c8efd984"><span class="cl-c8ebe3ce">6.5653995</span></p></td><td class="cl-c8eff16c"><p class="cl-c8efd984"><span class="cl-c8ebe3ce">1.28e-10</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-c8eff162"><p class="cl-c8efd97a"><span class="cl-c8ebe3ce">bmi</span></p></td><td class="cl-c8eff16c"><p class="cl-c8efd984"><span class="cl-c8ebe3ce">5.6308260</span></p></td><td class="cl-c8eff16c"><p class="cl-c8efd984"><span class="cl-c8ebe3ce">3.22e-08</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-c8eff162"><p class="cl-c8efd97a"><span class="cl-c8ebe3ce">tot_chol</span></p></td><td class="cl-c8eff16c"><p class="cl-c8efd984"><span class="cl-c8ebe3ce">4.0326391</span></p></td><td class="cl-c8eff16c"><p class="cl-c8efd984"><span class="cl-c8ebe3ce">7.59e-05</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-c8eff162"><p class="cl-c8efd97a"><span class="cl-c8ebe3ce">cigs_per_day</span></p></td><td class="cl-c8eff16c"><p class="cl-c8efd984"><span class="cl-c8ebe3ce">2.1141771</span></p></td><td class="cl-c8eff16c"><p class="cl-c8efd984"><span class="cl-c8ebe3ce">3.96e-02</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-c8eff16d"><p class="cl-c8efd97a"><span class="cl-c8ebe3ce">heart_rate</span></p></td><td class="cl-c8eff176"><p class="cl-c8efd984"><span class="cl-c8ebe3ce">0.8512159</span></p></td><td class="cl-c8eff176"><p class="cl-c8efd984"><span class="cl-c8ebe3ce">3.95e-01</span></p></td></tr></tbody></table></div>

</div>
</div>
<p><br></p>
<section id="age" class="level3">
<h3 class="anchored" data-anchor-id="age">Age</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> train,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">x =</span> ten_year_chd,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> age</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="systolic-blood-pressure" class="level3">
<h3 class="anchored" data-anchor-id="systolic-blood-pressure">Systolic blood pressure</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> train,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">x =</span> ten_year_chd,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> sys_bp</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="diastolic-blood-pressure" class="level3">
<h3 class="anchored" data-anchor-id="diastolic-blood-pressure">Diastolic blood pressure</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> train,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">x =</span> ten_year_chd,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> dia_bp</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="glucose" class="level3">
<h3 class="anchored" data-anchor-id="glucose">Glucose</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> train,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">x =</span> ten_year_chd,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> glucose</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="bmi" class="level3">
<h3 class="anchored" data-anchor-id="bmi">BMI</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> train,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">x =</span> ten_year_chd,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> bmi</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="cholesterol-level" class="level3">
<h3 class="anchored" data-anchor-id="cholesterol-level">Cholesterol level</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> train,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">x =</span> ten_year_chd,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> tot_chol</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="correlation-matrix" class="level2">
<h2 class="anchored" data-anchor-id="correlation-matrix">Correlation matrix</h2>
<p>Exploring the correlation matrix of the numerical variables to detect potential collinearity</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>train <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a> <span class="co"># select(-c("education","male","current_smoker","bp_meds",</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a> <span class="co">#           "prevalent_stroke","prevalent_hyp", "diabetes")) %&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">select</span>(ten_year_chd, age, sys_bp, dia_bp, bmi, glucose, tot_chol) <span class="sc">%&gt;%</span> </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a> <span class="co"># mutate_at(vars(-ten_year_chd), ~ log(. + 1)) %&gt;% </span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a> GGally<span class="sc">::</span><span class="fu">ggpairs</span>(</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> ten_year_chd),</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"cor"</span>, <span class="at">size =</span> <span class="dv">3</span>)),</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"points"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">1</span>)),</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"densityDiag"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>))</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="observations---numerical-evs" class="level2">
<h2 class="anchored" data-anchor-id="observations---numerical-evs">Observations - numerical EVs</h2>
<ul>
<li><p><code>age</code> appears to be the most discriminant variable for ten year CHD prediction. Other EVs which are significantly different (after correction with FDR) in people with and without CHD risk are <code>bmi</code>, <code>sys_bp</code>, <code>dia_bp</code>, <code>glucose</code>, <code>tot_chol</code>.</p></li>
<li><p>the systolic <code>sys_bp</code> and diastolic <code>dia_bp</code> blood pressure are correlated with each other - as expected. Since CHD is especially related to hypertension, we will only use systolic blood pressure</p></li>
<li><p><code>bmi</code> and <code>age</code> are also correlated with blood pressure, however they appear to be important variables for CHD and their correlation with blood pressure is mild, so we will keep them</p></li>
<li><p>NB: the number of cigarettes per day (<code>cigs_per_day</code>) will be explored as a categorical variable (see below) with levels for tens of cigarettes per day</p></li>
</ul>
</section>
</section>
<section id="eda-of-categorical-variables" class="level1">
<h1>EDA of categorical variables</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># train %&gt;% select_if(is.factor) %&gt;% summary</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>As before for the numerical variables, we will first assess a dependence between risk of CHD and other categorical variables, and then explore the reciprocal relationships of all categorical variables to assess the presence of collinearity.</p>
<section id="chi-square-tests" class="level2 tabset">
<h2 class="tabset anchored" data-anchor-id="chi-square-tests">Chi-square tests</h2>
<section id="sex-male" class="level3">
<h3 class="anchored" data-anchor-id="sex-male">Sex (male)</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggstatsplot)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbarstats</span>(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> train <span class="sc">%&gt;%</span> <span class="fu">select</span>(ten_year_chd, male),</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">x =</span> male,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> ten_year_chd,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>   <span class="at">label =</span> <span class="st">"both"</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="hypertension" class="level3">
<h3 class="anchored" data-anchor-id="hypertension">Hypertension</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbarstats</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> train <span class="sc">%&gt;%</span> <span class="fu">select</span>(ten_year_chd, prevalent_hyp),</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">x =</span> prevalent_hyp,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> ten_year_chd,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">label =</span> <span class="st">"both"</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="cigarettes-per-day" class="level3">
<h3 class="anchored" data-anchor-id="cigarettes-per-day">Cigarettes per day</h3>
<p>The values are too sparse to treat this as a continous variable. We will therefore group the # cigs per day in tens and treat this as a categorical variable.</p>
<p>A first visual exploration shows that there appear to be mild differences in the proportion of people smoking different amount of cigarettes per day.</p>
<p>When carrying out a chi-square test of independence, we are warned that the results might be incorrect. This appears to be due to the fact that there are too few observations in the category for 50 and 60 cigarettes per day. When these levels are removed, a significant (p = 0.0066) dependence is shown between risk group and amount of cigarettes per day.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppress summarise info</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>train <span class="sc">%&gt;%</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(ten_year_chd, cigs_per_day) <span class="sc">%&gt;%</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">cigs_factor =</span> <span class="fu">round</span>(cigs_per_day<span class="sc">/</span><span class="dv">10</span>,<span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(ten_year_chd, cigs_factor) <span class="sc">%&gt;%</span> </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">.group =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(ten_year_chd) <span class="sc">%&gt;%</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">prop =</span> count <span class="sc">/</span> <span class="fu">sum</span>(count)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(ten_year_chd, cigs_factor, prop) <span class="sc">%&gt;%</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(cigs_factor), <span class="at">y =</span> prop, <span class="at">fill =</span> ten_year_chd)) <span class="sc">+</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span> </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Tens of Cigarettes per Day"</span>, <span class="at">y =</span> <span class="st">"Proportion in each group"</span>, <span class="at">fill =</span> <span class="st">"CHD Status"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>train <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(ten_year_chd, cigs_per_day) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">tens_cigarettes =</span> <span class="fu">round</span>(cigs_per_day<span class="sc">/</span><span class="dv">10</span>, <span class="dv">0</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(tens_cigarettes <span class="sc">&lt;</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(<span class="sc">-</span>cigs_per_day) <span class="sc">%&gt;%</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">xtabs</span>(<span class="sc">~</span> ten_year_chd <span class="sc">+</span> tens_cigarettes, <span class="at">data =</span> .) <span class="sc">%&gt;%</span> </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">chisq.test</span>()  <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">"Chi-Square CHD Risk ~ Tens_of_cigarettes"</span> <span class="ot">=</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
<tr><th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">Chi-Square CHD Risk ~ Tens_of_cigarettes</div></th></tr>
  <tr>
   <th style="text-align:right;"> statistic </th>
   <th style="text-align:right;"> p.value </th>
   <th style="text-align:right;"> parameter </th>
   <th style="text-align:left;"> method </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 14.22453 </td>
   <td style="text-align:right;"> 0.0066119 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:left;"> Pearson's Chi-squared test </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
<section id="current-smoker" class="level3">
<h3 class="anchored" data-anchor-id="current-smoker">Current smoker</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbarstats</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> train <span class="sc">%&gt;%</span> <span class="fu">select</span>(ten_year_chd, current_smoker),</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">x =</span> current_smoker,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> ten_year_chd,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">label =</span> <span class="st">"both"</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="blood-pressure-medication" class="level3">
<h3 class="anchored" data-anchor-id="blood-pressure-medication">Blood pressure medication</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbarstats</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> train <span class="sc">%&gt;%</span> <span class="fu">select</span>(ten_year_chd, bp_meds),</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">x =</span> bp_meds,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> ten_year_chd,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">label =</span> <span class="st">"both"</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="education" class="level3">
<h3 class="anchored" data-anchor-id="education">Education</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbarstats</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> train <span class="sc">%&gt;%</span> <span class="fu">select</span>(ten_year_chd, education),</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">x =</span> education,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> ten_year_chd,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">label =</span> <span class="st">"both"</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="association-matrix-categorical" class="level2">
<h2 class="anchored" data-anchor-id="association-matrix-categorical">Association matrix (categorical)</h2>
<p>Graphically display the association between binary categorical variables, including <code>ten_year_chd</code> to assess the presence of correlated predictors</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>train_cat <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(is.factor) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"ten_year_chd"</span>,<span class="st">"education"</span>))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">table</span>(train_cat), </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>   <span class="at">diag_panel =</span> <span class="fu">pairs_diagonal_mosaic</span>(<span class="at">offset_varnames=</span><span class="sc">-</span><span class="fl">2.5</span>),    <span class="co">#move down variable names</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>   <span class="at">upper_panel_args =</span> <span class="fu">list</span>(<span class="at">shade =</span> <span class="cn">TRUE</span>),                       <span class="co">#set shade colors</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>   <span class="at">lower_panel_args =</span> <span class="fu">list</span>(<span class="at">shade =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="observations---categorical-evs" class="level2">
<h2 class="anchored" data-anchor-id="observations---categorical-evs">Observations - categorical EVs</h2>
<ul>
<li>The 10 year risk of CHD is more prevalent in males than in females</li>
<li>Not surprisingly, hypertension and assumption of blood pressure medications is also associated with risk. We will also examine the latter, although only ~ 3% of the sample takes these medications</li>
<li>The number of cigarettes smoked per day (in groups of 10) also increaes the risk of CHD. Interestingly, still, more than 50% of the people who are at risk do not smoke. It would be interesting to have data about the quality of the air of the place where they live, or whether their partner is a smoker.</li>
<li>It is also interesting that the relationship between amount of cigarettes per day and risk is not linear: there are more people at risk among those who smoke 20-30 or 40-50 cigs per day. while among those who smoke 10-20 or 30-40 cigs per day the proportion of people with and without risk is almost 50%. This strange behaviour can probably be - at least in part - explained by the fact that smokers tend to underestimate the amount of cigarettes smoked.</li>
<li>Instead, the fact of being a current smoker does not appear to be a risk factor</li>
<li>There is an interaction between being make, having hypertension and being a current smoker. We will examine whether this interaction can increase the prediction, although the fact of currently smoking <em>per se</em> apparently does not.</li>
</ul>
</section>
</section>
<section id="choice-of-predictors" class="level1 tabset">
<h1 class="tabset">Choice of predictors</h1>
<p><strong>Numerical variables</strong> Age (<code>age</code>), High blood pressure (<code>sys_bp</code>), body-mass index (<code>bmi</code>), glucose blood level (<code>glucose</code>), cholesterol blood level (<code>tot_chol</code>) appear to be involved in predicting the risk of CHD. As noted above, <code>cigs_per_day</code> was treated as a categorical variables with levels for o and multiples of 10.</p>
<p><strong>Categorical variables</strong> Sex (<code>male</code>), hypertension (<code>prevalent_hyp</code>), blood pressure medications (<code>bp_meds</code>), education (<code>education</code>) and number of cigarettes per day (<code>cigs_per_day</code>) appear to be involved in predicting the risk of CHD.</p>
<p>There are widespread associations between numerical and categorical variables. This is <em>not</em> surprising for two reasons:</p>
<ul>
<li>some variables are proxy each other (e.g.&nbsp;<code>sys_bp</code>, <code>prevalence_hyp</code>, <code>bp_meds</code>)</li>
<li>some variables are linked by known relationships: e.g.&nbsp;with <code>age</code>, the <code>bmi</code> increases, and both are likely to lead to increased blood pressure <code>sys_bp</code>, which in turn can lead to hypertension and relative medicaments</li>
</ul>
<p>Despite this, we will enter all the selected variables in the model and assess the presence of collinearity using VIF.</p>
<section id="age-1" class="level2">
<h2 class="anchored" data-anchor-id="age-1">age</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>boxplot_tt <span class="ot">&lt;-</span> <span class="cf">function</span>(response, predictor) {</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>   tt <span class="ot">&lt;-</span> <span class="fu">t.test</span>(train[[response]] <span class="sc">~</span> train[[predictor]], <span class="at">data =</span>train)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>   res <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"t = "</span>, <span class="fu">round</span>(tt<span class="sc">$</span>statistic,<span class="dv">2</span>), <span class="st">" p = "</span>, <span class="fu">round</span>(tt<span class="sc">$</span>p.value,<span class="dv">4</span>))</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>   p <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .data[[predictor]], <span class="at">y =</span> .data[[response]])) <span class="sc">+</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(predictor,<span class="st">" vs "</span>, response),</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">subtitle =</span> res)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(p)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">boxplot_tt</span>(<span class="st">"age"</span>, <span class="st">"male"</span>)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">boxplot_tt</span>(<span class="st">"age"</span>, <span class="st">"prevalent_hyp"</span>)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">boxplot_tt</span>(<span class="st">"age"</span>, <span class="st">"bp_meds"</span>)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="bmi-1" class="level2">
<h2 class="anchored" data-anchor-id="bmi-1">bmi</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">boxplot_tt</span>(<span class="st">"bmi"</span>, <span class="st">"male"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">boxplot_tt</span>(<span class="st">"bmi"</span>, <span class="st">"prevalent_hyp"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">boxplot_tt</span>(<span class="st">"bmi"</span>, <span class="st">"bp_meds"</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="hypertension-sys_bp" class="level2">
<h2 class="anchored" data-anchor-id="hypertension-sys_bp">hypertension (sys_bp)</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">boxplot_tt</span>(<span class="st">"sys_bp"</span>, <span class="st">"male"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">boxplot_tt</span>(<span class="st">"sys_bp"</span>, <span class="st">"prevalent_hyp"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">boxplot_tt</span>(<span class="st">"sys_bp"</span>, <span class="st">"bp_meds"</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="glucose-level" class="level2">
<h2 class="anchored" data-anchor-id="glucose-level">glucose level</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">boxplot_tt</span>(<span class="st">"glucose"</span>, <span class="st">"male"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">boxplot_tt</span>(<span class="st">"glucose"</span>, <span class="st">"prevalent_hyp"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">boxplot_tt</span>(<span class="st">"glucose"</span>, <span class="st">"bp_meds"</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="cholesterol-level-1" class="level2">
<h2 class="anchored" data-anchor-id="cholesterol-level-1">cholesterol level</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">boxplot_tt</span>(<span class="st">"tot_chol"</span>, <span class="st">"male"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">boxplot_tt</span>(<span class="st">"tot_chol"</span>, <span class="st">"prevalent_hyp"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">boxplot_tt</span>(<span class="st">"tot_chol"</span>, <span class="st">"bp_meds"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="na-assessment" class="level1 tabset">
<h1 class="tabset">NA Assessment</h1>
<p>As a last step before fitting the models, we need to take care of NAs in these 6 variables. As mentioned in the beginning, we do this here in order not to bias the EDA.</p>
<p>In case of imputation, we will apply the same procedure blindly to the test set.</p>
<p><code>bmi</code> is significantly different for males and females. There are only 12 values missing. We will impute the NAs with the median of each gender in either risk or no-risk group.</p>
<p><code>glucose</code> and <code>tot_chol</code> are significantly different especially in people with and without hypertension. We will impute the NAs with the median of each gender in either risk or no-risk group.</p>
<p><code>bp_meds</code> is a very important variable, and not easy to impute, so we don’t want to run risks here. We see from the table below that the people where blood pressure (bp) medication was not recorded have (median) bp values compatible with people who have either high or low blood pressure AND do not take medications. This could justify the imputation. At the same time, this is a very important variable, associated with drug use. We don’t want to run this risk. We will therefore discard people where it is not known whether they take medications.</p>
<p><code>cigs_per_day</code> is a variable that can hardly be imputed correctly, therefore we will remove the data points with NA in this variable (less than 1%)</p>
<section id="bmi-2" class="level2">
<h2 class="anchored" data-anchor-id="bmi-2">bmi</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bmi ~ male</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> train,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">x =</span> male,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> bmi</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="glucose-1" class="level2">
<h2 class="anchored" data-anchor-id="glucose-1">glucose</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># glucose ~ hypertension</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> train,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">x =</span> prevalent_hyp,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> glucose</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="cholesterol" class="level2">
<h2 class="anchored" data-anchor-id="cholesterol">cholesterol</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cholesterol ~ hypertension</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggbetweenstats</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> train,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">x =</span> prevalent_hyp,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> tot_chol</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="bp_meds" class="level2">
<h2 class="anchored" data-anchor-id="bp_meds">bp_meds</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bp_meds ~ prevalent_hyp</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sys_bp, prevalent_hyp, bp_meds) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(bp_meds, prevalent_hyp) <span class="sc">%&gt;%</span> </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_sys_bp =</span> <span class="fu">median</span>(sys_bp),</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">count_prevalent_hyp =</span> <span class="fu">n</span>()</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
# Groups:   bp_meds [3]
  bp_meds prevalent_hyp median_sys_bp count_prevalent_hyp
  &lt;fct&gt;   &lt;fct&gt;                 &lt;dbl&gt;               &lt;int&gt;
1 0       0                      122                 2891
2 0       1                      150.                1170
3 1       1                      165                  124
4 &lt;NA&gt;    0                      121                   31
5 &lt;NA&gt;    1                      154.                  22</code></pre>
</div>
</div>
<p>NA imputation on train <em>and</em> test set</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------- train --------------------------------------------</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>   <span class="co"># impute the bmi as the median of males/females</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(ten_year_chd, male) <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">bmi =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(bmi), <span class="fu">median</span>(bmi, <span class="at">na.rm =</span> T),bmi)) <span class="sc">%&gt;%</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>   <span class="co"># impute glucose and cholesterol level as the median of prevalent_hyp</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(ten_year_chd, prevalent_hyp) <span class="sc">%&gt;%</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">glucose =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(glucose), <span class="fu">median</span>(glucose, <span class="at">na.rm=</span>T), glucose)) <span class="sc">%&gt;%</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">tot_chol =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(tot_chol), <span class="fu">median</span>(tot_chol, <span class="at">na.rm=</span>T), tot_chol)) <span class="sc">%&gt;%</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>   <span class="co"># remove people where bp_meds is not unknown</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bp_meds)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>   <span class="co"># remove people with no information about education level</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(education)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>   <span class="co"># # remove the mean from numerical variables</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>   <span class="co"># mutate_if(is.numeric, ~ . - mean(., na.rm = TRUE)) %&gt;% </span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>   <span class="co"># remove residual NAs</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>   <span class="fu">na.omit</span>()</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>train <span class="sc">%&gt;%</span> </span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>      ten_year_chd, age, sys_bp, bmi, glucose, tot_chol, </span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>      male, prevalent_hyp, bp_meds, education</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">%&gt;%</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>   diagnose <span class="sc">%&gt;%</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>   flextable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="tabwid"><style>.cl-ed668038{}.cl-ed5d09fe{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-ed60fbe0{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-ed60fbea{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-ed611300{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed611301{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed61130a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed61130b{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed611314{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed611315{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-ed668038"><thead><tr style="overflow-wrap:break-word;"><th class="cl-ed611300"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">variables</span></p></th><th class="cl-ed611300"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">types</span></p></th><th class="cl-ed611301"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">missing_count</span></p></th><th class="cl-ed611301"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">missing_percent</span></p></th><th class="cl-ed611301"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">unique_count</span></p></th><th class="cl-ed611301"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">unique_rate</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-ed61130a"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">ten_year_chd</span></p></td><td class="cl-ed61130a"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">factor</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">2</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0.0008093889</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ed61130a"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">age</span></p></td><td class="cl-ed61130a"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">numeric</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">39</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0.0157830838</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ed61130a"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">sys_bp</span></p></td><td class="cl-ed61130a"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">numeric</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">213</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0.0861999191</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ed61130a"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">bmi</span></p></td><td class="cl-ed61130a"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">numeric</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">1,099</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0.4447592068</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ed61130a"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">glucose</span></p></td><td class="cl-ed61130a"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">numeric</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">121</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0.0489680291</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ed61130a"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">tot_chol</span></p></td><td class="cl-ed61130a"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">numeric</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">227</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0.0918656414</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ed61130a"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">male</span></p></td><td class="cl-ed61130a"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">factor</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">2</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0.0008093889</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ed61130a"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">prevalent_hyp</span></p></td><td class="cl-ed61130a"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">factor</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">2</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0.0008093889</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ed61130a"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">bp_meds</span></p></td><td class="cl-ed61130a"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">factor</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">2</span></p></td><td class="cl-ed61130b"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0.0008093889</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ed611314"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">education</span></p></td><td class="cl-ed611314"><p class="cl-ed60fbe0"><span class="cl-ed5d09fe">factor</span></p></td><td class="cl-ed611315"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0</span></p></td><td class="cl-ed611315"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0</span></p></td><td class="cl-ed611315"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">4</span></p></td><td class="cl-ed611315"><p class="cl-ed60fbea"><span class="cl-ed5d09fe">0.0016187778</span></p></td></tr></tbody></table></div>

</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------- test --------------------------------------------</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>   <span class="co"># impute the bmi as the median of males/females</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(ten_year_chd, male) <span class="sc">%&gt;%</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">bmi =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(bmi), <span class="fu">median</span>(bmi, <span class="at">na.rm =</span> T),bmi)) <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>   <span class="co"># impute glucose and cholesterol level as the median of prevalent_hyp</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(ten_year_chd, prevalent_hyp) <span class="sc">%&gt;%</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">glucose =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(glucose), <span class="fu">median</span>(glucose, <span class="at">na.rm=</span>T), glucose)) <span class="sc">%&gt;%</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">tot_chol =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(tot_chol), <span class="fu">median</span>(tot_chol, <span class="at">na.rm=</span>T), tot_chol)) <span class="sc">%&gt;%</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>   <span class="co"># remove people where bp_meds is not unknown</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bp_meds)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>   <span class="co"># remove people with no information about education level</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(education)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>   <span class="co"># # remove the mean from numerical variables</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>   <span class="co"># mutate_if(is.numeric, ~ . - mean(., na.rm = TRUE)) %&gt;% </span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>   <span class="co"># remove residual NAs</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>   <span class="fu">na.omit</span>()</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>test <span class="sc">%&gt;%</span> </span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>      ten_year_chd, age, sys_bp, bmi, glucose, tot_chol, </span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>      male, prevalent_hyp, bp_meds, education</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">%&gt;%</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>   diagnose <span class="sc">%&gt;%</span></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>   flextable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="tabwid"><style>.cl-ed86c6ea{}.cl-ed7d7e64{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-ed81520a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-ed815214{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-ed816a06{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed816a10{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed816a1a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed816a1b{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed816a1c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ed816a24{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-ed86c6ea"><thead><tr style="overflow-wrap:break-word;"><th class="cl-ed816a06"><p class="cl-ed81520a"><span class="cl-ed7d7e64">variables</span></p></th><th class="cl-ed816a06"><p class="cl-ed81520a"><span class="cl-ed7d7e64">types</span></p></th><th class="cl-ed816a10"><p class="cl-ed815214"><span class="cl-ed7d7e64">missing_count</span></p></th><th class="cl-ed816a10"><p class="cl-ed815214"><span class="cl-ed7d7e64">missing_percent</span></p></th><th class="cl-ed816a10"><p class="cl-ed815214"><span class="cl-ed7d7e64">unique_count</span></p></th><th class="cl-ed816a10"><p class="cl-ed815214"><span class="cl-ed7d7e64">unique_rate</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-ed816a1a"><p class="cl-ed81520a"><span class="cl-ed7d7e64">ten_year_chd</span></p></td><td class="cl-ed816a1a"><p class="cl-ed81520a"><span class="cl-ed7d7e64">factor</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">2</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0.001265823</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ed816a1a"><p class="cl-ed81520a"><span class="cl-ed7d7e64">age</span></p></td><td class="cl-ed816a1a"><p class="cl-ed81520a"><span class="cl-ed7d7e64">numeric</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">37</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0.023417722</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ed816a1a"><p class="cl-ed81520a"><span class="cl-ed7d7e64">sys_bp</span></p></td><td class="cl-ed816a1a"><p class="cl-ed81520a"><span class="cl-ed7d7e64">numeric</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">201</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0.127215190</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ed816a1a"><p class="cl-ed81520a"><span class="cl-ed7d7e64">bmi</span></p></td><td class="cl-ed816a1a"><p class="cl-ed81520a"><span class="cl-ed7d7e64">numeric</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">859</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0.543670886</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ed816a1a"><p class="cl-ed81520a"><span class="cl-ed7d7e64">glucose</span></p></td><td class="cl-ed816a1a"><p class="cl-ed81520a"><span class="cl-ed7d7e64">numeric</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">102</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0.064556962</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ed816a1a"><p class="cl-ed81520a"><span class="cl-ed7d7e64">tot_chol</span></p></td><td class="cl-ed816a1a"><p class="cl-ed81520a"><span class="cl-ed7d7e64">numeric</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">213</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0.134810127</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ed816a1a"><p class="cl-ed81520a"><span class="cl-ed7d7e64">male</span></p></td><td class="cl-ed816a1a"><p class="cl-ed81520a"><span class="cl-ed7d7e64">factor</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">2</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0.001265823</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ed816a1a"><p class="cl-ed81520a"><span class="cl-ed7d7e64">prevalent_hyp</span></p></td><td class="cl-ed816a1a"><p class="cl-ed81520a"><span class="cl-ed7d7e64">factor</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">2</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0.001265823</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ed816a1a"><p class="cl-ed81520a"><span class="cl-ed7d7e64">bp_meds</span></p></td><td class="cl-ed816a1a"><p class="cl-ed81520a"><span class="cl-ed7d7e64">factor</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">2</span></p></td><td class="cl-ed816a1b"><p class="cl-ed815214"><span class="cl-ed7d7e64">0.001265823</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ed816a1c"><p class="cl-ed81520a"><span class="cl-ed7d7e64">education</span></p></td><td class="cl-ed816a1c"><p class="cl-ed81520a"><span class="cl-ed7d7e64">factor</span></p></td><td class="cl-ed816a24"><p class="cl-ed815214"><span class="cl-ed7d7e64">0</span></p></td><td class="cl-ed816a24"><p class="cl-ed815214"><span class="cl-ed7d7e64">0</span></p></td><td class="cl-ed816a24"><p class="cl-ed815214"><span class="cl-ed7d7e64">4</span></p></td><td class="cl-ed816a24"><p class="cl-ed815214"><span class="cl-ed7d7e64">0.002531646</span></p></td></tr></tbody></table></div>

</div>
</div>
</section>
</section>
<section id="analytic-strategy" class="level1">
<h1>Analytic strategy</h1>
<p><strong>It appears that there are two interesting questions:</strong></p>
<ol type="1">
<li><p>How well is the risk predicted by generic factors alone? (such as sex, age, and blood pressure)</p></li>
<li><p>How much can we increase the prediction if we include other variables more related to hypertension, such as diagnosed hypertension or assumption of blood pressure medications?</p></li>
</ol>
<p>Since we allowed some correlated variables to enter the model, we will pay close attention to the VIF (variance inflation factor).</p>
<p>After the “best” model is detemined by manual stepwise regression, we will compare the former to an automatic stepwise regression carried out using the AIC criterion alone.</p>
</section>
<section id="logistic-regression" class="level1">
<h1>Logistic regression</h1>
<section id="procedure-for-stepwise-modelling" class="level2">
<h2 class="anchored" data-anchor-id="procedure-for-stepwise-modelling">Procedure for stepwise modelling</h2>
<p>We start by fitting the <strong>“maximal” model</strong>, which includes all the provided EVs, to have a baseline estimate for the AUC of this model and of the impact of the correlation between variables we previously detected with EDA - for the latter, we will check the VIF.</p>
<p>Then we fit the <strong>full model</strong>, which includes all the variables we previously selected based on the EDA. This will show how well the hints gathered in the EDA are actually reflected in the significance of the coefficients. Specifically, compared to the “maximal” model.</p>
<p>We will then proceed to eliminate EVs based on whether the coefficients are not sigificant or have a very small effect (in terms of odds ratio). At each step we evaluate the AIC and AUC to detect whether reducing the EVs led to an increase or decrease of the performance.</p>
<p>Finally we will examine the confusion matrix and adjust the threshold for binary prediction in order to have maximum Sensitivity (more on this later).</p>
</section>
<section id="format-of-the-summary-tables" class="level2">
<h2 class="anchored" data-anchor-id="format-of-the-summary-tables">Format of the summary tables</h2>
<p>The coefficients are reported in two forms (at the expense of verbosity):</p>
<ul>
<li><p>original, non-standardized and non-exponentiated (using <code>summary()</code>): to allow calculation of the odds ratio (via <code>exp()</code>) of 10 year CHD given the actual values of the EVs for a specific person.</p></li>
<li><p>standardized and exponentiated (using <code>jtools::summ()</code>): to allow comparing the magnitude of the coefficients, to have the confidence intervals and to calculate the VIF.</p></li>
</ul>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<p>The AIC was similar across all examined models (between 1887 and 1890), therefore this metric had a small weight in the choice of the final model. Similarly, all the models explained at most 17% of the total variance in the data, which is not a substantial amount.</p>
<p>The VIF was not critical, even in the maximal model, therefore the impact of correlated predictors was minimal or negligible.</p>
<p>The <strong>maximal model</strong> highlighted the contribution of gender, age, systolic blood pressure, and to a lesser extent the prevalence of hypertension and education. Importantly, the p values for some of these variables was higher than in simpler models, most likely due to collinearity with other variables. The AUC of this model was 0.703.</p>
<p>Our <strong>full model</strong> highlighted the same variables. In addition reducing the number of EVs increased the significance of most of the selected EVs (especially age and systolic blood pressure). The AUC of this model was 0.705.</p>
<p>We then removed EVs with small or no effect from the full model, specifically blood pressure medications, bmi, cholesterol and education. This led to an AUC of 0.711, and all variables significant.</p>
<p>Further removing the EVs specifying whether the patient had hypertension led to a simpler model and did not substantially change the AUC (0.713).</p>
<p><strong>Remarkably, this model contained only gender, age, systolic blood pressure and glucose blood level, in addition to number of cigarettes smoked per day. That is, two common demographic variables, and two physiologic measurements which can be easily retrieved with blood pressure measurement and a simple blood exam</strong></p>
<p>The increase in odds to develop a CHD in 10 years were as follows for each EV:</p>
<ul>
<li>sex: males have <span class="math inline">\(exp(0.449) \approx 57\%\)</span> greater odds of CHD risk than females</li>
<li>cigarettes per day : <span class="math inline">\(exp(0.1766) \approx 19\%\)</span> greater odds for any additional 10 cigarettes smoked every day</li>
<li>age : the odds of CHD increase <span class="math inline">\(exp(0.0658) \approx 6.8\%\)</span> every year</li>
<li>systolic blood pressure : <span class="math inline">\(exp(0.0186) \approx 1.8\%\)</span> greater odds for each mmHg</li>
<li>glucose : <span class="math inline">\(exp(0.0075) \approx 0.7\%\)</span> greater odds for each mg</li>
</ul>
<p>The intercept can be interpreted as the probability of a female being at risk <em>when all predictors are set to 0</em>. In our case we have predictors for age, glucose and blood pressure, which are obviously not zero, therefore this interpretation of the intercept is not really helpful in our case. For the sake of calculation: <span class="math inline">\(p = \frac{e^{\beta_0}}{1 + e^{\beta_0}} = \frac{exp(-8.643)}{1+exp(-8.643)} = 0.000176\)</span></p>
<p>It is at this point very interesting to notice that:</p>
<ol type="1">
<li>Assumption of blood pressure medications does <em>not</em> reduce the 10 years risk of CHD</li>
<li>Having hypertension has only a small effect on the prediction of developing a risk of CHD in 10 years</li>
</ol>
<p><strong>This is a very interesting result from a practical perspective, since it means that generic demographic and physiological variables are much more predictive of the risk of CHD in 10 years with respect to a diagnosis of hypertension, and that the assumption of blood pressure medicaments - presumably to normalize the blood pressure level in people with hypertension - does <em>not</em> reduce the risk of CHD</strong></p>
<p><strong>Our final model therefore includes:</strong></p>
<ul>
<li>sex</li>
<li>age</li>
<li>systolic blood pressure</li>
<li>glucose</li>
<li>cigarettes per day</li>
</ul>
<p>Afterwards, we evaluated the performance of our model on the test data. Using a default probability of 0.5 for binary prediction leads to a poor Sensitivity, in that only ~ 7% of the people with a real 10 year CHD risk (<span class="math inline">\(\frac{16}{16+219}\)</span>) are predicted as being at risk.</p>
<p><strong>Since in our case the aim is to maximise the detection of people who are truly at risk</strong> - even at expense of inflating the number of false negatives - <strong>we lowered the threshold of binary prediction to 0.1. This allowed us to reach a sensitivity of 84%</strong>.</p>
<p>The <strong>automatic stepwise regression</strong> (<code>stepAIC</code>) identifies the same variables as our final model, plus a small (uncorrected significant) contribution of education level and prevalence of hypertension. However, this model has a smaller AUC (0.703) than our final model, and is also more complex. Therefore we retained our final model.</p>
<p>Finally, we hypothesized that the imbalance between Sensitivity and Specificity could be due to the high proportion of people not at risk in our dataset. Therefore, as a last test, we sampled an equal number of people with and without risk.</p>
<p>In this <strong>balanced samples model</strong> the AUC increased to 0.738. By using a threshold for binary decision of 0.3, this model correctly predicts 91.4% of the people with actual CHD risk, and a false negative rate of 70%. By adopting a more liberal threshold of 0.4, the model predicts 81.3% of the people with actual CHD, and about 50% of the people with no risk of CHD.</p>
<p><strong>A final remark</strong> This model captures only a fraction of the total variance in the data (~ 15%). It is odd that other variables widely thought to be associated with cardiovascular diseases were not recorded, such as stress level (e.g.&nbsp;# hours of work per day/week), alcohol comsumption, quality of the air.</p>
<hr>
<p><code>do_logistic_regression</code> : a function to carry out the logistic regression and print out the summary of the model, the ROC curve - and the AUC - as well as the confusion matrix.</p>
<p><code>plot_ROC</code> : a function that generates an interactive ROC that allows to inspect Sensitivity and Specificity for different levels of threshold for binary decision</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>do_logistic_regression <span class="ot">&lt;-</span> <span class="cf">function</span>(EVs, <span class="at">train_data =</span> train, <span class="at">test_data =</span> test, <span class="at">thresh =</span> <span class="fl">0.5</span>) {</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Assemble the formula</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>   formula_string <span class="ot">&lt;-</span> <span class="fu">paste</span>(EVs, <span class="at">collapse =</span> <span class="st">" + "</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>   formula_obj <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"ten_year_chd ~"</span>, formula_string))</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>   fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(formula_obj, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> train_data)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>   <span class="co"># # Standard R summary</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summary</span>(fit) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Print a summary</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>   <span class="co"># summary(fit) %&gt;% print()</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (<span class="fu">length</span>(EVs) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>      jtools<span class="sc">::</span><span class="fu">summ</span>(fit, <span class="at">confint =</span> T, <span class="at">vifs =</span> T, <span class="at">scale =</span> F, <span class="at">exp =</span> T, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>   } <span class="cf">else</span> {</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>      jtools<span class="sc">::</span><span class="fu">summ</span>(fit, <span class="at">confint =</span> T, <span class="at">vifs =</span> T, <span class="at">scale =</span> F, <span class="at">exp =</span> T, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Estimated probability values from the logistic model</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>   phat <span class="ot">=</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> test_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Confusion matrix and derived quantities - using caret::confusionmatrix</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sprintf</span>(<span class="st">"</span><span class="sc">\n</span><span class="st"> Using a threshold for prediction = %.2f </span><span class="sc">\n\n</span><span class="st">"</span>, thresh) <span class="sc">%&gt;%</span> <span class="fu">cat</span>()</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>   thresh <span class="ot">&lt;-</span> thresh</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>   predicted <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(phat <span class="sc">&gt;</span> thresh, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>   actual_predicted <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">actual =</span> test_data<span class="sc">$</span>ten_year_chd, </span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">predicted =</span> <span class="fu">ifelse</span>(phat <span class="sc">&gt;</span> thresh, <span class="dv">1</span>, <span class="dv">0</span>) </span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>   caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.factor</span>(predicted), <span class="co"># predicted</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.factor</span>(test_data<span class="sc">$</span>ten_year_chd), <span class="co"># actual </span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">positive =</span> <span class="st">"1"</span>  <span class="co"># the positive class in our case is "1"</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(phat)</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>plot_ROC <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">test_data =</span> test, <span class="at">phat =</span> phat) {</span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a> <span class="co"># Define the probability thresholds you want to use</span></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>   pthresh <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)</span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Create the ROC curve</span></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>   roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(test_data<span class="sc">$</span>ten_year_chd, phat, <span class="at">plot =</span> F, <span class="at">print.auc=</span>T)</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Get the coordinates (sensitivity and specificity) for the specified thresholds</span></span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>   coordinates <span class="ot">&lt;-</span> pROC<span class="sc">::</span><span class="fu">coords</span>(roc_curve, pthresh)</span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Using highcharter</span></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>    h <span class="ot">&lt;-</span> coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hchart</span>(</span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"line"</span>,</span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hcaes</span>(<span class="at">x =</span> specificity, <span class="at">y =</span> sensitivity, <span class="at">threshold =</span> threshold)</span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hc_xAxis</span>(<span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"Specificity"</span>), <span class="at">reversed =</span> <span class="cn">TRUE</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hc_yAxis</span>(<span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"Sensitivity"</span>), <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hc_add_series</span>(</span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> coordinates,</span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"scatter"</span>,</span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hcaes</span>(<span class="at">x =</span> specificity, <span class="at">y =</span> sensitivity, <span class="at">threshold =</span> threshold),</span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a>        <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">radius =</span> <span class="dv">6</span>, <span class="at">fillColor =</span> <span class="st">"lightblue"</span>, <span class="at">lineWidth =</span> <span class="dv">2</span>),</span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a>        <span class="at">tooltip =</span> <span class="fu">list</span>(</span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a>            <span class="at">headerFormat =</span> <span class="st">""</span>,</span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a>            <span class="at">pointFormat =</span> <span class="st">"&lt;b&gt;Threshold: {point.threshold:.2f}&lt;/b&gt;&lt;br&gt;</span></span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a><span class="st">                           Sensitivity: {point.y:.2f}&lt;br&gt;</span></span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a><span class="st">                           Specificity: {point.x:.2f}"</span>)</span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a>     <span class="fu">hc_chart</span>(<span class="at">aspectRatio =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>   <span class="co"># Set the equal aspect ratio</span></span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a>     <span class="fu">hc_title</span>(<span class="at">text =</span> <span class="fu">paste</span>(<span class="st">"ROC curve - AUC ="</span>, <span class="fu">round</span>(roc_curve<span class="sc">$</span>auc,<span class="dv">3</span>)))</span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(h)</span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="manual-stepwise" class="level2 tabset">
<h2 class="tabset anchored" data-anchor-id="manual-stepwise">Manual stepwise</h2>
<section id="maximal-model" class="level3">
<h3 class="anchored" data-anchor-id="maximal-model">Maximal model</h3>
<p>Maximal model, including <em>all</em> the variables in the dataset. We use this only as a benchmark for the models instructed by EDA.</p>
<p>We observe high VIF values in <code>sys_bp</code> and <code>dia_bp</code> - as expected.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>EVs <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>ten_year_chd) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>phat <span class="ot">&lt;-</span> <span class="fu">do_logistic_regression</span>(EVs, <span class="at">thresh =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = formula_obj, family = "binomial", data = train_data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.8415  -0.5828  -0.4175  -0.2897   2.8226  

Coefficients:
                    Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)       -7.4497344  0.8561698  -8.701  &lt; 2e-16 ***
male1              0.3800302  0.1329243   2.859  0.00425 ** 
age                0.0608765  0.0083022   7.333 2.26e-13 ***
education2        -0.3243521  0.1517706  -2.137  0.03259 *  
education3        -0.3327557  0.1860997  -1.788  0.07377 .  
education4        -0.0502180  0.1969542  -0.255  0.79874    
current_smoker1    0.1717930  0.1922979   0.893  0.37166    
cigs_per_day       0.0149836  0.0078998   1.897  0.05787 .  
bp_meds1           0.3755894  0.2932894   1.281  0.20033    
prevalent_stroke1  0.8294602  0.6158164   1.347  0.17800    
prevalent_hyp1     0.3669952  0.1660561   2.210  0.02710 *  
diabetes1          0.3126526  0.3897172   0.802  0.42241    
tot_chol           0.0004310  0.0014095   0.306  0.75980    
sys_bp             0.0121563  0.0046474   2.616  0.00890 ** 
dia_bp             0.0004736  0.0078561   0.060  0.95193    
bmi                0.0141265  0.0151335   0.933  0.35058    
heart_rate        -0.0068913  0.0050928  -1.353  0.17601    
glucose            0.0063839  0.0028683   2.226  0.02604 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2114.4  on 2470  degrees of freedom
Residual deviance: 1854.4  on 2453  degrees of freedom
AIC: 1890.4

Number of Fisher Scoring iterations: 5

MODEL INFO:
Observations: 2471
Dependent Variable: ten_year_chd
Type: Generalized linear model
  Family: binomial 
  Link function: logit 

MODEL FIT:
χ²(17) = 259.91, p = 0.00
Pseudo-R² (Cragg-Uhler) = 0.17
Pseudo-R² (McFadden) = 0.12
AIC = 1890.45, BIC = 1995.07 

Standard errors: MLE
-------------------------------------------------------------------------
                          exp(Est.)   2.5%   97.5%   z val.      p    VIF
----------------------- ----------- ------ ------- -------- ------ ------
(Intercept)                    0.00   0.00    0.00    -8.70   0.00       
male1                          1.46   1.13    1.90     2.86   0.00   1.25
age                            1.06   1.05    1.08     7.33   0.00   1.32
education2                     0.72   0.54    0.97    -2.14   0.03   1.13
education3                     0.72   0.50    1.03    -1.79   0.07   1.13
education4                     0.95   0.65    1.40    -0.25   0.80   1.13
current_smoker1                1.19   0.81    1.73     0.89   0.37   2.61
cigs_per_day                   1.02   1.00    1.03     1.90   0.06   2.74
bp_meds1                       1.46   0.82    2.59     1.28   0.20   1.11
prevalent_stroke1              2.29   0.69    7.66     1.35   0.18   1.04
prevalent_hyp1                 1.44   1.04    2.00     2.21   0.03   1.94
diabetes1                      1.37   0.64    2.93     0.80   0.42   1.88
tot_chol                       1.00   1.00    1.00     0.31   0.76   1.07
sys_bp                         1.01   1.00    1.02     2.62   0.01   3.64
dia_bp                         1.00   0.99    1.02     0.06   0.95   2.92
bmi                            1.01   0.98    1.04     0.93   0.35   1.23
heart_rate                     0.99   0.98    1.00    -1.35   0.18   1.10
glucose                        1.01   1.00    1.01     2.23   0.03   1.89
-------------------------------------------------------------------------

 Using a threshold for prediction = 0.50 

Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0 1329  213
         1   16   22
                                          
               Accuracy : 0.8551          
                 95% CI : (0.8367, 0.8721)
    No Information Rate : 0.8513          
    P-Value [Acc &gt; NIR] : 0.3513          
                                          
                  Kappa : 0.1249          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.09362         
            Specificity : 0.98810         
         Pos Pred Value : 0.57895         
         Neg Pred Value : 0.86187         
             Prevalence : 0.14873         
         Detection Rate : 0.01392         
   Detection Prevalence : 0.02405         
      Balanced Accuracy : 0.54086         
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ROC</span>(test, phat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output-display">

<div class="highchart html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-0b63aea176403bbc7065" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-0b63aea176403bbc7065">{"x":{"hc_opts":{"chart":{"reflow":true,"aspectRatio":1},"title":{"text":"ROC curve - AUC = 0.703"},"yAxis":{"title":{"text":"Sensitivity"},"type":"linear","min":0,"max":1},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0,"showInLegend":false},"treemap":{"layoutAlgorithm":"squarified"},"scatter":{"marker":{"symbol":"circle"}}},"series":[{"group":"group","data":[{"threshold":0,"specificity":0,"sensitivity":1,"x":0,"y":1},{"threshold":0.1,"specificity":0.456505576208178,"sensitivity":0.817021276595745,"x":0.456505576208178,"y":0.817021276595745},{"threshold":0.2,"specificity":0.762825278810409,"sensitivity":0.527659574468085,"x":0.762825278810409,"y":0.527659574468085},{"threshold":0.3,"specificity":0.901115241635688,"sensitivity":0.31063829787234,"x":0.901115241635688,"y":0.31063829787234},{"threshold":0.4,"specificity":0.962825278810409,"sensitivity":0.148936170212766,"x":0.962825278810409,"y":0.148936170212766},{"threshold":0.5,"specificity":0.988104089219331,"sensitivity":0.0936170212765957,"x":0.988104089219331,"y":0.0936170212765957},{"threshold":0.6,"specificity":0.997026022304833,"sensitivity":0.0382978723404255,"x":0.997026022304833,"y":0.0382978723404255},{"threshold":0.7,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.8,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.9,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":1,"specificity":1,"sensitivity":0,"x":1,"y":0}],"type":"line"},{"group":"group","data":[{"threshold":0,"specificity":0,"sensitivity":1,"x":0,"y":1},{"threshold":0.1,"specificity":0.456505576208178,"sensitivity":0.817021276595745,"x":0.456505576208178,"y":0.817021276595745},{"threshold":0.2,"specificity":0.762825278810409,"sensitivity":0.527659574468085,"x":0.762825278810409,"y":0.527659574468085},{"threshold":0.3,"specificity":0.901115241635688,"sensitivity":0.31063829787234,"x":0.901115241635688,"y":0.31063829787234},{"threshold":0.4,"specificity":0.962825278810409,"sensitivity":0.148936170212766,"x":0.962825278810409,"y":0.148936170212766},{"threshold":0.5,"specificity":0.988104089219331,"sensitivity":0.0936170212765957,"x":0.988104089219331,"y":0.0936170212765957},{"threshold":0.6,"specificity":0.997026022304833,"sensitivity":0.0382978723404255,"x":0.997026022304833,"y":0.0382978723404255},{"threshold":0.7,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.8,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.9,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":1,"specificity":1,"sensitivity":0,"x":1,"y":0}],"type":"scatter","marker":{"radius":6,"fillColor":"lightblue","lineWidth":2},"tooltip":{"headerFormat":"","pointFormat":"<b>Threshold: {point.threshold:.2f}<\/b><br>\n                           Sensitivity: {point.y:.2f}<br>\n                           Specificity: {point.x:.2f}"}}],"xAxis":{"type":"linear","title":{"text":"Specificity"},"reversed":true,"min":0,"max":1}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="full-with-selected-variables" class="level3">
<h3 class="anchored" data-anchor-id="full-with-selected-variables">Full with selected variables</h3>
<p>This is the “full” model with all the variables chosen based on the EDA.</p>
<p>No problems with collinearity.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>EVs  <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>   <span class="st">"male"</span>, <span class="st">"prevalent_hyp"</span>, <span class="st">"bp_meds"</span>, <span class="st">"education"</span>,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>   <span class="st">"age"</span>, <span class="st">"sys_bp"</span>, <span class="st">"bmi"</span>, <span class="st">"glucose"</span>, <span class="st">"tot_chol"</span>, <span class="st">"cigs_per_day"</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>phat <span class="ot">&lt;-</span> <span class="fu">do_logistic_regression</span>(EVs, <span class="at">thresh =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = formula_obj, family = "binomial", data = train_data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.9398  -0.5882  -0.4186  -0.2876   2.8221  

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    -7.8924235  0.7224553 -10.924  &lt; 2e-16 ***
male1           0.3996399  0.1306947   3.058 0.002230 ** 
prevalent_hyp1  0.3564960  0.1628251   2.189 0.028565 *  
bp_meds1        0.4381388  0.2883448   1.519 0.128638    
education2     -0.3319065  0.1512202  -2.195 0.028174 *  
education3     -0.3409724  0.1858949  -1.834 0.066621 .  
education4     -0.0373354  0.1959238  -0.191 0.848870    
age             0.0613141  0.0080512   7.616 2.63e-14 ***
sys_bp          0.0118211  0.0034909   3.386 0.000709 ***
bmi             0.0137041  0.0146029   0.938 0.348011    
glucose         0.0075754  0.0021169   3.579 0.000345 ***
tot_chol        0.0002287  0.0014069   0.163 0.870891    
cigs_per_day    0.0191629  0.0052321   3.663 0.000250 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2114.4  on 2470  degrees of freedom
Residual deviance: 1859.5  on 2458  degrees of freedom
AIC: 1885.5

Number of Fisher Scoring iterations: 5

MODEL INFO:
Observations: 2471
Dependent Variable: ten_year_chd
Type: Generalized linear model
  Family: binomial 
  Link function: logit 

MODEL FIT:
χ²(12) = 254.88, p = 0.00
Pseudo-R² (Cragg-Uhler) = 0.17
Pseudo-R² (McFadden) = 0.12
AIC = 1885.48, BIC = 1961.04 

Standard errors: MLE
----------------------------------------------------------------------
                       exp(Est.)   2.5%   97.5%   z val.      p    VIF
-------------------- ----------- ------ ------- -------- ------ ------
(Intercept)                 0.00   0.00    0.00   -10.92   0.00       
male1                       1.49   1.15    1.93     3.06   0.00   1.21
prevalent_hyp1              1.43   1.04    1.97     2.19   0.03   1.87
bp_meds1                    1.55   0.88    2.73     1.52   0.13   1.09
education2                  0.72   0.53    0.97    -2.19   0.03   1.11
education3                  0.71   0.49    1.02    -1.83   0.07   1.11
education4                  0.96   0.66    1.41    -0.19   0.85   1.11
age                         1.06   1.05    1.08     7.62   0.00   1.25
sys_bp                      1.01   1.00    1.02     3.39   0.00   2.06
bmi                         1.01   0.99    1.04     0.94   0.35   1.16
glucose                     1.01   1.00    1.01     3.58   0.00   1.02
tot_chol                    1.00   1.00    1.00     0.16   0.87   1.06
cigs_per_day                1.02   1.01    1.03     3.66   0.00   1.22
----------------------------------------------------------------------

 Using a threshold for prediction = 0.50 

Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0 1332  219
         1   13   16
                                          
               Accuracy : 0.8532          
                 95% CI : (0.8347, 0.8703)
    No Information Rate : 0.8513          
    P-Value [Acc &gt; NIR] : 0.433           
                                          
                  Kappa : 0.0915          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.06809         
            Specificity : 0.99033         
         Pos Pred Value : 0.55172         
         Neg Pred Value : 0.85880         
             Prevalence : 0.14873         
         Detection Rate : 0.01013         
   Detection Prevalence : 0.01835         
      Balanced Accuracy : 0.52921         
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ROC</span>(test, phat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output-display">

<div class="highchart html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-d87621ab39711deb7f87" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-d87621ab39711deb7f87">{"x":{"hc_opts":{"chart":{"reflow":true,"aspectRatio":1},"title":{"text":"ROC curve - AUC = 0.705"},"yAxis":{"title":{"text":"Sensitivity"},"type":"linear","min":0,"max":1},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0,"showInLegend":false},"treemap":{"layoutAlgorithm":"squarified"},"scatter":{"marker":{"symbol":"circle"}}},"series":[{"group":"group","data":[{"threshold":0,"specificity":0,"sensitivity":1,"x":0,"y":1},{"threshold":0.1,"specificity":0.452788104089219,"sensitivity":0.825531914893617,"x":0.452788104089219,"y":0.825531914893617},{"threshold":0.2,"specificity":0.765799256505576,"sensitivity":0.514893617021277,"x":0.765799256505576,"y":0.514893617021277},{"threshold":0.3,"specificity":0.89814126394052,"sensitivity":0.306382978723404,"x":0.89814126394052,"y":0.306382978723404},{"threshold":0.4,"specificity":0.963568773234201,"sensitivity":0.153191489361702,"x":0.963568773234201,"y":0.153191489361702},{"threshold":0.5,"specificity":0.990334572490706,"sensitivity":0.0680851063829787,"x":0.990334572490706,"y":0.0680851063829787},{"threshold":0.6,"specificity":0.998513011152416,"sensitivity":0.0425531914893617,"x":0.998513011152416,"y":0.0425531914893617},{"threshold":0.7,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.8,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.9,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":1,"specificity":1,"sensitivity":0,"x":1,"y":0}],"type":"line"},{"group":"group","data":[{"threshold":0,"specificity":0,"sensitivity":1,"x":0,"y":1},{"threshold":0.1,"specificity":0.452788104089219,"sensitivity":0.825531914893617,"x":0.452788104089219,"y":0.825531914893617},{"threshold":0.2,"specificity":0.765799256505576,"sensitivity":0.514893617021277,"x":0.765799256505576,"y":0.514893617021277},{"threshold":0.3,"specificity":0.89814126394052,"sensitivity":0.306382978723404,"x":0.89814126394052,"y":0.306382978723404},{"threshold":0.4,"specificity":0.963568773234201,"sensitivity":0.153191489361702,"x":0.963568773234201,"y":0.153191489361702},{"threshold":0.5,"specificity":0.990334572490706,"sensitivity":0.0680851063829787,"x":0.990334572490706,"y":0.0680851063829787},{"threshold":0.6,"specificity":0.998513011152416,"sensitivity":0.0425531914893617,"x":0.998513011152416,"y":0.0425531914893617},{"threshold":0.7,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.8,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.9,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":1,"specificity":1,"sensitivity":0,"x":1,"y":0}],"type":"scatter","marker":{"radius":6,"fillColor":"lightblue","lineWidth":2},"tooltip":{"headerFormat":"","pointFormat":"<b>Threshold: {point.threshold:.2f}<\/b><br>\n                           Sensitivity: {point.y:.2f}<br>\n                           Specificity: {point.x:.2f}"}}],"xAxis":{"type":"linear","title":{"text":"Specificity"},"reversed":true,"min":0,"max":1}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="remove-no-effect-evs" class="level3">
<h3 class="anchored" data-anchor-id="remove-no-effect-evs">Remove no-effect EVs</h3>
<p>Remove education, bp_meds, bmi, tot_chol since they have no effect on the model.</p>
<p>The AIC slightly decreases with respect to the full model.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove education, bp_meds, bmi, tot_chol since they have</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># no effect on the model</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>EVs  <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>   <span class="st">"male"</span>, <span class="st">"prevalent_hyp"</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>   <span class="st">"age"</span>, <span class="st">"sys_bp"</span>, <span class="st">"glucose"</span>, <span class="st">"cigs_per_day"</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>phat <span class="ot">&lt;-</span> <span class="fu">do_logistic_regression</span>(EVs, <span class="at">thresh =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = formula_obj, family = "binomial", data = train_data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1088  -0.5889  -0.4241  -0.2951   2.7635  

Coefficients:
                Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    -8.027822   0.562910 -14.261  &lt; 2e-16 ***
male1           0.434934   0.127776   3.404 0.000664 ***
prevalent_hyp1  0.387263   0.160552   2.412 0.015862 *  
age             0.064891   0.007775   8.346  &lt; 2e-16 ***
sys_bp          0.013408   0.003393   3.952 7.76e-05 ***
glucose         0.007572   0.002106   3.595 0.000324 ***
cigs_per_day    0.018188   0.005197   3.500 0.000465 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2114.4  on 2470  degrees of freedom
Residual deviance: 1870.0  on 2464  degrees of freedom
AIC: 1884

Number of Fisher Scoring iterations: 5

MODEL INFO:
Observations: 2471
Dependent Variable: ten_year_chd
Type: Generalized linear model
  Family: binomial 
  Link function: logit 

MODEL FIT:
χ²(6) = 244.31, p = 0.00
Pseudo-R² (Cragg-Uhler) = 0.16
Pseudo-R² (McFadden) = 0.12
AIC = 1884.05, BIC = 1924.73 

Standard errors: MLE
----------------------------------------------------------------------
                       exp(Est.)   2.5%   97.5%   z val.      p    VIF
-------------------- ----------- ------ ------- -------- ------ ------
(Intercept)                 0.00   0.00    0.00   -14.26   0.00       
male1                       1.54   1.20    1.98     3.40   0.00   1.16
prevalent_hyp1              1.47   1.08    2.02     2.41   0.02   1.83
age                         1.07   1.05    1.08     8.35   0.00   1.17
sys_bp                      1.01   1.01    1.02     3.95   0.00   1.95
glucose                     1.01   1.00    1.01     3.60   0.00   1.01
cigs_per_day                1.02   1.01    1.03     3.50   0.00   1.21
----------------------------------------------------------------------

 Using a threshold for prediction = 0.50 

Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0 1335  219
         1   10   16
                                          
               Accuracy : 0.8551          
                 95% CI : (0.8367, 0.8721)
    No Information Rate : 0.8513          
    P-Value [Acc &gt; NIR] : 0.3513          
                                          
                  Kappa : 0.0958          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.06809         
            Specificity : 0.99257         
         Pos Pred Value : 0.61538         
         Neg Pred Value : 0.85907         
             Prevalence : 0.14873         
         Detection Rate : 0.01013         
   Detection Prevalence : 0.01646         
      Balanced Accuracy : 0.53033         
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ROC</span>(test, phat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output-display">

<div class="highchart html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-f5257eaf263dbafcaad2" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-f5257eaf263dbafcaad2">{"x":{"hc_opts":{"chart":{"reflow":true,"aspectRatio":1},"title":{"text":"ROC curve - AUC = 0.711"},"yAxis":{"title":{"text":"Sensitivity"},"type":"linear","min":0,"max":1},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0,"showInLegend":false},"treemap":{"layoutAlgorithm":"squarified"},"scatter":{"marker":{"symbol":"circle"}}},"series":[{"group":"group","data":[{"threshold":0,"specificity":0,"sensitivity":1,"x":0,"y":1},{"threshold":0.1,"specificity":0.446840148698885,"sensitivity":0.825531914893617,"x":0.446840148698885,"y":0.825531914893617},{"threshold":0.2,"specificity":0.762825278810409,"sensitivity":0.523404255319149,"x":0.762825278810409,"y":0.523404255319149},{"threshold":0.3,"specificity":0.90185873605948,"sensitivity":0.327659574468085,"x":0.90185873605948,"y":0.327659574468085},{"threshold":0.4,"specificity":0.968029739776952,"sensitivity":0.161702127659574,"x":0.968029739776952,"y":0.161702127659574},{"threshold":0.5,"specificity":0.992565055762082,"sensitivity":0.0680851063829787,"x":0.992565055762082,"y":0.0680851063829787},{"threshold":0.6,"specificity":0.997769516728625,"sensitivity":0.025531914893617,"x":0.997769516728625,"y":0.025531914893617},{"threshold":0.7,"specificity":1,"sensitivity":0.0127659574468085,"x":1,"y":0.0127659574468085},{"threshold":0.8,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.9,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":1,"specificity":1,"sensitivity":0,"x":1,"y":0}],"type":"line"},{"group":"group","data":[{"threshold":0,"specificity":0,"sensitivity":1,"x":0,"y":1},{"threshold":0.1,"specificity":0.446840148698885,"sensitivity":0.825531914893617,"x":0.446840148698885,"y":0.825531914893617},{"threshold":0.2,"specificity":0.762825278810409,"sensitivity":0.523404255319149,"x":0.762825278810409,"y":0.523404255319149},{"threshold":0.3,"specificity":0.90185873605948,"sensitivity":0.327659574468085,"x":0.90185873605948,"y":0.327659574468085},{"threshold":0.4,"specificity":0.968029739776952,"sensitivity":0.161702127659574,"x":0.968029739776952,"y":0.161702127659574},{"threshold":0.5,"specificity":0.992565055762082,"sensitivity":0.0680851063829787,"x":0.992565055762082,"y":0.0680851063829787},{"threshold":0.6,"specificity":0.997769516728625,"sensitivity":0.025531914893617,"x":0.997769516728625,"y":0.025531914893617},{"threshold":0.7,"specificity":1,"sensitivity":0.0127659574468085,"x":1,"y":0.0127659574468085},{"threshold":0.8,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.9,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":1,"specificity":1,"sensitivity":0,"x":1,"y":0}],"type":"scatter","marker":{"radius":6,"fillColor":"lightblue","lineWidth":2},"tooltip":{"headerFormat":"","pointFormat":"<b>Threshold: {point.threshold:.2f}<\/b><br>\n                           Sensitivity: {point.y:.2f}<br>\n                           Specificity: {point.x:.2f}"}}],"xAxis":{"type":"linear","title":{"text":"Specificity"},"reversed":true,"min":0,"max":1}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="remove-prevalent_hyp" class="level3">
<h3 class="anchored" data-anchor-id="remove-prevalent_hyp">Remove prevalent_hyp</h3>
<p>Remove prevalent_hyp since it is only marginally significant</p>
<p>Note that the AIC only marginally increases (less than 0.2%) and this model is much simpler and requires only 4 variables, two of which are common demographic variables (<code>age</code> and sex), while the other two can be easily gathered through a pressure measurement and a blood test.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove prevalent_hyp since it is only marginally significant</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>EVs  <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>   <span class="st">"male"</span>, <span class="st">"age"</span>, <span class="st">"sys_bp"</span>, <span class="st">"glucose"</span>, <span class="st">"cigs_per_day"</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>phat <span class="ot">&lt;-</span> <span class="fu">do_logistic_regression</span>(EVs, <span class="at">thresh =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = formula_obj, family = "binomial", data = train_data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1053  -0.5899  -0.4330  -0.2982   2.8162  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -8.643579   0.504565 -17.131  &lt; 2e-16 ***
male1         0.449590   0.127385   3.529 0.000417 ***
age           0.065845   0.007745   8.502  &lt; 2e-16 ***
sys_bp        0.018684   0.002597   7.194 6.29e-13 ***
glucose       0.007547   0.002112   3.573 0.000353 ***
cigs_per_day  0.017858   0.005184   3.445 0.000571 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2114.4  on 2470  degrees of freedom
Residual deviance: 1875.8  on 2465  degrees of freedom
AIC: 1887.8

Number of Fisher Scoring iterations: 5

MODEL INFO:
Observations: 2471
Dependent Variable: ten_year_chd
Type: Generalized linear model
  Family: binomial 
  Link function: logit 

MODEL FIT:
χ²(5) = 238.54, p = 0.00
Pseudo-R² (Cragg-Uhler) = 0.16
Pseudo-R² (McFadden) = 0.11
AIC = 1887.82, BIC = 1922.69 

Standard errors: MLE
--------------------------------------------------------------------
                     exp(Est.)   2.5%   97.5%   z val.      p    VIF
------------------ ----------- ------ ------- -------- ------ ------
(Intercept)               0.00   0.00    0.00   -17.13   0.00       
male1                     1.57   1.22    2.01     3.53   0.00   1.16
age                       1.07   1.05    1.08     8.50   0.00   1.17
sys_bp                    1.02   1.01    1.02     7.19   0.00   1.14
glucose                   1.01   1.00    1.01     3.57   0.00   1.01
cigs_per_day              1.02   1.01    1.03     3.44   0.00   1.20
--------------------------------------------------------------------

 Using a threshold for prediction = 0.50 

Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0 1337  219
         1    8   16
                                          
               Accuracy : 0.8563          
                 95% CI : (0.8381, 0.8733)
    No Information Rate : 0.8513          
    P-Value [Acc &gt; NIR] : 0.3             
                                          
                  Kappa : 0.0987          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.06809         
            Specificity : 0.99405         
         Pos Pred Value : 0.66667         
         Neg Pred Value : 0.85925         
             Prevalence : 0.14873         
         Detection Rate : 0.01013         
   Detection Prevalence : 0.01519         
      Balanced Accuracy : 0.53107         
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ROC</span>(test, phat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output-display">

<div class="highchart html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-11cad29016a2f7ef2835" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-11cad29016a2f7ef2835">{"x":{"hc_opts":{"chart":{"reflow":true,"aspectRatio":1},"title":{"text":"ROC curve - AUC = 0.713"},"yAxis":{"title":{"text":"Sensitivity"},"type":"linear","min":0,"max":1},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0,"showInLegend":false},"treemap":{"layoutAlgorithm":"squarified"},"scatter":{"marker":{"symbol":"circle"}}},"series":[{"group":"group","data":[{"threshold":0,"specificity":0,"sensitivity":1,"x":0,"y":1},{"threshold":0.1,"specificity":0.43271375464684,"sensitivity":0.842553191489362,"x":0.43271375464684,"y":0.842553191489362},{"threshold":0.2,"specificity":0.769516728624535,"sensitivity":0.523404255319149,"x":0.769516728624535,"y":0.523404255319149},{"threshold":0.3,"specificity":0.901115241635688,"sensitivity":0.28936170212766,"x":0.901115241635688,"y":0.28936170212766},{"threshold":0.4,"specificity":0.971003717472119,"sensitivity":0.153191489361702,"x":0.971003717472119,"y":0.153191489361702},{"threshold":0.5,"specificity":0.994052044609665,"sensitivity":0.0680851063829787,"x":0.994052044609665,"y":0.0680851063829787},{"threshold":0.6,"specificity":0.998513011152416,"sensitivity":0.0340425531914894,"x":0.998513011152416,"y":0.0340425531914894},{"threshold":0.7,"specificity":1,"sensitivity":0.0127659574468085,"x":1,"y":0.0127659574468085},{"threshold":0.8,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.9,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":1,"specificity":1,"sensitivity":0,"x":1,"y":0}],"type":"line"},{"group":"group","data":[{"threshold":0,"specificity":0,"sensitivity":1,"x":0,"y":1},{"threshold":0.1,"specificity":0.43271375464684,"sensitivity":0.842553191489362,"x":0.43271375464684,"y":0.842553191489362},{"threshold":0.2,"specificity":0.769516728624535,"sensitivity":0.523404255319149,"x":0.769516728624535,"y":0.523404255319149},{"threshold":0.3,"specificity":0.901115241635688,"sensitivity":0.28936170212766,"x":0.901115241635688,"y":0.28936170212766},{"threshold":0.4,"specificity":0.971003717472119,"sensitivity":0.153191489361702,"x":0.971003717472119,"y":0.153191489361702},{"threshold":0.5,"specificity":0.994052044609665,"sensitivity":0.0680851063829787,"x":0.994052044609665,"y":0.0680851063829787},{"threshold":0.6,"specificity":0.998513011152416,"sensitivity":0.0340425531914894,"x":0.998513011152416,"y":0.0340425531914894},{"threshold":0.7,"specificity":1,"sensitivity":0.0127659574468085,"x":1,"y":0.0127659574468085},{"threshold":0.8,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.9,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":1,"specificity":1,"sensitivity":0,"x":1,"y":0}],"type":"scatter","marker":{"radius":6,"fillColor":"lightblue","lineWidth":2},"tooltip":{"headerFormat":"","pointFormat":"<b>Threshold: {point.threshold:.2f}<\/b><br>\n                           Sensitivity: {point.y:.2f}<br>\n                           Specificity: {point.x:.2f}"}}],"xAxis":{"type":"linear","title":{"text":"Specificity"},"reversed":true,"min":0,"max":1}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="assess-categorical-interactions" class="level3">
<h3 class="anchored" data-anchor-id="assess-categorical-interactions">Assess categorical interactions</h3>
<p>The number of cigarettes per day is a relevant factor, although being a current smoker is not. Since there is an interaction between being male, current smoker and having hypertension, it is worth exploring whether including these interactions would improve the performance of the model.</p>
<p>However, the results show that the coefficients associated with <code>male:current_smoker</code> and <code>current_smoker:prevalent_hyp</code> are not significant - especially after correction. Also, they are highly collinear with <code>cigs_per_day</code> - which becomes not significant - and do not improve the model performance.</p>
<p>For all these resasons, these interactions will <em>not</em> be included in the final model.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Try to include `male:current_smoker` and `current_smoker:prevalent_hyp`</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>EVs  <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>   <span class="st">"male"</span>, <span class="st">"age"</span>, <span class="st">"sys_bp"</span>, <span class="st">"glucose"</span>, <span class="st">"male:current_smoker"</span>, <span class="st">"current_smoker:prevalent_hyp"</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>phat <span class="ot">&lt;-</span> <span class="fu">do_logistic_regression</span>(EVs, <span class="at">thresh =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = formula_obj, family = "binomial", data = train_data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.0959  -0.5871  -0.4262  -0.2940   2.7761  

Coefficients:
                                Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                    -8.071834   0.575043 -14.037  &lt; 2e-16 ***
male1                           0.411137   0.177391   2.318 0.020466 *  
age                             0.064531   0.007790   8.284  &lt; 2e-16 ***
sys_bp                          0.013450   0.003398   3.959 7.54e-05 ***
glucose                         0.007486   0.002101   3.563 0.000367 ***
male0:current_smoker1           0.386439   0.213094   1.813 0.069760 .  
male1:current_smoker1           0.560270   0.206397   2.715 0.006637 ** 
current_smoker0:prevalent_hyp1  0.472103   0.200758   2.352 0.018693 *  
current_smoker1:prevalent_hyp1  0.287916   0.201998   1.425 0.154058    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2114.4  on 2470  degrees of freedom
Residual deviance: 1871.3  on 2462  degrees of freedom
AIC: 1889.3

Number of Fisher Scoring iterations: 5

MODEL INFO:
Observations: 2471
Dependent Variable: ten_year_chd
Type: Generalized linear model
  Family: binomial 
  Link function: logit 

MODEL FIT:
χ²(8) = 243.03, p = 0.00
Pseudo-R² (Cragg-Uhler) = 0.16
Pseudo-R² (McFadden) = 0.11
AIC = 1889.32, BIC = 1941.64 

Standard errors: MLE
-------------------------------------------------------------------------------
                                       exp(Est.)   2.5%   97.5%   z val.      p
------------------------------------ ----------- ------ ------- -------- ------
(Intercept)                                 0.00   0.00    0.00   -14.04   0.00
male1                                       1.51   1.07    2.14     2.32   0.02
age                                         1.07   1.05    1.08     8.28   0.00
sys_bp                                      1.01   1.01    1.02     3.96   0.00
glucose                                     1.01   1.00    1.01     3.56   0.00
male0:current_smoker1                       1.47   0.97    2.23     1.81   0.07
male1:current_smoker1                       1.75   1.17    2.62     2.71   0.01
current_smoker0:prevalent_hyp1              1.60   1.08    2.38     2.35   0.02
current_smoker1:prevalent_hyp1              1.33   0.90    1.98     1.43   0.15
-------------------------------------------------------------------------------
 
-------------------------------------------
                                        VIF
------------------------------------ ------
(Intercept)                                
male1                                  2.24
age                                    1.18
sys_bp                                 1.96
glucose                                1.01
male0:current_smoker1                  4.18
male1:current_smoker1                  4.18
current_smoker0:prevalent_hyp1         3.57
current_smoker1:prevalent_hyp1         3.57
-------------------------------------------

 Using a threshold for prediction = 0.50 

Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0 1332  221
         1   13   14
                                          
               Accuracy : 0.8519          
                 95% CI : (0.8334, 0.8691)
    No Information Rate : 0.8513          
    P-Value [Acc &gt; NIR] : 0.4892          
                                          
                  Kappa : 0.0786          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.059574        
            Specificity : 0.990335        
         Pos Pred Value : 0.518519        
         Neg Pred Value : 0.857695        
             Prevalence : 0.148734        
         Detection Rate : 0.008861        
   Detection Prevalence : 0.017089        
      Balanced Accuracy : 0.524955        
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ROC</span>(test, phat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output-display">

<div class="highchart html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-62a3b6c2f35e3ffc5dda" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-62a3b6c2f35e3ffc5dda">{"x":{"hc_opts":{"chart":{"reflow":true,"aspectRatio":1},"title":{"text":"ROC curve - AUC = 0.707"},"yAxis":{"title":{"text":"Sensitivity"},"type":"linear","min":0,"max":1},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0,"showInLegend":false},"treemap":{"layoutAlgorithm":"squarified"},"scatter":{"marker":{"symbol":"circle"}}},"series":[{"group":"group","data":[{"threshold":0,"specificity":0,"sensitivity":1,"x":0,"y":1},{"threshold":0.1,"specificity":0.453531598513011,"sensitivity":0.834042553191489,"x":0.453531598513011,"y":0.834042553191489},{"threshold":0.2,"specificity":0.763568773234201,"sensitivity":0.51063829787234,"x":0.763568773234201,"y":0.51063829787234},{"threshold":0.3,"specificity":0.898884758364312,"sensitivity":0.323404255319149,"x":0.898884758364312,"y":0.323404255319149},{"threshold":0.4,"specificity":0.964312267657993,"sensitivity":0.161702127659574,"x":0.964312267657993,"y":0.161702127659574},{"threshold":0.5,"specificity":0.990334572490706,"sensitivity":0.0595744680851064,"x":0.990334572490706,"y":0.0595744680851064},{"threshold":0.6,"specificity":0.998513011152416,"sensitivity":0.0170212765957447,"x":0.998513011152416,"y":0.0170212765957447},{"threshold":0.7,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.8,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.9,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":1,"specificity":1,"sensitivity":0,"x":1,"y":0}],"type":"line"},{"group":"group","data":[{"threshold":0,"specificity":0,"sensitivity":1,"x":0,"y":1},{"threshold":0.1,"specificity":0.453531598513011,"sensitivity":0.834042553191489,"x":0.453531598513011,"y":0.834042553191489},{"threshold":0.2,"specificity":0.763568773234201,"sensitivity":0.51063829787234,"x":0.763568773234201,"y":0.51063829787234},{"threshold":0.3,"specificity":0.898884758364312,"sensitivity":0.323404255319149,"x":0.898884758364312,"y":0.323404255319149},{"threshold":0.4,"specificity":0.964312267657993,"sensitivity":0.161702127659574,"x":0.964312267657993,"y":0.161702127659574},{"threshold":0.5,"specificity":0.990334572490706,"sensitivity":0.0595744680851064,"x":0.990334572490706,"y":0.0595744680851064},{"threshold":0.6,"specificity":0.998513011152416,"sensitivity":0.0170212765957447,"x":0.998513011152416,"y":0.0170212765957447},{"threshold":0.7,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.8,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.9,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":1,"specificity":1,"sensitivity":0,"x":1,"y":0}],"type":"scatter","marker":{"radius":6,"fillColor":"lightblue","lineWidth":2},"tooltip":{"headerFormat":"","pointFormat":"<b>Threshold: {point.threshold:.2f}<\/b><br>\n                           Sensitivity: {point.y:.2f}<br>\n                           Specificity: {point.x:.2f}"}}],"xAxis":{"type":"linear","title":{"text":"Specificity"},"reversed":true,"min":0,"max":1}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="sigmoid-for-age" class="level3">
<h3 class="anchored" data-anchor-id="sigmoid-for-age">Sigmoid for age</h3>
<p>We also decided to try to model age as a sigmoid, under the assumption that the odds of a CHD risk in ten years were overall smaller for people &lt; 40 and would increase at a steeper rate afterwards, however the perfomance of the model did not change.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>sigmoid_function <span class="ot">&lt;-</span> <span class="cf">function</span>(x, a, b, c, d) {</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sigmoid function formula: a + (b - a) / (1 + exp(-c * (x - d)))</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(a <span class="sc">+</span> (b <span class="sc">-</span> a) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>c <span class="sc">*</span> (x <span class="sc">-</span> d))))</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the parameters for the sigmoid function to control the curve</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>a_linear <span class="ot">&lt;-</span> <span class="dv">0</span>      <span class="co"># Start value (linear increase starts from 0)</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>b_linear <span class="ot">&lt;-</span> <span class="dv">1</span>      <span class="co"># End value of linear increase (1 represents 100%)</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>c_steepness <span class="ot">&lt;-</span> <span class="fl">0.15</span> <span class="co"># Steepness factor for the sigmoid curve (adjust as needed)</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>d_transition <span class="ot">&lt;-</span> <span class="dv">50</span> <span class="co"># Age at which the transition occurs (50 in your case)</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>train_sigmoid_age <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> </span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>(<span class="at">age_sigmoid =</span> <span class="fu">sigmoid_function</span>(age, a_linear, b_linear, c_steepness, d_transition))</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>test_sigmoid_age <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span> </span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>(<span class="at">age_sigmoid =</span> <span class="fu">sigmoid_function</span>(age, a_linear, b_linear, c_steepness, d_transition))</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(train_sigmoid_age<span class="sc">$</span>age, train_sigmoid_age<span class="sc">$</span>age_sigmoid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Graded_Task_Logistic_Regression_V5_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The proxy_age variable now has a smooth transition, increasing linearly until 50 and more steeply after that.</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>EVs  <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>   <span class="st">"male"</span>, <span class="st">"age_sigmoid"</span>, <span class="st">"sys_bp"</span>, <span class="st">"glucose"</span>, <span class="st">"cigs_per_day"</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>phat <span class="ot">&lt;-</span> <span class="fu">do_logistic_regression</span>(</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a> <span class="at">train_data =</span> train_sigmoid_age,</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a> <span class="at">test_data =</span> test_sigmoid_age,</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a> EVs, <span class="at">thresh =</span> <span class="fl">0.1</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = formula_obj, family = "binomial", data = train_data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.0739  -0.5929  -0.4279  -0.2942   2.7784  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -6.433353   0.401903 -16.007  &lt; 2e-16 ***
male1         0.449367   0.127351   3.529 0.000418 ***
age_sigmoid   2.197337   0.258184   8.511  &lt; 2e-16 ***
sys_bp        0.018622   0.002598   7.167 7.64e-13 ***
glucose       0.007502   0.002109   3.556 0.000376 ***
cigs_per_day  0.017897   0.005184   3.452 0.000556 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2114.4  on 2470  degrees of freedom
Residual deviance: 1874.9  on 2465  degrees of freedom
AIC: 1886.9

Number of Fisher Scoring iterations: 5

MODEL INFO:
Observations: 2471
Dependent Variable: ten_year_chd
Type: Generalized linear model
  Family: binomial 
  Link function: logit 

MODEL FIT:
χ²(5) = 239.49, p = 0.00
Pseudo-R² (Cragg-Uhler) = 0.16
Pseudo-R² (McFadden) = 0.11
AIC = 1886.87, BIC = 1921.74 

Standard errors: MLE
--------------------------------------------------------------------
                     exp(Est.)   2.5%   97.5%   z val.      p    VIF
------------------ ----------- ------ ------- -------- ------ ------
(Intercept)               0.00   0.00    0.00   -16.01   0.00       
male1                     1.57   1.22    2.01     3.53   0.00   1.16
age_sigmoid               9.00   5.43   14.93     8.51   0.00   1.17
sys_bp                    1.02   1.01    1.02     7.17   0.00   1.14
glucose                   1.01   1.00    1.01     3.56   0.00   1.01
cigs_per_day              1.02   1.01    1.03     3.45   0.00   1.20
--------------------------------------------------------------------

 Using a threshold for prediction = 0.10 

Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 584  39
         1 761 196
                                          
               Accuracy : 0.4937          
                 95% CI : (0.4687, 0.5186)
    No Information Rate : 0.8513          
    P-Value [Acc &gt; NIR] : 1               
                                          
                  Kappa : 0.1183          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.8340          
            Specificity : 0.4342          
         Pos Pred Value : 0.2048          
         Neg Pred Value : 0.9374          
             Prevalence : 0.1487          
         Detection Rate : 0.1241          
   Detection Prevalence : 0.6057          
      Balanced Accuracy : 0.6341          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ROC</span>(test_sigmoid_age, phat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output-display">

<div class="highchart html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-4af0b936ccf1f577638e" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-4af0b936ccf1f577638e">{"x":{"hc_opts":{"chart":{"reflow":true,"aspectRatio":1},"title":{"text":"ROC curve - AUC = 0.712"},"yAxis":{"title":{"text":"Sensitivity"},"type":"linear","min":0,"max":1},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0,"showInLegend":false},"treemap":{"layoutAlgorithm":"squarified"},"scatter":{"marker":{"symbol":"circle"}}},"series":[{"group":"group","data":[{"threshold":0,"specificity":0,"sensitivity":1,"x":0,"y":1},{"threshold":0.1,"specificity":0.434200743494424,"sensitivity":0.834042553191489,"x":0.434200743494424,"y":0.834042553191489},{"threshold":0.2,"specificity":0.761338289962825,"sensitivity":0.531914893617021,"x":0.761338289962825,"y":0.531914893617021},{"threshold":0.3,"specificity":0.899628252788104,"sensitivity":0.276595744680851,"x":0.899628252788104,"y":0.276595744680851},{"threshold":0.4,"specificity":0.971003717472119,"sensitivity":0.148936170212766,"x":0.971003717472119,"y":0.148936170212766},{"threshold":0.5,"specificity":0.994052044609665,"sensitivity":0.0553191489361702,"x":0.994052044609665,"y":0.0553191489361702},{"threshold":0.6,"specificity":0.998513011152416,"sensitivity":0.025531914893617,"x":0.998513011152416,"y":0.025531914893617},{"threshold":0.7,"specificity":1,"sensitivity":0.0127659574468085,"x":1,"y":0.0127659574468085},{"threshold":0.8,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.9,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":1,"specificity":1,"sensitivity":0,"x":1,"y":0}],"type":"line"},{"group":"group","data":[{"threshold":0,"specificity":0,"sensitivity":1,"x":0,"y":1},{"threshold":0.1,"specificity":0.434200743494424,"sensitivity":0.834042553191489,"x":0.434200743494424,"y":0.834042553191489},{"threshold":0.2,"specificity":0.761338289962825,"sensitivity":0.531914893617021,"x":0.761338289962825,"y":0.531914893617021},{"threshold":0.3,"specificity":0.899628252788104,"sensitivity":0.276595744680851,"x":0.899628252788104,"y":0.276595744680851},{"threshold":0.4,"specificity":0.971003717472119,"sensitivity":0.148936170212766,"x":0.971003717472119,"y":0.148936170212766},{"threshold":0.5,"specificity":0.994052044609665,"sensitivity":0.0553191489361702,"x":0.994052044609665,"y":0.0553191489361702},{"threshold":0.6,"specificity":0.998513011152416,"sensitivity":0.025531914893617,"x":0.998513011152416,"y":0.025531914893617},{"threshold":0.7,"specificity":1,"sensitivity":0.0127659574468085,"x":1,"y":0.0127659574468085},{"threshold":0.8,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.9,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":1,"specificity":1,"sensitivity":0,"x":1,"y":0}],"type":"scatter","marker":{"radius":6,"fillColor":"lightblue","lineWidth":2},"tooltip":{"headerFormat":"","pointFormat":"<b>Threshold: {point.threshold:.2f}<\/b><br>\n                           Sensitivity: {point.y:.2f}<br>\n                           Specificity: {point.x:.2f}"}}],"xAxis":{"type":"linear","title":{"text":"Specificity"},"reversed":true,"min":0,"max":1}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="final-model-using-thr-0.5" class="level3">
<h3 class="anchored" data-anchor-id="final-model-using-thr-0.5">Final model using thr = 0.5</h3>
<p>We decided to include the following variables in the final model:</p>
<ul>
<li>male</li>
<li>age</li>
<li>sys_bp</li>
<li>glucose</li>
<li>cigs_per_day</li>
</ul>
<p>At this point, we evaluate the performance of the model in terms of sensitivity (TP/TP+FN) using a default threshold of 0.5 for binary decision on the test set.</p>
<p>Our aim is to maximise the amount of people at risk which are predicted to be so by the model.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The main aim is to use the model to identify the highest amount of true positives</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and minimize false negatives</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>EVs  <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>   <span class="st">"male"</span>, <span class="st">"age"</span>, <span class="st">"sys_bp"</span>, <span class="st">"glucose"</span>, <span class="st">"cigs_per_day"</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>phat <span class="ot">&lt;-</span> <span class="fu">do_logistic_regression</span>(EVs, <span class="at">thresh =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = formula_obj, family = "binomial", data = train_data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1053  -0.5899  -0.4330  -0.2982   2.8162  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -8.643579   0.504565 -17.131  &lt; 2e-16 ***
male1         0.449590   0.127385   3.529 0.000417 ***
age           0.065845   0.007745   8.502  &lt; 2e-16 ***
sys_bp        0.018684   0.002597   7.194 6.29e-13 ***
glucose       0.007547   0.002112   3.573 0.000353 ***
cigs_per_day  0.017858   0.005184   3.445 0.000571 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2114.4  on 2470  degrees of freedom
Residual deviance: 1875.8  on 2465  degrees of freedom
AIC: 1887.8

Number of Fisher Scoring iterations: 5

MODEL INFO:
Observations: 2471
Dependent Variable: ten_year_chd
Type: Generalized linear model
  Family: binomial 
  Link function: logit 

MODEL FIT:
χ²(5) = 238.54, p = 0.00
Pseudo-R² (Cragg-Uhler) = 0.16
Pseudo-R² (McFadden) = 0.11
AIC = 1887.82, BIC = 1922.69 

Standard errors: MLE
--------------------------------------------------------------------
                     exp(Est.)   2.5%   97.5%   z val.      p    VIF
------------------ ----------- ------ ------- -------- ------ ------
(Intercept)               0.00   0.00    0.00   -17.13   0.00       
male1                     1.57   1.22    2.01     3.53   0.00   1.16
age                       1.07   1.05    1.08     8.50   0.00   1.17
sys_bp                    1.02   1.01    1.02     7.19   0.00   1.14
glucose                   1.01   1.00    1.01     3.57   0.00   1.01
cigs_per_day              1.02   1.01    1.03     3.44   0.00   1.20
--------------------------------------------------------------------

 Using a threshold for prediction = 0.50 

Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0 1337  219
         1    8   16
                                          
               Accuracy : 0.8563          
                 95% CI : (0.8381, 0.8733)
    No Information Rate : 0.8513          
    P-Value [Acc &gt; NIR] : 0.3             
                                          
                  Kappa : 0.0987          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.06809         
            Specificity : 0.99405         
         Pos Pred Value : 0.66667         
         Neg Pred Value : 0.85925         
             Prevalence : 0.14873         
         Detection Rate : 0.01013         
   Detection Prevalence : 0.01519         
      Balanced Accuracy : 0.53107         
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ROC</span>(test, phat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output-display">

<div class="highchart html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-1d9a1a0ff105765838a8" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-1d9a1a0ff105765838a8">{"x":{"hc_opts":{"chart":{"reflow":true,"aspectRatio":1},"title":{"text":"ROC curve - AUC = 0.713"},"yAxis":{"title":{"text":"Sensitivity"},"type":"linear","min":0,"max":1},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0,"showInLegend":false},"treemap":{"layoutAlgorithm":"squarified"},"scatter":{"marker":{"symbol":"circle"}}},"series":[{"group":"group","data":[{"threshold":0,"specificity":0,"sensitivity":1,"x":0,"y":1},{"threshold":0.1,"specificity":0.43271375464684,"sensitivity":0.842553191489362,"x":0.43271375464684,"y":0.842553191489362},{"threshold":0.2,"specificity":0.769516728624535,"sensitivity":0.523404255319149,"x":0.769516728624535,"y":0.523404255319149},{"threshold":0.3,"specificity":0.901115241635688,"sensitivity":0.28936170212766,"x":0.901115241635688,"y":0.28936170212766},{"threshold":0.4,"specificity":0.971003717472119,"sensitivity":0.153191489361702,"x":0.971003717472119,"y":0.153191489361702},{"threshold":0.5,"specificity":0.994052044609665,"sensitivity":0.0680851063829787,"x":0.994052044609665,"y":0.0680851063829787},{"threshold":0.6,"specificity":0.998513011152416,"sensitivity":0.0340425531914894,"x":0.998513011152416,"y":0.0340425531914894},{"threshold":0.7,"specificity":1,"sensitivity":0.0127659574468085,"x":1,"y":0.0127659574468085},{"threshold":0.8,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.9,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":1,"specificity":1,"sensitivity":0,"x":1,"y":0}],"type":"line"},{"group":"group","data":[{"threshold":0,"specificity":0,"sensitivity":1,"x":0,"y":1},{"threshold":0.1,"specificity":0.43271375464684,"sensitivity":0.842553191489362,"x":0.43271375464684,"y":0.842553191489362},{"threshold":0.2,"specificity":0.769516728624535,"sensitivity":0.523404255319149,"x":0.769516728624535,"y":0.523404255319149},{"threshold":0.3,"specificity":0.901115241635688,"sensitivity":0.28936170212766,"x":0.901115241635688,"y":0.28936170212766},{"threshold":0.4,"specificity":0.971003717472119,"sensitivity":0.153191489361702,"x":0.971003717472119,"y":0.153191489361702},{"threshold":0.5,"specificity":0.994052044609665,"sensitivity":0.0680851063829787,"x":0.994052044609665,"y":0.0680851063829787},{"threshold":0.6,"specificity":0.998513011152416,"sensitivity":0.0340425531914894,"x":0.998513011152416,"y":0.0340425531914894},{"threshold":0.7,"specificity":1,"sensitivity":0.0127659574468085,"x":1,"y":0.0127659574468085},{"threshold":0.8,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.9,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":1,"specificity":1,"sensitivity":0,"x":1,"y":0}],"type":"scatter","marker":{"radius":6,"fillColor":"lightblue","lineWidth":2},"tooltip":{"headerFormat":"","pointFormat":"<b>Threshold: {point.threshold:.2f}<\/b><br>\n                           Sensitivity: {point.y:.2f}<br>\n                           Specificity: {point.x:.2f}"}}],"xAxis":{"type":"linear","title":{"text":"Specificity"},"reversed":true,"min":0,"max":1}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="final-model-using-thr-0.1" class="level3">
<h3 class="anchored" data-anchor-id="final-model-using-thr-0.1">Final model using thr = 0.1</h3>
<p>Leaving the default threshold of 0.5 for binary prediction leads to identifying too few true positives. For this reason, we decided to maximise the Sensitivity (TP / (TP+FN)) even at the expense of assigning high risk of CHD to some people who are not.</p>
<p>This rationale is motivated by the fact that in this case the decision is not about doing or not doing an open-heart surgery, but rather to start to monitor people who might be at high risk. Plus, according the to the model, an accurate monitoring only requires inexpensive procedures: blood test and pressure measurements.</p>
<p>For this reason, it is of paramount important to include all the people who might be at risk even if they will turn out not to be so.</p>
<p>The threshold for risk detection is accordingly lowered to 0.1.</p>
<p>This leads to determine that almost 50% of the people who are <em>not</em> at risk will be deemed to be actually at risk. However, this choice will lead to a Sensitivity of about 80%.</p>
<p>NB: We also replace the <code>cigs_per_day</code> with units of tens of cigarettes</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The main aim is to use the model to identify the highest amount of true positives</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and minimize false negatives</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># EVs  &lt;- c(</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co">#    "male", "age", "sys_bp", "glucose", "cigs_per_day"</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="co"># phat &lt;- do_logistic_regression(EVs, thresh = 0.1)</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>train_cig_factor <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> </span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>(<span class="at">tens_cigs =</span> <span class="fu">round</span>(cigs_per_day<span class="sc">/</span><span class="dv">10</span>,<span class="dv">0</span>))</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>test_cig_factor <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span> </span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>(<span class="at">tens_cigs =</span> <span class="fu">round</span>(cigs_per_day<span class="sc">/</span><span class="dv">10</span>,<span class="dv">0</span>))</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>EVs  <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>   <span class="st">"male"</span>, <span class="st">"age"</span>, <span class="st">"sys_bp"</span>, <span class="st">"glucose"</span>, <span class="st">"tens_cigs"</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>phat <span class="ot">&lt;-</span> <span class="fu">do_logistic_regression</span>(</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a> EVs, </span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a> <span class="at">train_data =</span> train_cig_factor, </span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a> <span class="at">test_data =</span> test_cig_factor, </span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a> <span class="at">thresh =</span> <span class="fl">0.1</span></span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = formula_obj, family = "binomial", data = train_data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1007  -0.5886  -0.4341  -0.2981   2.8165  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -8.636592   0.503982 -17.137  &lt; 2e-16 ***
male1        0.448757   0.127401   3.522 0.000428 ***
age          0.065813   0.007742   8.501  &lt; 2e-16 ***
sys_bp       0.018675   0.002597   7.191 6.45e-13 ***
glucose      0.007510   0.002108   3.562 0.000368 ***
tens_cigs    0.176640   0.051338   3.441 0.000580 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2114.4  on 2470  degrees of freedom
Residual deviance: 1875.8  on 2465  degrees of freedom
AIC: 1887.8

Number of Fisher Scoring iterations: 5

MODEL INFO:
Observations: 2471
Dependent Variable: ten_year_chd
Type: Generalized linear model
  Family: binomial 
  Link function: logit 

MODEL FIT:
χ²(5) = 238.54, p = 0.00
Pseudo-R² (Cragg-Uhler) = 0.16
Pseudo-R² (McFadden) = 0.11
AIC = 1887.81, BIC = 1922.69 

Standard errors: MLE
-------------------------------------------------------------------
                    exp(Est.)   2.5%   97.5%   z val.      p    VIF
----------------- ----------- ------ ------- -------- ------ ------
(Intercept)              0.00   0.00    0.00   -17.14   0.00       
male1                    1.57   1.22    2.01     3.52   0.00   1.16
age                      1.07   1.05    1.08     8.50   0.00   1.17
sys_bp                   1.02   1.01    1.02     7.19   0.00   1.14
glucose                  1.01   1.00    1.01     3.56   0.00   1.01
tens_cigs                1.19   1.08    1.32     3.44   0.00   1.20
-------------------------------------------------------------------

 Using a threshold for prediction = 0.10 

Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 588  38
         1 757 197
                                          
               Accuracy : 0.4968          
                 95% CI : (0.4719, 0.5218)
    No Information Rate : 0.8513          
    P-Value [Acc &gt; NIR] : 1               
                                          
                  Kappa : 0.1218          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.8383          
            Specificity : 0.4372          
         Pos Pred Value : 0.2065          
         Neg Pred Value : 0.9393          
             Prevalence : 0.1487          
         Detection Rate : 0.1247          
   Detection Prevalence : 0.6038          
      Balanced Accuracy : 0.6377          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ROC</span>(test, phat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output-display">

<div class="highchart html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-38a7e4c6725b331f3179" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-38a7e4c6725b331f3179">{"x":{"hc_opts":{"chart":{"reflow":true,"aspectRatio":1},"title":{"text":"ROC curve - AUC = 0.713"},"yAxis":{"title":{"text":"Sensitivity"},"type":"linear","min":0,"max":1},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0,"showInLegend":false},"treemap":{"layoutAlgorithm":"squarified"},"scatter":{"marker":{"symbol":"circle"}}},"series":[{"group":"group","data":[{"threshold":0,"specificity":0,"sensitivity":1,"x":0,"y":1},{"threshold":0.1,"specificity":0.437174721189591,"sensitivity":0.838297872340426,"x":0.437174721189591,"y":0.838297872340426},{"threshold":0.2,"specificity":0.771003717472119,"sensitivity":0.527659574468085,"x":0.771003717472119,"y":0.527659574468085},{"threshold":0.3,"specificity":0.90185873605948,"sensitivity":0.293617021276596,"x":0.90185873605948,"y":0.293617021276596},{"threshold":0.4,"specificity":0.971003717472119,"sensitivity":0.153191489361702,"x":0.971003717472119,"y":0.153191489361702},{"threshold":0.5,"specificity":0.994052044609665,"sensitivity":0.0723404255319149,"x":0.994052044609665,"y":0.0723404255319149},{"threshold":0.6,"specificity":0.998513011152416,"sensitivity":0.0340425531914894,"x":0.998513011152416,"y":0.0340425531914894},{"threshold":0.7,"specificity":1,"sensitivity":0.0127659574468085,"x":1,"y":0.0127659574468085},{"threshold":0.8,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.9,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":1,"specificity":1,"sensitivity":0,"x":1,"y":0}],"type":"line"},{"group":"group","data":[{"threshold":0,"specificity":0,"sensitivity":1,"x":0,"y":1},{"threshold":0.1,"specificity":0.437174721189591,"sensitivity":0.838297872340426,"x":0.437174721189591,"y":0.838297872340426},{"threshold":0.2,"specificity":0.771003717472119,"sensitivity":0.527659574468085,"x":0.771003717472119,"y":0.527659574468085},{"threshold":0.3,"specificity":0.90185873605948,"sensitivity":0.293617021276596,"x":0.90185873605948,"y":0.293617021276596},{"threshold":0.4,"specificity":0.971003717472119,"sensitivity":0.153191489361702,"x":0.971003717472119,"y":0.153191489361702},{"threshold":0.5,"specificity":0.994052044609665,"sensitivity":0.0723404255319149,"x":0.994052044609665,"y":0.0723404255319149},{"threshold":0.6,"specificity":0.998513011152416,"sensitivity":0.0340425531914894,"x":0.998513011152416,"y":0.0340425531914894},{"threshold":0.7,"specificity":1,"sensitivity":0.0127659574468085,"x":1,"y":0.0127659574468085},{"threshold":0.8,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.9,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":1,"specificity":1,"sensitivity":0,"x":1,"y":0}],"type":"scatter","marker":{"radius":6,"fillColor":"lightblue","lineWidth":2},"tooltip":{"headerFormat":"","pointFormat":"<b>Threshold: {point.threshold:.2f}<\/b><br>\n                           Sensitivity: {point.y:.2f}<br>\n                           Specificity: {point.x:.2f}"}}],"xAxis":{"type":"linear","title":{"text":"Specificity"},"reversed":true,"min":0,"max":1}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Code to manually calculate the Confusion Matrix and its derivatives. Values are not shown. This was just an excercise.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Binary prediction from the estimated probability values </span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="co"># thresh &lt;- 0.1</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co"># predicted &lt;- ifelse(phat &gt; thresh, 1, 0)</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co"># actual_predicted &lt;- tibble(</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="co">#    actual = test$ten_year_chd, </span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="co">#    predicted = ifelse(phat &gt; thresh, 1, 0) </span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="co"># cm &lt;- actual_predicted %&gt;%</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     TP = sum(actual == 1 &amp; predicted == 1),</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     TN = sum(actual == 0 &amp; predicted == 0),</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     FP = sum(actual == 0 &amp; predicted == 1),</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     FN = sum(actual == 1 &amp; predicted == 0)</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a><span class="co"># cm %&gt;% print</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a><span class="co"># TP &lt;- cm$TP</span></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a><span class="co"># TN &lt;- cm$TN</span></span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a><span class="co"># FP &lt;- cm$FP</span></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a><span class="co"># FN &lt;- cm$FN</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a><span class="co"># accuracy &lt;- (TP + TN) / (TP+TN+FP+FN)</span></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a><span class="co"># print(paste0("Accuracy = ", round(accuracy,4)))</span></span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a><span class="co"># sensitivity &lt;- TP / (TP + FN)</span></span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a><span class="co"># print(paste0("Sensitivity / Recall / TPR = ", round(sensitivity,4)))</span></span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a><span class="co"># specificity &lt;- TN / (TN + FP)</span></span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a><span class="co"># print(paste0("Specificity / TNR = ", round(specificity,4)))</span></span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a><span class="co"># PPV &lt;- TP / (TP+FP)</span></span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a><span class="co"># print(paste0("Positive Predictive Value = ", round(PPV,2)))</span></span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a><span class="co"># NPV &lt;- TN / (TN+FN)</span></span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a><span class="co"># print(paste0("Negative Predictive Value = ", round(NPV,2)))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="automatic-stepwise" class="level2">
<h2 class="anchored" data-anchor-id="automatic-stepwise">Automatic stepwise</h2>
<p><em>This</em> particular stepwise regression leads to a much more complex model. It is important to note that the particular order of the predictors can change the final estimated “best” model (based on AIC).</p>
<p>However what is very important is that the <code>cigs_per_day</code> is identified as an important predictor, despite our EDA repeatedly disconfirmed so. The reasons are therefore to be explored, however for the time being we will try to include it into our manually built model (see above.)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>fullModel <span class="ot">=</span> <span class="fu">glm</span>(</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>   ten_year_chd <span class="sc">~</span> male <span class="sc">+</span> prevalent_hyp <span class="sc">+</span> bp_meds <span class="sc">+</span> age <span class="sc">+</span> sys_bp <span class="sc">+</span> glucose <span class="sc">+</span> tot_chol,</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> train</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>fullModel <span class="ot">=</span> <span class="fu">glm</span>(ten_year_chd <span class="sc">~</span> ., <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> train)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>nullModel <span class="ot">=</span> <span class="fu">glm</span>(ten_year_chd <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">data =</span> train)</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>step_fit <span class="ot">&lt;-</span> <span class="fu">stepAIC</span>(</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>   fullModel, <span class="at">direction =</span> <span class="st">'backward'</span>, </span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>   <span class="at">scope =</span> <span class="fu">list</span>(<span class="at">upper =</span> fullModel, <span class="at">lower =</span> nullModel), <span class="at">trace =</span> <span class="dv">0</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>step_fit <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = ten_year_chd ~ male + age + education + cigs_per_day + 
    prevalent_stroke + prevalent_hyp + sys_bp + glucose, family = "binomial", 
    data = train)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.0023  -0.5868  -0.4197  -0.2915   2.7940  

Coefficients:
                   Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)       -7.655170   0.587371 -13.033  &lt; 2e-16 ***
male1              0.387895   0.129655   2.992 0.002774 ** 
age                0.060750   0.007983   7.610 2.74e-14 ***
education2        -0.335970   0.150240  -2.236 0.025337 *  
education3        -0.352595   0.184679  -1.909 0.056232 .  
education4        -0.038528   0.195294  -0.197 0.843606    
cigs_per_day       0.019113   0.005227   3.657 0.000256 ***
prevalent_stroke1  0.969730   0.601408   1.612 0.106868    
prevalent_hyp1     0.372800   0.161896   2.303 0.021295 *  
sys_bp             0.013282   0.003412   3.893 9.92e-05 ***
glucose            0.007787   0.002106   3.698 0.000217 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2114.4  on 2470  degrees of freedom
Residual deviance: 1860.2  on 2460  degrees of freedom
AIC: 1882.2

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>step_fit <span class="sc">%&gt;%</span> jtools<span class="sc">::</span><span class="fu">summ</span>(<span class="at">confint =</span> T, <span class="at">vifs =</span> T, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MODEL INFO:
Observations: 2471
Dependent Variable: ten_year_chd
Type: Generalized linear model
  Family: binomial 
  Link function: logit 

MODEL FIT:
χ²(10) = 254.11, p = 0.00
Pseudo-R² (Cragg-Uhler) = 0.17
Pseudo-R² (McFadden) = 0.12
AIC = 1882.24, BIC = 1946.18 

Standard errors: MLE
----------------------------------------------------------------------
                           Est.    2.5%   97.5%   z val.      p    VIF
----------------------- ------- ------- ------- -------- ------ ------
(Intercept)               -7.66   -8.81   -6.50   -13.03   0.00       
male1                      0.39    0.13    0.64     2.99   0.00   1.19
age                        0.06    0.05    0.08     7.61   0.00   1.23
education2                -0.34   -0.63   -0.04    -2.24   0.03   1.09
education3                -0.35   -0.71    0.01    -1.91   0.06   1.09
education4                -0.04   -0.42    0.34    -0.20   0.84   1.09
cigs_per_day               0.02    0.01    0.03     3.66   0.00   1.22
prevalent_stroke1          0.97   -0.21    2.15     1.61   0.11   1.01
prevalent_hyp1             0.37    0.06    0.69     2.30   0.02   1.85
sys_bp                     0.01    0.01    0.02     3.89   0.00   1.97
glucose                    0.01    0.00    0.01     3.70   0.00   1.02
----------------------------------------------------------------------</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimated probability values from the logistic model</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>phat_step_fit <span class="ot">=</span> <span class="fu">predict</span>(step_fit, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Evaluate predictivity of the stepwise model</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Binary prediction from the estimated probability values </span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>thresh <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>predicted <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(phat_step_fit <span class="sc">&gt;</span> thresh, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>actual_predicted <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">actual =</span> test<span class="sc">$</span>ten_year_chd, </span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>   <span class="at">predicted =</span> <span class="fu">ifelse</span>(phat_step_fit <span class="sc">&gt;</span> thresh, <span class="dv">1</span>, <span class="dv">0</span>) </span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as.factor</span>(predicted), <span class="co"># predicted</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as.factor</span>(test<span class="sc">$</span>ten_year_chd), <span class="co"># actual </span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>   <span class="at">positive =</span> <span class="st">"1"</span>  <span class="co"># the positive class in our case is "1"</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 608  38
         1 737 197
                                          
               Accuracy : 0.5095          
                 95% CI : (0.4845, 0.5344)
    No Information Rate : 0.8513          
    P-Value [Acc &gt; NIR] : 1               
                                          
                  Kappa : 0.1304          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.8383          
            Specificity : 0.4520          
         Pos Pred Value : 0.2109          
         Neg Pred Value : 0.9412          
             Prevalence : 0.1487          
         Detection Rate : 0.1247          
   Detection Prevalence : 0.5911          
      Balanced Accuracy : 0.6452          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ROC</span>(test, phat_step_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output-display">

<div class="highchart html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-06a5b60099d37fd1c213" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-06a5b60099d37fd1c213">{"x":{"hc_opts":{"chart":{"reflow":true,"aspectRatio":1},"title":{"text":"ROC curve - AUC = 0.706"},"yAxis":{"title":{"text":"Sensitivity"},"type":"linear","min":0,"max":1},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0,"showInLegend":false},"treemap":{"layoutAlgorithm":"squarified"},"scatter":{"marker":{"symbol":"circle"}}},"series":[{"group":"group","data":[{"threshold":0,"specificity":0,"sensitivity":1,"x":0,"y":1},{"threshold":0.1,"specificity":0.452044609665428,"sensitivity":0.838297872340426,"x":0.452044609665428,"y":0.838297872340426},{"threshold":0.2,"specificity":0.76728624535316,"sensitivity":0.527659574468085,"x":0.76728624535316,"y":0.527659574468085},{"threshold":0.3,"specificity":0.901115241635688,"sensitivity":0.31063829787234,"x":0.901115241635688,"y":0.31063829787234},{"threshold":0.4,"specificity":0.965799256505576,"sensitivity":0.148936170212766,"x":0.965799256505576,"y":0.148936170212766},{"threshold":0.5,"specificity":0.991078066914498,"sensitivity":0.0936170212765957,"x":0.991078066914498,"y":0.0936170212765957},{"threshold":0.6,"specificity":0.997769516728625,"sensitivity":0.0425531914893617,"x":0.997769516728625,"y":0.0425531914893617},{"threshold":0.7,"specificity":1,"sensitivity":0.0212765957446809,"x":1,"y":0.0212765957446809},{"threshold":0.8,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.9,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":1,"specificity":1,"sensitivity":0,"x":1,"y":0}],"type":"line"},{"group":"group","data":[{"threshold":0,"specificity":0,"sensitivity":1,"x":0,"y":1},{"threshold":0.1,"specificity":0.452044609665428,"sensitivity":0.838297872340426,"x":0.452044609665428,"y":0.838297872340426},{"threshold":0.2,"specificity":0.76728624535316,"sensitivity":0.527659574468085,"x":0.76728624535316,"y":0.527659574468085},{"threshold":0.3,"specificity":0.901115241635688,"sensitivity":0.31063829787234,"x":0.901115241635688,"y":0.31063829787234},{"threshold":0.4,"specificity":0.965799256505576,"sensitivity":0.148936170212766,"x":0.965799256505576,"y":0.148936170212766},{"threshold":0.5,"specificity":0.991078066914498,"sensitivity":0.0936170212765957,"x":0.991078066914498,"y":0.0936170212765957},{"threshold":0.6,"specificity":0.997769516728625,"sensitivity":0.0425531914893617,"x":0.997769516728625,"y":0.0425531914893617},{"threshold":0.7,"specificity":1,"sensitivity":0.0212765957446809,"x":1,"y":0.0212765957446809},{"threshold":0.8,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":0.9,"specificity":1,"sensitivity":0.00851063829787234,"x":1,"y":0.00851063829787234},{"threshold":1,"specificity":1,"sensitivity":0,"x":1,"y":0}],"type":"scatter","marker":{"radius":6,"fillColor":"lightblue","lineWidth":2},"tooltip":{"headerFormat":"","pointFormat":"<b>Threshold: {point.threshold:.2f}<\/b><br>\n                           Sensitivity: {point.y:.2f}<br>\n                           Specificity: {point.x:.2f}"}}],"xAxis":{"type":"linear","title":{"text":"Specificity"},"reversed":true,"min":0,"max":1}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="samples-balanced-for-chd-risk" class="level2">
<h2 class="anchored" data-anchor-id="samples-balanced-for-chd-risk">Samples balanced for CHD risk</h2>
<p>Our sample is very unbalanced. We will select an equal number of people with and without risk in both train and test set to assess whether this will help model performance.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9999</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>min_train <span class="ot">&lt;-</span> <span class="fu">min</span>(</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">nrow</span>(train[train<span class="sc">$</span>ten_year_chd <span class="sc">==</span> <span class="dv">1</span>,]),</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">nrow</span>(train[train<span class="sc">$</span>ten_year_chd <span class="sc">==</span> <span class="dv">0</span>,])   </span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>balanced_train <span class="ot">&lt;-</span> train <span class="sc">%&gt;%</span> </span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(ten_year_chd) <span class="sc">%&gt;%</span> </span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">slice_sample</span>(<span class="at">n =</span> min_train)</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>min_test <span class="ot">&lt;-</span> <span class="fu">min</span>(</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">nrow</span>(test[test<span class="sc">$</span>ten_year_chd <span class="sc">==</span> <span class="dv">1</span>,]),</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">nrow</span>(test[test<span class="sc">$</span>ten_year_chd <span class="sc">==</span> <span class="dv">0</span>,])   </span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>balanced_test <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span> </span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(ten_year_chd) <span class="sc">%&gt;%</span> </span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>   <span class="fu">slice_sample</span>(<span class="at">n =</span> min_test)</span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Full model with the selected variables</span></span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>EVs  <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>   <span class="st">"male"</span>, <span class="st">"prevalent_hyp"</span>, <span class="st">"bp_meds"</span>, <span class="st">"education"</span>,</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>   <span class="st">"age"</span>, <span class="st">"sys_bp"</span>, <span class="st">"bmi"</span>, <span class="st">"glucose"</span>, <span class="st">"tot_chol"</span></span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove education, bp_meds, bmi, tot_chol since they have</span></span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a><span class="co"># no effect on the model</span></span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>EVs  <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a>   <span class="st">"male"</span>, <span class="st">"prevalent_hyp"</span>,</span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a>   <span class="st">"age"</span>, <span class="st">"sys_bp"</span>, <span class="st">"glucose"</span></span>
<span id="cb88-35"><a href="#cb88-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-36"><a href="#cb88-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-37"><a href="#cb88-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-38"><a href="#cb88-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove prevalent_hyp since it is only marginally significant</span></span>
<span id="cb88-39"><a href="#cb88-39" aria-hidden="true" tabindex="-1"></a>EVs  <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb88-40"><a href="#cb88-40" aria-hidden="true" tabindex="-1"></a>   <span class="st">"male"</span>, <span class="st">"age"</span>, <span class="st">"sys_bp"</span>, <span class="st">"glucose"</span></span>
<span id="cb88-41"><a href="#cb88-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-42"><a href="#cb88-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-43"><a href="#cb88-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-44"><a href="#cb88-44" aria-hidden="true" tabindex="-1"></a><span class="co"># The stepwise regression - below - identified cigs_per_day as an important factor.</span></span>
<span id="cb88-45"><a href="#cb88-45" aria-hidden="true" tabindex="-1"></a><span class="co"># I will therefore add it to the model.</span></span>
<span id="cb88-46"><a href="#cb88-46" aria-hidden="true" tabindex="-1"></a>EVs  <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb88-47"><a href="#cb88-47" aria-hidden="true" tabindex="-1"></a>   <span class="st">"male"</span>, <span class="st">"age"</span>, <span class="st">"sys_bp"</span>, <span class="st">"glucose"</span>, <span class="st">"cigs_per_day"</span></span>
<span id="cb88-48"><a href="#cb88-48" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-49"><a href="#cb88-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-50"><a href="#cb88-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-51"><a href="#cb88-51" aria-hidden="true" tabindex="-1"></a>phat <span class="ot">&lt;-</span> <span class="fu">do_logistic_regression</span>(</span>
<span id="cb88-52"><a href="#cb88-52" aria-hidden="true" tabindex="-1"></a>   EVs, </span>
<span id="cb88-53"><a href="#cb88-53" aria-hidden="true" tabindex="-1"></a>   <span class="at">train_data =</span> balanced_train, <span class="at">test_data =</span> balanced_test,</span>
<span id="cb88-54"><a href="#cb88-54" aria-hidden="true" tabindex="-1"></a>   <span class="at">thresh =</span> <span class="fl">0.4</span></span>
<span id="cb88-55"><a href="#cb88-55" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = formula_obj, family = "binomial", data = train_data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1032  -1.0034  -0.1717   1.0161   2.0910  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -7.238967   0.720868 -10.042  &lt; 2e-16 ***
male1         0.319629   0.169510   1.886  0.05935 .  
age           0.074519   0.010682   6.976 3.04e-12 ***
sys_bp        0.015708   0.003688   4.259 2.06e-05 ***
glucose       0.010113   0.003923   2.578  0.00994 ** 
cigs_per_day  0.030757   0.007706   3.991 6.57e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1048.04  on 755  degrees of freedom
Residual deviance:  910.19  on 750  degrees of freedom
AIC: 922.19

Number of Fisher Scoring iterations: 4

MODEL INFO:
Observations: 756
Dependent Variable: ten_year_chd
Type: Generalized linear model
  Family: binomial 
  Link function: logit 

MODEL FIT:
χ²(5) = 137.85, p = 0.00
Pseudo-R² (Cragg-Uhler) = 0.22
Pseudo-R² (McFadden) = 0.13
AIC = 922.19, BIC = 949.96 

Standard errors: MLE
--------------------------------------------------------------------
                     exp(Est.)   2.5%   97.5%   z val.      p    VIF
------------------ ----------- ------ ------- -------- ------ ------
(Intercept)               0.00   0.00    0.00   -10.04   0.00       
male1                     1.38   0.99    1.92     1.89   0.06   1.12
age                       1.08   1.06    1.10     6.98   0.00   1.18
sys_bp                    1.02   1.01    1.02     4.26   0.00   1.11
glucose                   1.01   1.00    1.02     2.58   0.01   1.01
cigs_per_day              1.03   1.02    1.05     3.99   0.00   1.20
--------------------------------------------------------------------

 Using a threshold for prediction = 0.40 

Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 115  44
         1 120 191
                                          
               Accuracy : 0.6511          
                 95% CI : (0.6061, 0.6941)
    No Information Rate : 0.5             
    P-Value [Acc &gt; NIR] : 2.818e-11       
                                          
                  Kappa : 0.3021          
                                          
 Mcnemar's Test P-Value : 4.727e-09       
                                          
            Sensitivity : 0.8128          
            Specificity : 0.4894          
         Pos Pred Value : 0.6141          
         Neg Pred Value : 0.7233          
             Prevalence : 0.5000          
         Detection Rate : 0.4064          
   Detection Prevalence : 0.6617          
      Balanced Accuracy : 0.6511          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ROC</span>(balanced_test, phat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output-display">

<div class="highchart html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-b89bf2f95fec116677a3" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-b89bf2f95fec116677a3">{"x":{"hc_opts":{"chart":{"reflow":true,"aspectRatio":1},"title":{"text":"ROC curve - AUC = 0.738"},"yAxis":{"title":{"text":"Sensitivity"},"type":"linear","min":0,"max":1},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0,"showInLegend":false},"treemap":{"layoutAlgorithm":"squarified"},"scatter":{"marker":{"symbol":"circle"}}},"series":[{"group":"group","data":[{"threshold":0,"specificity":0,"sensitivity":1,"x":0,"y":1},{"threshold":0.1,"specificity":0.00425531914893617,"sensitivity":0.995744680851064,"x":0.00425531914893617,"y":0.995744680851064},{"threshold":0.2,"specificity":0.14468085106383,"sensitivity":0.978723404255319,"x":0.14468085106383,"y":0.978723404255319},{"threshold":0.3,"specificity":0.319148936170213,"sensitivity":0.914893617021277,"x":0.319148936170213,"y":0.914893617021277},{"threshold":0.4,"specificity":0.48936170212766,"sensitivity":0.812765957446808,"x":0.48936170212766,"y":0.812765957446808},{"threshold":0.5,"specificity":0.651063829787234,"sensitivity":0.668085106382979,"x":0.651063829787234,"y":0.668085106382979},{"threshold":0.6,"specificity":0.825531914893617,"sensitivity":0.493617021276596,"x":0.825531914893617,"y":0.493617021276596},{"threshold":0.7,"specificity":0.927659574468085,"sensitivity":0.31063829787234,"x":0.927659574468085,"y":0.31063829787234},{"threshold":0.8,"specificity":0.978723404255319,"sensitivity":0.148936170212766,"x":0.978723404255319,"y":0.148936170212766},{"threshold":0.9,"specificity":1,"sensitivity":0.0297872340425532,"x":1,"y":0.0297872340425532},{"threshold":1,"specificity":1,"sensitivity":0,"x":1,"y":0}],"type":"line"},{"group":"group","data":[{"threshold":0,"specificity":0,"sensitivity":1,"x":0,"y":1},{"threshold":0.1,"specificity":0.00425531914893617,"sensitivity":0.995744680851064,"x":0.00425531914893617,"y":0.995744680851064},{"threshold":0.2,"specificity":0.14468085106383,"sensitivity":0.978723404255319,"x":0.14468085106383,"y":0.978723404255319},{"threshold":0.3,"specificity":0.319148936170213,"sensitivity":0.914893617021277,"x":0.319148936170213,"y":0.914893617021277},{"threshold":0.4,"specificity":0.48936170212766,"sensitivity":0.812765957446808,"x":0.48936170212766,"y":0.812765957446808},{"threshold":0.5,"specificity":0.651063829787234,"sensitivity":0.668085106382979,"x":0.651063829787234,"y":0.668085106382979},{"threshold":0.6,"specificity":0.825531914893617,"sensitivity":0.493617021276596,"x":0.825531914893617,"y":0.493617021276596},{"threshold":0.7,"specificity":0.927659574468085,"sensitivity":0.31063829787234,"x":0.927659574468085,"y":0.31063829787234},{"threshold":0.8,"specificity":0.978723404255319,"sensitivity":0.148936170212766,"x":0.978723404255319,"y":0.148936170212766},{"threshold":0.9,"specificity":1,"sensitivity":0.0297872340425532,"x":1,"y":0.0297872340425532},{"threshold":1,"specificity":1,"sensitivity":0,"x":1,"y":0}],"type":"scatter","marker":{"radius":6,"fillColor":"lightblue","lineWidth":2},"tooltip":{"headerFormat":"","pointFormat":"<b>Threshold: {point.threshold:.2f}<\/b><br>\n                           Sensitivity: {point.y:.2f}<br>\n                           Specificity: {point.x:.2f}"}}],"xAxis":{"type":"linear","title":{"text":"Specificity"},"reversed":true,"min":0,"max":1}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="chd-prediction-app" class="level1">
<h1>CHD Prediction app</h1>
<p>Use the following model - estimated on the whole dataset - to predict the 10-year risk of CHD according to the given input.</p>
<p><span class="math display">\[
logOdds_{10yr-CHD-risk} = -8.671 + 0.51*male + 0.061*age + 0.0173*sys\_bp + 0.00758*glucose + 0.0204 * cigs\_per\_day
\]</span></p>
<p><span class="math display">\[
p = \frac{e^{logOdds}}{1 + e^{logOdds}}
\]</span></p>
<p><strong>NB: only for illustrational purposes. Read and accept the following Disclaimer first</strong></p>
<div class="cell">
<iframe src="https://agronomous.shinyapps.io/chd_risk_app/?showcase=0" width="672" height="1100" data-external="1">
</iframe>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>